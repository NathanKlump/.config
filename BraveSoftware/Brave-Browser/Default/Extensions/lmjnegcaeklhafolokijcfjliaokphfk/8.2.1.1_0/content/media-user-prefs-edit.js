var Ze=Object.create;var Ae=Object.defineProperty;var Xe=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var tt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty;var ne=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ot=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of et(t))!rt.call(e,i)&&i!==r&&Ae(e,i,{get:()=>t[i],enumerable:!(n=Xe(t,i))||n.enumerable});return e};var he=(e,t,r)=>(r=e!=null?Ze(tt(e)):{},ot(t||!e||!e.__esModule?Ae(r,"default",{value:e,enumerable:!0}):r,e));var se=ne((ie,xe)=>{(function(e,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof ie<"u")t(xe);else{var r={exports:{}};t(r),e.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ie,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=n=>{let i={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(i).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(c,y=void 0){super(y),this.createItem=c}get(c){return this.has(c)||this.set(c,this.createItem(c)),super.get(c)}}let s=u=>u&&typeof u=="object"&&typeof u.then=="function",a=(u,c)=>(...y)=>{n.runtime.lastError?u.reject(new Error(n.runtime.lastError.message)):c.singleCallbackArg||y.length<=1&&c.singleCallbackArg!==!1?u.resolve(y[0]):u.resolve(y)},p=u=>u==1?"argument":"arguments",l=(u,c)=>function(_,...w){if(w.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${p(c.minArgs)} for ${u}(), got ${w.length}`);if(w.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${p(c.maxArgs)} for ${u}(), got ${w.length}`);return new Promise((k,S)=>{if(c.fallbackToNoCallback)try{_[u](...w,a({resolve:k,reject:S},c))}catch(g){console.warn(`${u} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,g),_[u](...w),c.fallbackToNoCallback=!1,c.noCallback=!0,k()}else c.noCallback?(_[u](...w),k()):_[u](...w,a({resolve:k,reject:S},c))})},m=(u,c,y)=>new Proxy(c,{apply(_,w,k){return y.call(w,u,...k)}}),f=Function.call.bind(Object.prototype.hasOwnProperty),v=(u,c={},y={})=>{let _=Object.create(null),w={has(S,g){return g in u||g in _},get(S,g,N){if(g in _)return _[g];if(!(g in u))return;let b=u[g];if(typeof b=="function")if(typeof c[g]=="function")b=m(u,u[g],c[g]);else if(f(y,g)){let L=l(g,y[g]);b=m(u,u[g],L)}else b=b.bind(u);else if(typeof b=="object"&&b!==null&&(f(c,g)||f(y,g)))b=v(b,c[g],y[g]);else if(f(y,"*"))b=v(b,c[g],y["*"]);else return Object.defineProperty(_,g,{configurable:!0,enumerable:!0,get(){return u[g]},set(L){u[g]=L}}),b;return _[g]=b,b},set(S,g,N,b){return g in _?_[g]=N:u[g]=N,!0},defineProperty(S,g,N){return Reflect.defineProperty(_,g,N)},deleteProperty(S,g){return Reflect.deleteProperty(_,g)}},k=Object.create(u);return new Proxy(k,w)},x=u=>({addListener(c,y,..._){c.addListener(u.get(y),..._)},hasListener(c,y){return c.hasListener(u.get(y))},removeListener(c,y){c.removeListener(u.get(y))}}),O=new o(u=>typeof u!="function"?u:function(y){let _=v(y,{},{getContent:{minArgs:0,maxArgs:0}});u(_)}),C=new o(u=>typeof u!="function"?u:function(y,_,w){let k=!1,S,g=new Promise(Q=>{S=function(I){k=!0,Q(I)}}),N;try{N=u(y,_,S)}catch(Q){N=Promise.reject(Q)}let b=N!==!0&&s(N);if(N!==!0&&!b&&!k)return!1;let L=Q=>{Q.then(I=>{w(I)},I=>{let oe;I&&(I instanceof Error||typeof I.message=="string")?oe=I.message:oe="An unexpected error occurred",w({__mozWebExtensionPolyfillReject__:!0,message:oe})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return L(b?N:g),!0}),H=({reject:u,resolve:c},y)=>{n.runtime.lastError?n.runtime.lastError.message===t?c():u(new Error(n.runtime.lastError.message)):y&&y.__mozWebExtensionPolyfillReject__?u(new Error(y.message)):c(y)},j=(u,c,y,..._)=>{if(_.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${p(c.minArgs)} for ${u}(), got ${_.length}`);if(_.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${p(c.maxArgs)} for ${u}(), got ${_.length}`);return new Promise((w,k)=>{let S=H.bind(null,{resolve:w,reject:k});_.push(S),y.sendMessage(..._)})},Ye={devtools:{network:{onRequestFinished:x(O)}},runtime:{onMessage:x(C),onMessageExternal:x(C),sendMessage:j.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:j.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},re={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return i.privacy={network:{"*":re},services:{"*":re},websites:{"*":re}},v(n,Ye,i)};e.exports=r(chrome)}else e.exports=globalThis.browser})});var ve=ne((yt,V)=>{"use strict";V.exports.browser=se();var W;typeof browser>"u"&&typeof chrome<"u"&&chrome.runtime?/\bOPR\//.test(navigator.userAgent)?W="opera":W="chrome":/\bEdge\//.test(navigator.userAgent)?W="edge":W="firefox",V.exports.browserType=W,typeof V.exports.browser.action>"u"&&(V.exports.browser.action=V.exports.browser.browserAction),V.exports.isBrowser=(...e)=>{for(let t=0;t<e.length;t++)if(e[t]==V.exports.browserType)return!0;return!1},V.exports.error=e=>{console.groupCollapsed(e.message),e.stack&&console.error(e.stack),console.groupEnd()}});var Ee=ne((_t,Ce)=>{"use strict";var{browser:ae}=ve(),we={},be=new RegExp("\\$[a-zA-Z]*([0-9]+)\\$","g"),Te=!1,nt=ae.storage.local.get("wehI18nCustom").then(e=>{Te=!0;let t=e.wehI18nCustom;t&&Object.assign(we,t)});function it(e,t){if(Te||console.warn("Using `weh._` before custom strings were loaded:",e),/-/.test(e)){let n=e.replace(/-/g,"_");console.warn("Wrong i18n message name. Should it be",n,"instead of",e,"?"),e=n}let r=we[e];return t&&!Array.isArray(t)&&(t=[t]),r&&r.message.length>0?(r.message||"").replace(be,n=>{let i=be.exec(n);return i&&t&&t[parseInt(i[1])-1]||"??"}):t?ae.i18n.getMessage(e,t):ae.i18n.getMessage(e)}Ce.exports={getMessage:it,custom_strings_ready:nt}});var T=he(Ee(),1);function Me(e,t,r=document){let n=new CustomEvent(`reef:${e}`,{bubbles:!0,cancelable:!0,detail:t});return r.dispatchEvent(n)}function st(e){return typeof e=="string"?document.querySelector(e):e}var ke=["input","option","textarea"],K=["value","checked","selected"],Se=["checked","selected"];function Ne(e){return["false","null","undefined","0","-0","NaN","0n","-0n"].includes(e)}function Ie(e,t,r,n){if(!t.startsWith("on")||!n||e[t])return;let i=n[r.split("(")[0]];i&&(e[t]=i)}function Pe(e,t){let r=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!r.includes("javascript:")&&!r.includes("data:text/html"))||!!(e.startsWith("on")||e.startsWith("@on")||e.startsWith("#on"))||void 0}function Ve(e,t,r,n){Ie(e,t,r,n),Pe(t,r)||(K.includes(t)&&(e[t]=t==="value"?r:" "),e.setAttribute(t,r))}function Y(e,t){K.includes(t)&&(e[t]=""),e.removeAttribute(t)}function le(e,t){if(e.nodeType===1){for(let{name:r,value:n}of e.attributes){if(Pe(r,n)){Y(e,r),Ie(e,r,n,t);continue}if(!r.startsWith("@")&&!r.startsWith("#"))continue;let i=r.slice(1);Y(e,r),Se.includes(i)&&Ne(n)||Ve(e,i,n,t)}if(e.childNodes)for(let r of e.childNodes)le(r,t)}}function Oe(e){return e.childNodes&&e.childNodes.length?null:e.textContent}function ue(e,t,r){let n=e.childNodes,i=t.childNodes;(function(o){let s=o.querySelectorAll("script");for(let a of s)a.remove()})(e)||(n.forEach(function(o,s){if(!i[s]){let m=o.cloneNode(!0);return le(m,r),void t.append(m)}if(a=o,p=i[s],typeof a.nodeType=="number"&&a.nodeType!==p.nodeType||typeof a.tagName=="string"&&a.tagName!==p.tagName||typeof a.id=="string"&&a.id&&a.id!==p.id||"getAttribute"in a&&"getAttribute"in p&&a.getAttribute("key")!==p.getAttribute("key")||typeof a.src=="string"&&a.src&&a.src!==p.src){let m=function(f,v){if(f.nodeType!==1)return;let x=f.getAttribute("id"),O=f.getAttribute("key");if(!x||!O)return;let C=x?`#${x}`:`[key="${O}"]`;return v.querySelector(`:scope > ${C}`)}(o,t);if(!m){let f=o.cloneNode(!0);return le(f,r),void i[s].before(f)}i[s].before(m)}var a,p;if(n[s]&&"hasAttribute"in n[s]&&n[s].hasAttribute("reef-ignore")||(function(m,f,v){if(m.nodeType!==1)return;let x=m.attributes,O=f.attributes;for(let{name:C,value:H}of x){if(C.startsWith("#")||K.includes(C)&&ke.includes(m.tagName.toLowerCase()))continue;let j=C.startsWith("@")?C.slice(1):C;Se.includes(j)&&Ne(H)?Y(f,j):Ve(f,j,H,v)}for(let{name:C,value:H}of O)x[C]||K.includes(C)&&ke.includes(f.tagName.toLowerCase())||Y(f,C)}(o,i[s],r),o.nodeName.includes("-")))return;let l=Oe(o);if(l&&l!==Oe(i[s])&&(i[s].textContent=l),o.childNodes.length||!i[s].childNodes.length){if(!i[s].childNodes.length&&o.childNodes.length){let m=document.createDocumentFragment();return ue(o,m,r),void i[s].appendChild(m)}o.childNodes.length&&ue(o,i[s],r)}else i[s].innerHTML=""}),function(o,s){let a=o.length-s.length;if(!(a<1))for(;a>0;a--)o[o.length-1].remove()}(i,n))}function $e(e,t,r){let n=st(e),i=function(o){let s=new DOMParser().parseFromString(`<body><template>${o}</template></body>`,"text/html");return s.body?s.body.firstElementChild.content:document.createElement("body")}(t);Me("before-render",null,n)&&(ue(i,n,r),Me("render",null,n))}function $(e){var t=String(e);if(t==="[object Object]")try{t=JSON.stringify(e)}catch{}return t}var at=function(){function e(){}return e.prototype.isSome=function(){return!1},e.prototype.isNone=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(t){return t},e.prototype.expect=function(t){throw new Error("".concat(t))},e.prototype.unwrap=function(){throw new Error("Tried to unwrap None")},e.prototype.map=function(t){return this},e.prototype.mapOr=function(t,r){return t},e.prototype.mapOrElse=function(t,r){return t()},e.prototype.or=function(t){return t},e.prototype.orElse=function(t){return t()},e.prototype.andThen=function(t){return this},e.prototype.toResult=function(t){return E(t)},e.prototype.toString=function(){return"None"},e}(),d=new at;Object.freeze(d);var lt=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.isSome=function(){return!0},e.prototype.isNone=function(){return!1},e.prototype[Symbol.iterator]=function(){var t=Object(this.value);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(t){return this.value},e.prototype.expect=function(t){return this.value},e.prototype.unwrap=function(){return this.value},e.prototype.map=function(t){return A(t(this.value))},e.prototype.mapOr=function(t,r){return r(this.value)},e.prototype.mapOrElse=function(t,r){return r(this.value)},e.prototype.or=function(t){return this},e.prototype.orElse=function(t){return this},e.prototype.andThen=function(t){return t(this.value)},e.prototype.toResult=function(t){return h(this.value)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Some(".concat($(this.value),")")},e.EMPTY=new e(void 0),e}(),A=lt,F;(function(e){function t(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var s=[],a=0,p=i;a<p.length;a++){var l=p[a];if(l.isSome())s.push(l.value);else return l}return A(s)}e.all=t;function r(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var s=0,a=i;s<a.length;s++){var p=a[s];return p.isSome(),p}return d}e.any=r;function n(i){return i instanceof A||i===d}e.isOption=n})(F||(F={}));var ut=function(){function e(t){if(!(this instanceof e))return new e(t);this.error=t;var r=new Error().stack.split(`
`).slice(2);r&&r.length>0&&r[0].includes("ErrImpl")&&r.shift(),this._stack=r.join(`
`)}return e.prototype.isOk=function(){return!1},e.prototype.isErr=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(t){return t},e.prototype.unwrapOr=function(t){return t},e.prototype.expect=function(t){throw new Error("".concat(t," - Error: ").concat($(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.expectErr=function(t){return this.error},e.prototype.unwrap=function(){throw new Error("Tried to unwrap Error: ".concat($(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.unwrapErr=function(){return this.error},e.prototype.map=function(t){return this},e.prototype.andThen=function(t){return this},e.prototype.mapErr=function(t){return new E(t(this.error))},e.prototype.mapOr=function(t,r){return t},e.prototype.mapOrElse=function(t,r){return t(this.error)},e.prototype.or=function(t){return t},e.prototype.orElse=function(t){return t(this.error)},e.prototype.toOption=function(){return d},e.prototype.toString=function(){return"Err(".concat($(this.error),")")},Object.defineProperty(e.prototype,"stack",{get:function(){return"".concat(this,`
`).concat(this._stack)},enumerable:!1,configurable:!0}),e.prototype.toAsyncResult=function(){return new ce(this)},e.EMPTY=new e(void 0),e}();var E=ut,ct=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.isOk=function(){return!0},e.prototype.isErr=function(){return!1},e.prototype[Symbol.iterator]=function(){var t=Object(this.value);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(t){return this.value},e.prototype.unwrapOr=function(t){return this.value},e.prototype.expect=function(t){return this.value},e.prototype.expectErr=function(t){throw new Error(t)},e.prototype.unwrap=function(){return this.value},e.prototype.unwrapErr=function(){throw new Error("Tried to unwrap Ok: ".concat($(this.value)),{cause:this.value})},e.prototype.map=function(t){return new h(t(this.value))},e.prototype.andThen=function(t){return t(this.value)},e.prototype.mapErr=function(t){return this},e.prototype.mapOr=function(t,r){return r(this.value)},e.prototype.mapOrElse=function(t,r){return r(this.value)},e.prototype.or=function(t){return this},e.prototype.orElse=function(t){return this},e.prototype.toOption=function(){return A(this.value)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Ok(".concat($(this.value),")")},e.prototype.toAsyncResult=function(){return new ce(this)},e.EMPTY=new e(void 0),e}();var h=ct,Z;(function(e){function t(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];for(var p=[],l=0,m=s;l<m.length;l++){var f=m[l];if(f.isOk())p.push(f.value);else return f}return new h(p)}e.all=t;function r(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];for(var p=[],l=0,m=s;l<m.length;l++){var f=m[l];if(f.isOk())return f;p.push(f.error)}return new E(p)}e.any=r;function n(s){try{return new h(s())}catch(a){return new E(a)}}e.wrap=n;function i(s){try{return s().then(function(a){return new h(a)}).catch(function(a){return new E(a)})}catch(a){return Promise.resolve(new E(a))}}e.wrapAsync=i;function o(s){return s instanceof E||s instanceof h}e.isResult=o})(Z||(Z={}));var qe=function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(m){try{l(n.next(m))}catch(f){s(f)}}function p(m){try{l(n.throw(m))}catch(f){s(f)}}function l(m){m.done?o(m.value):i(m.value).then(a,p)}l((n=n.apply(e,t||[])).next())})},je=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(m){return p([l,m])}}function p(l){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(m){l=[6,m],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},ce=function(){function e(t){this.promise=Promise.resolve(t)}return e.prototype.andThen=function(t){var r=this;return this.thenInternal(function(n){return qe(r,void 0,void 0,function(){var i;return je(this,function(o){return n.isErr()?[2,n]:(i=t(n.value),[2,i instanceof e?i.promise:i])})})})},e.prototype.map=function(t){var r=this;return this.thenInternal(function(n){return qe(r,void 0,void 0,function(){var i;return je(this,function(o){switch(o.label){case 0:return n.isErr()?[2,n]:(i=h,[4,t(n.value)]);case 1:return[2,i.apply(void 0,[o.sent()])]}})})})},e.prototype.thenInternal=function(t){return new e(this.promise.then(t))},e}();function M(e){return Object.assign(e.prototype,{find:function(t){for(let r of this)if(t(r))return A(r);return d},count:function(t){return this.reduce((r,n)=>(t(n)&&r++,r),0)},reduce:function(t,r){let n=r;for(let i of this)n=t(n,i);return n},every:function(t){return!this.any(r=>!t(r))},any:function(t){for(let r of this)if(t(r))return!0;return!1},map:function(t){return this.filterMap(r=>A(t(r)))},filter:function(t){return this.filterMap(r=>t(r)?A(r):d)},enumerate:function(){let t=this;return M(function*(){let r=0;for(let n of t)yield[r,n],r++})()},filterMap:function(t){let r=this;return M(function*(){for(let n of r){let i=t(n);i.isSome()&&(yield i.unwrap())}})()},sort:function(t){let r=this.toArray();return r.sort(t),r},toArray:function(){return[...this]}}),e}Array.prototype.as_iter||(Array.prototype.as_iter=function(){let e=this;return M(function*(){for(let t of e)yield t})()});Set.prototype.as_iter||(Set.prototype.as_iter=function(){let e=this;return M(function*(){for(let t of e)yield t})()});Map.prototype.as_iter||(Map.prototype.as_iter=function(){let e=this;return M(function*(){for(let t of e)yield t})()});var G=he(se(),1);async function Le(e,t){return(await G.storage.local.get({[e]:t}))[e]}async function Fe(e){await G.storage.local.remove(e)}async function Re(e,t){await G.storage.local.set({[e]:t})}function He(e,t){G.storage.onChanged.addListener(r=>{e in r&&t()})}var Qe={240:{id:"240",loose_name:"Small"},360:{id:"360",loose_name:"SD"},480:{id:"480",loose_name:"SD"},720:{id:"720",loose_name:"HD"},1080:{id:"1080",loose_name:"FullHD"},1440:{id:"1440",loose_name:"UHD"},2160:{id:"2160",loose_name:"UHD"},4320:{id:"4320",loose_name:"UHD"}};function We(e,t){let r=parseInt(e),n=parseInt(t);return r<n}function Ue(e,t){let r=parseInt(e),n=parseInt(t);return r>n}var X=M(function*(){for(let e of Object.keys(Qe))yield e}),zt=M(function*(){for(let e of X())yield Qe[e]});function q(e){if(typeof e=="string")return X().find(t=>t==e);if(typeof e=="number"){let t=e.toString();return q(t)}return d}var R=/.^/,de={Av1:{name:"Av1",type:"video",mimetype:/av01.*/i,defacto_container:"WebM"},H264:{name:"H264",type:"video",mimetype:/avc1.*/i,defacto_container:"Mp4"},H263:{name:"H263",type:"video",mimetype:R,defacto_container:"3gp"},H265:{name:"H265",type:"video",mimetype:/(hvc1|hevc|h265|h\.265).*/i,defacto_container:"Mp4"},MP4V:{name:"MP4V",type:"video",mimetype:/mp4v\.20.*/i,defacto_container:"Mp4"},MPEG1:{name:"MPEG1",type:"video",mimetype:R,defacto_container:"Mpeg"},MPEG2:{name:"MPEG2",type:"video",mimetype:R,defacto_container:"Mpeg"},Theora:{name:"Theora",type:"video",mimetype:/theora/i,defacto_container:"Ogg"},VP8:{name:"VP8",type:"video",mimetype:/vp0?8.*/i,defacto_container:"WebM"},VP9:{name:"VP9",type:"video",mimetype:/vp0?9.*/i,defacto_container:"WebM"},unknown:{name:"unknown",type:"video",mimetype:R,defacto_container:"Mp4"}},ze={AAC:{name:"AAC",type:"audio",mimetype:/(aac|mp4a.40).*/i,defacto_container:"Mp4"},PCM:{name:"PCM",type:"audio",mimetype:/pcm.*/i,defacto_container:"Wav"},FLAC:{name:"FLAC",type:"audio",mimetype:/flac/i,defacto_container:"Flac"},MP3:{name:"MP3",type:"audio",mimetype:/(\.?mp3|mp4a\.69|mp4a\.6b).*/i,defacto_container:"Mpeg"},Opus:{name:"Opus",type:"audio",mimetype:/(opus|(mp4a\.ad.*))/i,defacto_container:"Ogg"},Vorbis:{name:"Vorbis",type:"audio",mimetype:/vorbis/i,defacto_container:"Ogg"},Wav:{name:"Wav",type:"audio",mimetype:R,defacto_container:"Wav"},unknown:{name:"unknown",type:"audio",mimetype:R,defacto_container:"Mp4"}},ee=M(function*(){for(let e of Object.keys(de))yield de[e]}),Ge=M(function*(){for(let e of Object.keys(ze))yield ze[e]});function me(e){return typeof e=="string"&&e in de?A(e):d}var te={M2TS:{name:"M2TS",extension:"mt2s",audio_only_extension:"mp3",defacto_codecs:{audio:d,video:d},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2","VP9","unknown"],supported_audio_codecs:["Opus","MP3","FLAC","AAC"],mimetype:/(?:x-)?flv/i},MP2T:{name:"MP2T",extension:"mp2t",audio_only_extension:"mp3",defacto_codecs:{audio:A("MP3"),video:A("H264")},supported_video_codecs:["MPEG2","MPEG1"],supported_audio_codecs:["MP3"],mimetype:/(?:x-)?mp2t/i},Flash:{name:"Flash",extension:"flv",audio_only_extension:"mp3",defacto_codecs:{audio:d,video:d},supported_video_codecs:["H264"],supported_audio_codecs:["AAC"],mimetype:/(?:x-)?flv/i},Mp4:{name:"Mp4",extension:"mp4",audio_only_extension:"mp3",defacto_codecs:{audio:d,video:d},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2","unknown"],supported_audio_codecs:["Opus","MP3","FLAC","AAC","unknown"],mimetype:/(?:x-)?mp4/i},M4V:{name:"M4V",extension:"m4v",audio_only_extension:"mp3",defacto_codecs:{audio:d,video:d},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2"],supported_audio_codecs:["Opus","MP3","FLAC","AAC"],mimetype:/(?:x-)?m4v/i},Flac:{name:"Flac",extension:"flac",audio_only_extension:"flac",defacto_codecs:{audio:A("FLAC"),video:d},supported_video_codecs:[],supported_audio_codecs:["FLAC"],mimetype:/(?:x-)?flac/i},Mpeg:{name:"Mpeg",extension:"mpeg",audio_only_extension:"mp3",defacto_codecs:{audio:A("MP3"),video:A("H264")},supported_video_codecs:["MPEG2","MPEG1"],supported_audio_codecs:["MP3"],mimetype:/(?:x-)?mpeg/i},Ogg:{name:"Ogg",extension:"ogv",audio_only_extension:"oga",defacto_codecs:{audio:d,video:d},supported_video_codecs:["VP9","VP8","Theora"],supported_audio_codecs:["Opus","Vorbis","FLAC"],mimetype:/(?:x-)?og./i},Wav:{name:"Wav",extension:"wav",audio_only_extension:"wav",defacto_codecs:{audio:A("Wav"),video:d},supported_video_codecs:[],supported_audio_codecs:["Wav","PCM"],mimetype:/(?:x-)?(?:pn-)?wave?/i},Mkv:{name:"Mkv",extension:"mkv",audio_only_extension:"mp3",defacto_codecs:{audio:d,video:d},supported_video_codecs:ee().filter(e=>e.name!="unknown").map(e=>e.name).toArray(),supported_audio_codecs:Ge().filter(e=>e.name!="unknown").map(e=>e.name).toArray(),mimetype:/(?:x-)?matroska/i},"3gp":{name:"3gp",extension:"3gpp",audio_only_extension:"mp3",defacto_codecs:{audio:d,video:d},supported_video_codecs:["H264","H263","MP4V","VP8"],supported_audio_codecs:["MP3","AAC"],mimetype:/(?:x-)?3gpp2?/i},QuickTime:{name:"QuickTime",extension:"mov",audio_only_extension:"mp3",defacto_codecs:{audio:d,video:d},supported_video_codecs:["MPEG1","MPEG2"],supported_audio_codecs:[],mimetype:/(?:x-)?mov/i},WebM:{name:"WebM",extension:"webm",audio_only_extension:"oga",defacto_codecs:{audio:d,video:d},supported_video_codecs:["H264","VP8","VP9","Av1"],supported_audio_codecs:["Opus","Vorbis"],mimetype:/(?:x-)?webm/i}},pe=M(function*(){for(let e of Object.keys(te))yield e}),Je=M(function*(){for(let e of pe())yield te[e]});function fe(e){return typeof e=="string"&&e in te?A(e):d}function ge(e){return te[e]}var De=(e,t)=>typeof e[t]=="string";function J(e){try{if(De(e,"__serializer_tag")){if(e.__serializer_tag==="primitive")return h(e.__serializer_value);if(e.__serializer_tag==="array"){let n=[];for(let i of e.__serializer_value){let o=J(i);if(o.isErr())return o;n.push(o.unwrap())}return h(n)}else if(e.__serializer_tag==="option_some"){let n=e.__serializer_value,i=J(n);return i.isErr()?i:h(A(i.unwrap()))}else if(e.__serializer_tag==="option_none")return h(d)}let t=typeof e;if(t==="string"||t==="number"||t==="boolean"||t==="undefined"||Array.isArray(e)||e==null)return E("This object was not serialized with Serialize");let r={};for(let n of Object.keys(e))if(typeof n=="string"){let i=J(e[n]);if(i.isErr())return i;r[n]=i.unwrap()}return h(r)}catch{return E("Failed to inspect object. Not JSON?")}}function D(e){let t=typeof e;if(t==="string"||t==="number"||t==="boolean"||t==="undefined"||e==null)return h({__serializer_tag:"primitive",__serializer_value:e});if(Array.isArray(e)){let r=e.map(o=>D(o)),n=r.as_iter().find(o=>o.isErr());if(n.isSome())return n.unwrap();let i=r.as_iter().map(o=>o.unwrap()).toArray();return h({__serializer_tag:"array",__serializer_value:i})}else if(F.isOption(e))if(e.isSome()){let r=e.unwrap(),n=D(r);return n.isErr()?n:h({__serializer_tag:"option_some",__serializer_value:n.unwrap()})}else return h({__serializer_tag:"option_none"});else if(t==="object"){let r={},n=e;for(let i of Object.keys(e)){let o=n[i],s=D(o);if(s.isErr())continue;let a=s.unwrap();r[i]=a}return h(r)}else return E("Unsupported value")}var B="user_media_preferences";function dt(){return{prefer_60fps:!0,ignore_low_quality_hits:!0,max_variants:3,container:"Mp4",video_codec:"H264",best_video_quality:"4320",lowest_video_quality:"480",ignored_containers:[],ignored_video_codecs:[]}}function Be(e){return D(e).unwrap()}function Ke(e){let t=J(e).unwrapOr({}),r=dt(),n=fe(t.container).unwrapOr(r.container),i=me(t.video_codec).unwrapOr(r.video_codec),o=q(t.best_video_quality).unwrapOr(r.best_video_quality),s=q(t.lowest_video_quality).unwrapOr(r.lowest_video_quality),a=r.max_variants;if(typeof t.max_variants=="number"){let v=t.max_variants;Number.isInteger(v)&&v<=11&&v>0&&(a=v)}let p=r.prefer_60fps;typeof t.prefer_60fps=="boolean"&&(p=t.prefer_60fps);let l=r.ignore_low_quality_hits;typeof t.ignore_low_quality_hits=="boolean"&&(l=t.ignore_low_quality_hits);let m=[];if(Array.isArray(t.ignored_containers))for(let v of t.ignored_containers){let x=fe(v);x.isSome()&&m.push(x.unwrap())}let f=[];if(Array.isArray(t.ignored_video_codecs))for(let v of t.ignored_video_codecs){let x=me(v);x.isSome()&&f.push(x.unwrap())}return{prefer_60fps:p,ignore_low_quality_hits:l,container:n,max_variants:a,video_codec:i,lowest_video_quality:s,best_video_quality:o,ignored_containers:m,ignored_video_codecs:f}}{await new Promise(e=>{document.readyState=="loading"?window.addEventListener("DOMContentLoaded",()=>e()):e()}),await T.custom_strings_ready,document.title=(0,T.getMessage)("mup_page_title");for(let e of Array.from(document.querySelectorAll("[data-i18n]")))e.textContent=(0,T.getMessage)(e.dataset.i18n)}var ye=null,mt=()=>{ye&&clearTimeout(ye);let e=document.querySelector("#saved-toaster");e.classList.remove("hidden"),ye=window.setTimeout(()=>{e.classList.add("hidden")},1e3)},pt=e=>{let t="",r="";r+=`
    <div>
      <label for="max-variant-input">${(0,T.getMessage)("mup_max_variants")}:</label>
      <input type="number" step="1" size="3" id="max-variant-input" min="1" max="10" @value="${e.max_variants}"/>
      <br><em>${(0,T.getMessage)("mup_max_variants_help")}</em>
    </div>`,r+=`
    <div>
      <label for="prefer-60fps-input">${(0,T.getMessage)("mup_prefer_60fps")}:</label>
      <input type="checkbox" id="prefer-60fps-input" @checked="${e.prefer_60fps}"/>
    </div>`,r+=`
    <div>
      <label for="ignore-low-quality-hits-input">${(0,T.getMessage)("mup_ignore_low_quality")}:</label>
      <input type="checkbox" id="ignore-low-quality-hits-input" @checked="${e.ignore_low_quality_hits}"/>
      <br><em>${(0,T.getMessage)("mup_ignore_low_quality_help")}</em>
    </div>`;{let n=Je().filter(i=>i.supported_video_codecs.length>0);for(let i of n){let o=i.name==e.container?"selected":"";t+=`<option value="${i.name}" ${o}>${i.name}</option>`}r+=`
    <div>
      <label for="container-select">${(0,T.getMessage)("mup_prefered_container")}:</label>
      <select id="container-select" value="${e.container}">
        ${t}
      </select>
    </div>`}{let n="",i=ge(e.container);for(let o of i.supported_video_codecs){let s=e.video_codec==o?"selected":"";n+=`<option value="${o}" ${s}>${o}</option>`}r+=`
    <div>
      <label for="codec-select-${e.container}">${(0,T.getMessage)("mup_prefered_video_codecs")}:</label>
      <select class="codec-select" id="codec-select-${e.container}" value="${e.video_codec}">
        ${n}
      </select>
    </div>`}{let n="",i="";for(let o of X()){let s=e.lowest_video_quality==o?"selected":"",a=We(o,e.best_video_quality)?"":"disabled";n=`<option value="${o}" ${a} ${s}>${o}p</option>`+n,s=e.best_video_quality==o?"selected":"",a=Ue(o,e.lowest_video_quality)?"":"disabled",i=`<option value="${o}" ${a} ${s}>${o}p</option>`+i}r+=`
    <div>
      <label for="best-video-quality-select">${(0,T.getMessage)("mup_best_video_quality")}:</label>
      <select id="best-video-quality-select" value="${e.best_video_quality}">
         ${i}
      </select>
    </div>
    <div>
      <label for="lowest-video-quality-select">${(0,T.getMessage)("mup_lowest_video_quality")}:</label>
      <select id="lowest-video-quality-select" value="${e.lowest_video_quality}">
        ${n}
      </select>
    </div>`}{let n=pe().map(o=>{let s=e.ignored_containers.as_iter().any(a=>a==o);return`
        <div>
          <input type="checkbox" data-container="${o}" id="ignored_container_${o}" @checked="${s}"/>
          <label for="ignored_container_${o}">${o}</label>
        </div>`}).toArray().join(""),i=ee().map(o=>{let s=e.ignored_video_codecs.as_iter().any(a=>a==o.name);return`
        <div>
          <input type="checkbox" data-video-codec="${o.name}" id="ignored_codec_${o.name}" @checked="${s}"/>
          <label for="ignored_codec_${o.name}">${o.name}</label>
        </div>`}).toArray().join("");r+=`
      <vbox>
        <fieldset id="ignored-containers-fieldset">
          <legend>${(0,T.getMessage)("mup_ignored_containers")}:</legend>
          ${n}
        </fieldset>
        <fieldset id="ignored-video-codecs-fieldset">
          <legend>${(0,T.getMessage)("mup_ignored_video_codecs")}:</legend>
          ${i}
        </fieldset>
      </vbox>
    `}$e("section",r)},_e=class{constructor(){He(B,()=>{mt(),this.read_from_storage()}),this.is_ready_p=this.read_from_storage()}async is_ready(){return await this.is_ready_p,this}async read_from_storage(){this.state=Ke(await Le(B,{})),pt(this.state)}async reset(){await Fe(B)}async write_to_storage(){return Re(B,Be(this.state))}async set_max_variants(t){Number.isInteger(t)&&t<=10&&t>0&&(this.state.max_variants=t,await this.write_to_storage())}async set_prefer_60fps(t){this.state.prefer_60fps=t,await this.write_to_storage()}async set_ignore_low_quality_hits(t){this.state.ignore_low_quality_hits=t,await this.write_to_storage()}async set_lowest_video_quality(t){this.state.lowest_video_quality=t,await this.write_to_storage()}async set_best_video_quality(t){this.state.best_video_quality=t,await this.write_to_storage()}async set_video_codec(t){this.state.video_codec=t,await this.write_to_storage()}async set_ignored_containers(t){this.state.ignored_containers=t,await this.write_to_storage()}async set_ignored_video_codecs(t){this.state.ignored_video_codecs=t,await this.write_to_storage()}async set_container(t){if(this.state.container==t)return;this.state.container=t;let n=ge(t).supported_video_codecs[0];if(n)this.state.video_codec=n;else throw new Error("Unexpected container.");await this.write_to_storage()}},P=await new _e().is_ready();{let e=function(t){let r=t.target;if(r){let n=r.closest("#container-select"),i=r.closest(".codec-select"),o=r.closest("#lowest-video-quality-select"),s=r.closest("#best-video-quality-select"),a=r.closest("#ignored-containers-fieldset"),p=r.closest("#ignored-video-codecs-fieldset"),l=r.closest("#max-variant-input"),m=r.closest("#prefer-60fps-input"),f=r.closest("#ignore-low-quality-hits-input");if(n)P.set_container(n.value);else if(i)P.set_video_codec(i.value);else if(o)P.set_lowest_video_quality(q(o.value).unwrap());else if(s)P.set_best_video_quality(q(s.value).unwrap());else if(a){let x=Array.from(a.querySelectorAll("input")).as_iter().filterMap(O=>O.checked?A(O.dataset.container):d).toArray();P.set_ignored_containers(x)}else if(p){let x=Array.from(p.querySelectorAll("input")).as_iter().filterMap(O=>O.checked?A(O.dataset.videoCodec):d).toArray();P.set_ignored_video_codecs(x)}else l?P.set_max_variants(parseInt(l.value)):m?P.set_prefer_60fps(m.checked):f&&P.set_ignore_low_quality_hits(f.checked)}};ft=e,window.addEventListener("input",e),window.addEventListener("change",e),window.addEventListener("click",t=>{let r=t.target;r&&r.closest("#reset_button")&&P.reset()})}var ft;
/*! Bundled license information:

reefjs/dist/reef.es.min.js:
  (*! reef v13.0.2 | (c) 2023 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef *)
*/
