"use strict";(()=>{var N_=Object.create;var _n=Object.defineProperty;var C_=Object.getOwnPropertyDescriptor;var q_=Object.getOwnPropertyNames;var k_=Object.getPrototypeOf,B_=Object.prototype.hasOwnProperty;var I=(e,t)=>()=>(e&&(t=e(e=0)),t);var m=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Z=(e,t)=>{for(var r in t)_n(e,r,{get:t[r],enumerable:!0})},dp=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of q_(t))!B_.call(e,n)&&n!==r&&_n(e,n,{get:()=>t[n],enumerable:!(i=C_(t,n))||i.enumerable});return e};var wn=(e,t,r)=>(r=e!=null?N_(k_(e)):{},dp(t||!e||!e.__esModule?_n(r,"default",{value:e,enumerable:!0}):r,e)),P=e=>dp(_n({},"__esModule",{value:!0}),e);var fp=m(()=>{"use strict"});var ts=m((es,mp)=>{(function(e,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof es<"u")t(mp);else{var r={exports:{}};t(r),e.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:es,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=i=>{let n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(n).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(S,x=void 0){super(x),this.createItem=S}get(S){return this.has(S)||this.set(S,this.createItem(S)),super.get(S)}}let a=w=>w&&typeof w=="object"&&typeof w.then=="function",s=(w,S)=>(...x)=>{i.runtime.lastError?w.reject(new Error(i.runtime.lastError.message)):S.singleCallbackArg||x.length<=1&&S.singleCallbackArg!==!1?w.resolve(x[0]):w.resolve(x)},u=w=>w==1?"argument":"arguments",l=(w,S)=>function(O,...D){if(D.length<S.minArgs)throw new Error(`Expected at least ${S.minArgs} ${u(S.minArgs)} for ${w}(), got ${D.length}`);if(D.length>S.maxArgs)throw new Error(`Expected at most ${S.maxArgs} ${u(S.maxArgs)} for ${w}(), got ${D.length}`);return new Promise((N,B)=>{if(S.fallbackToNoCallback)try{O[w](...D,s({resolve:N,reject:B},S))}catch(q){console.warn(`${w} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,q),O[w](...D),S.fallbackToNoCallback=!1,S.noCallback=!0,N()}else S.noCallback?(O[w](...D),N()):O[w](...D,s({resolve:N,reject:B},S))})},p=(w,S,x)=>new Proxy(S,{apply(O,D,N){return x.call(D,w,...N)}}),c=Function.call.bind(Object.prototype.hasOwnProperty),g=(w,S={},x={})=>{let O=Object.create(null),D={has(B,q){return q in w||q in O},get(B,q,W){if(q in O)return O[q];if(!(q in w))return;let V=w[q];if(typeof V=="function")if(typeof S[q]=="function")V=p(w,w[q],S[q]);else if(c(x,q)){let ee=l(q,x[q]);V=p(w,w[q],ee)}else V=V.bind(w);else if(typeof V=="object"&&V!==null&&(c(S,q)||c(x,q)))V=g(V,S[q],x[q]);else if(c(x,"*"))V=g(V,S[q],x["*"]);else return Object.defineProperty(O,q,{configurable:!0,enumerable:!0,get(){return w[q]},set(ee){w[q]=ee}}),V;return O[q]=V,V},set(B,q,W,V){return q in O?O[q]=W:w[q]=W,!0},defineProperty(B,q,W){return Reflect.defineProperty(O,q,W)},deleteProperty(B,q){return Reflect.deleteProperty(O,q)}},N=Object.create(w);return new Proxy(N,D)},b=w=>({addListener(S,x,...O){S.addListener(w.get(x),...O)},hasListener(S,x){return S.hasListener(w.get(x))},removeListener(S,x){S.removeListener(w.get(x))}}),d=new o(w=>typeof w!="function"?w:function(x){let O=g(x,{},{getContent:{minArgs:0,maxArgs:0}});w(O)}),A=new o(w=>typeof w!="function"?w:function(x,O,D){let N=!1,B,q=new Promise(Pe=>{B=function(ae){N=!0,Pe(ae)}}),W;try{W=w(x,O,B)}catch(Pe){W=Promise.reject(Pe)}let V=W!==!0&&a(W);if(W!==!0&&!V&&!N)return!1;let ee=Pe=>{Pe.then(ae=>{D(ae)},ae=>{let Er;ae&&(ae instanceof Error||typeof ae.message=="string")?Er=ae.message:Er="An unexpected error occurred",D({__mozWebExtensionPolyfillReject__:!0,message:Er})}).catch(ae=>{console.error("Failed to send onMessage rejected reply",ae)})};return ee(V?W:q),!0}),f=({reject:w,resolve:S},x)=>{i.runtime.lastError?i.runtime.lastError.message===t?S():w(new Error(i.runtime.lastError.message)):x&&x.__mozWebExtensionPolyfillReject__?w(new Error(x.message)):S(x)},h=(w,S,x,...O)=>{if(O.length<S.minArgs)throw new Error(`Expected at least ${S.minArgs} ${u(S.minArgs)} for ${w}(), got ${O.length}`);if(O.length>S.maxArgs)throw new Error(`Expected at most ${S.maxArgs} ${u(S.maxArgs)} for ${w}(), got ${O.length}`);return new Promise((D,N)=>{let B=f.bind(null,{resolve:D,reject:N});O.push(B),x.sendMessage(...O)})},y={devtools:{network:{onRequestFinished:b(d)}},runtime:{onMessage:b(A),onMessageExternal:b(A),sendMessage:h.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:h.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},T={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":T},services:{"*":T},websites:{"*":T}},g(i,y,n)};e.exports=r(chrome)}else e.exports=globalThis.browser})});var Sr=m((lM,lt)=>{"use strict";lt.exports.browser=ts();var bi;typeof browser>"u"&&typeof chrome<"u"&&chrome.runtime?/\bOPR\//.test(navigator.userAgent)?bi="opera":bi="chrome":/\bEdge\//.test(navigator.userAgent)?bi="edge":bi="firefox",lt.exports.browserType=bi,typeof lt.exports.browser.action>"u"&&(lt.exports.browser.action=lt.exports.browser.browserAction),lt.exports.isBrowser=(...e)=>{for(let t=0;t<e.length;t++)if(e[t]==lt.exports.browserType)return!0;return!1},lt.exports.error=e=>{console.groupCollapsed(e.message),e.stack&&console.error(e.stack),console.groupEnd()}});var Mt=m((cM,gp)=>{"use strict";var rs=class{constructor(){this.replyId=0,this.replies={},this.listeners={},this.hook=this.nullHook,this.debugLevel=0,this.useTarget=!1,this.logger=console,this.posts={}}setPost(t,r){typeof t=="string"?this.posts[t]=r:this.post=t}setUseTarget(t){this.useTarget=t}setDebugLevel(t){this.debugLevel=t}setHook(t){let r=this,i=Date.now();function n(){return typeof window<"u"&&typeof window.performance<"u"?window.performance.now():Date.now()-i}t?this.hook=o=>{o.timestamp=n();try{t(o)}catch(a){r.logger.warn("Hoor error",a)}}:this.hook=this.nullHook}nullHook(){}call(){let t=this,r,i,n,o,a=Array.prototype.slice.call(arguments);return typeof a[0]=="function"&&(r=a.shift()),t.useTarget?[i,n,...o]=a:[n,...o]=a,new Promise(function(s,u){let l=++t.replyId;t.debugLevel>=2&&t.logger.info("rpc #"+l,"call =>",n,o),t.hook({type:"call",callee:i,rid:l,method:n,args:o}),t.replies[l]={resolve:s,reject:u,peer:i};let p=r||t.useTarget&&t.posts[i]||t.post;t.useTarget?p(i,{type:"weh#rpc",_request:l,_method:n,_args:[...o]}):p({type:"weh#rpc",_request:l,_method:n,_args:[...o]})})}receive(t,r,i){let n=this;if(t._request)Promise.resolve().then(()=>{let o=n.listeners[t._method];if(typeof o=="function")return n.debugLevel>=2&&n.logger.info("rpc #"+t._request,"serve <= ",t._method,t._args),n.hook({type:"call",caller:i,rid:t._request,method:t._method,args:t._args}),Promise.resolve(o.apply(null,t._args)).then(a=>(n.hook({type:"reply",caller:i,rid:t._request,result:a}),a)).catch(a=>{throw n.hook({type:"reply",caller:i,rid:t._request,error:a.message}),a});throw new Error("Method "+t._method+" is not a function")}).then(o=>{n.debugLevel>=2&&n.logger.info("rpc #"+t._request,"serve => ",o),r({type:"weh#rpc",_reply:t._request,_result:o})}).catch(o=>{n.debugLevel>=1&&n.logger.info("rpc #"+t._request,"serve => !",o.message),r({type:"weh#rpc",_reply:t._request,_error:o.message})});else if(t._reply){let o=n.replies[t._reply];delete n.replies[t._reply],o?t._error?(n.debugLevel>=1&&n.logger.info("rpc #"+t._reply,"call <= !",t._error),n.hook({type:"reply",callee:o.peer,rid:t._reply,error:t._error}),o.reject(new Error(t._error))):(n.debugLevel>=2&&n.logger.info("rpc #"+t._reply,"call <= ",t._result),n.hook({type:"reply",callee:o.peer,rid:t._reply,result:t._result}),o.resolve(t._result)):n.logger.error("Missing reply handler")}}listen(t){Object.assign(this.listeners,t)}};gp.exports=new rs});var ns=m((pM,bp)=>{"use strict";var{browser:is}=Sr(),yp={},hp=new RegExp("\\$[a-zA-Z]*([0-9]+)\\$","g"),vp=!1,F_=is.storage.local.get("wehI18nCustom").then(e=>{vp=!0;let t=e.wehI18nCustom;t&&Object.assign(yp,t)});function V_(e,t){if(vp||console.warn("Using `weh._` before custom strings were loaded:",e),/-/.test(e)){let i=e.replace(/-/g,"_");console.warn("Wrong i18n message name. Should it be",i,"instead of",e,"?"),e=i}let r=yp[e];return t&&!Array.isArray(t)&&(t=[t]),r&&r.message.length>0?(r.message||"").replace(hp,i=>{let n=hp.exec(i);return n&&t&&t[parseInt(n[1])-1]||"??"}):t?is.i18n.getMessage(e,t):is.i18n.getMessage(e)}bp.exports={getMessage:V_,custom_strings_ready:F_}});var wp=m((dM,_p)=>{"use strict";var Ai=Sr(),H_=Mt(),X=Ai.browser,_i={},xn={};function Ap(e,t){let r=!1;return new Promise(function(i,n){return X.tabs.query({}).then(function(o){o.forEach(function(a){a.url===e&&(X.tabs.update(a.id,{active:!0}),X.windows.update(a.windowId,{focused:!0}),r=!0)}),i(r)})})}function j_(e,t){return new Promise((r,i)=>{let n=X.runtime.getURL(t.url+"?panel="+e);Ap(n).then(function(o){if(!o)return X.tabs.create({url:n}).then(function(a){Ai.__declareAppTab(e,{tab:a.id,initData:t.initData}),_i[e]={type:"tab",tabId:a.id},xn[a.id]=e})}).then(r).catch(i)})}function L_(e,t){return new Promise((r,i)=>{let n=X.runtime.getURL(t.url+"?panel="+e);X.windows.getCurrent().then(o=>{let a=t.width||500,s=t.height||400,u={url:n,width:a,height:s,type:"popup",left:Math.round((o.width-a)/2+o.left),top:Math.round((o.height-s)/2+o.top)};return Ai.isBrowser("chrome","opera")&&(u.focused=!0),X.windows.create(u).then(l=>(_i[e]={type:"window",windowId:l.id},Promise.all([l,X.windows.update(l.id,{focused:!0})]))).then(([l])=>{Promise.resolve().then(()=>{if(!(t.initData&&t.initData.autoResize))return X.windows.update(l.id,{height:l.height+1}).then(()=>X.windows.update(l.id,{height:l.height-1}))}).then(()=>{let g=new Promise((d,A)=>{let f;function h(y){y.windowId==l.id&&(clearTimeout(f),X.tabs.onCreated.removeListener(h),d(y))}f=setTimeout(()=>{X.tabs.onCreated.removeListener(h),A(new Error("Tab did not open"))},5e3),X.tabs.onCreated.addListener(h)}),b=X.tabs.query({windowId:l.id}).then(d=>new Promise((A,f)=>{d.length>0&&A(d[0])}));return Promise.race([g,b])}).then(g=>g.status=="loading"?new Promise((b,d)=>{let A;function f(h,y,T){h==g.id&&T.status=="complete"&&(clearTimeout(A),X.tabs.onUpdated.removeListener(f),b(T))}A=setTimeout(()=>{X.tabs.onUpdated.removeListener(f),d(new Error("Tab did not complete"))},6e4),X.tabs.onUpdated.addListener(f)}):g).then(g=>{Ai.__declareAppTab(e,{tab:g.id,initData:t.initData}),xn[g.id]=e}).then(r).catch(i);function p(g){g!=l.id&&t.autoClose&&X.windows.getCurrent().then(b=>{b.id!=l.id&&X.windows.remove(l.id).then(()=>{},()=>{})})}function c(g){g==l.id&&(X.windows.onFocusChanged.removeListener(p),X.windows.onFocusChanged.removeListener(c))}X.windows.onFocusChanged.addListener(p),X.windows.onRemoved.addListener(c)}).catch(i)}).catch(i)})}function U_(e,t){return new Promise((r,i)=>{let n=X.runtime.getURL(t.url+"?panel="+e);Ap(n).then(o=>{if(!o)return L_(e,t)}).then(r).catch(i)})}function W_(e,t){switch(t.type){case"panel":return U_(e,t);case"tab":default:return j_(e,t)}}X.tabs.onRemoved.addListener(e=>{Ai.__closeByTab(e);let t=xn[e];t&&(delete xn[e],delete _i[t])});function G_(e){let t=_i[e];t&&t.type=="tab"?X.tabs.remove(t.tabId):t&&t.type=="window"?X.windows.remove(t.windowId):H_.call(e,"close")}function X_(e){return!!_i[e]}_p.exports={open:W_,close:G_,isOpen:X_}});var ss=m((fM,Tp)=>{"use strict";var os=ns().getMessage,xp={};function Ep(){this.$specs={},this.$values=null,this.$values||(this.$values={}),this.$listeners={}}Ep.prototype={notify:function(e,t,r,i){let n=this,o=e.split("."),a=[];for(let s=o.length;s>=0;s--)a.push(o.slice(0,s).join("."));a.forEach(function(s){let u=n.$listeners[s];u&&u.forEach(function(l){if(l.specs==i)if(l.pack)l.pack[e]=t,typeof l.old[e]>"u"&&(l.old[e]=r),l.timer&&clearTimeout(l.timer),l.timer=setTimeout(function(){delete l.timer;let p=l.pack,c=l.old;l.pack={},l.old={};try{l.callback(p,c)}catch{}},0);else try{l.callback(e,t,r)}catch{}})})},forceNotify:function(e){typeof e>"u"&&(e=!1);let t=this;Object.keys(t.$specs).forEach(r=>{t.notify(r,t.$values[r],t.$values[r],e)})},declare:function(e){let t=this;Array.isArray(e)||(e=Object.keys(e).map(function(r){let i=e[r];return i.name=r,i})),e.forEach(function(r){if(xp[r.name])throw new Error("Forbidden prefs key "+r.name);let i;r.hidden?(r.label=r.name,r.description=""):(i=r.name.replace(/[^0-9a-zA-Z_]/g,"_"),r.label=r.label||os("weh_prefs_label_"+i)||r.name,r.description=r.description||os("weh_prefs_description_"+i)||""),r.type=="choice"&&(r.choices=(r.choices||[]).map(function(a){if(typeof a=="object")return a;if(r.hidden)return{value:a,name:a};{let s=a.replace(/[^0-9a-zA-Z_]/g,"_");return{value:a,name:os("weh_prefs_"+i+"_option_"+s)||a}}}));let n=null;t.$specs[r.name]||function(a){typeof t[r.name]<"u"&&(n=t[r.name]),Object.defineProperty(t,a,{set:function(s){let u=t.$values[a];u!==s&&(t.$values[a]=s,t.notify(a,s,u,!1))},get:function(){return t.$values[a]!==void 0?t.$values[a]:t.$specs[a]&&t.$specs[a].defaultValue||void 0}})}(r.name);let o=t.$specs[r.name];t.$specs[r.name]=r,n!==null?t.$values[r.name]=n:typeof t.$values[r.name]>"u"&&(t.$values[r.name]=r.defaultValue),t.notify(r.name,r,o,!0)})},on:function(){let e="",t={},r=0;typeof arguments[r]=="string"&&(e=arguments[r++]),typeof arguments[r]=="object"&&(t=arguments[r++]);let i=arguments[r],n=!!t.pack;this.$listeners[e]||(this.$listeners[e]=[]);let o={callback:i,specs:!!t.specs};n&&(o.pack={},o.old={}),this.$listeners[e].push(o)},off:function(){let e="",t=0;typeof arguments[t]=="string"&&(e=arguments[t++]);let r=arguments[t],i=this.$listeners[e];if(i)for(let n=i.length-1;n>=0;n--)(!r||i[n]==r)&&i.splice(n,1)},getAll:function(){return Object.assign({},this.$values)},getSpecs:function(){return Object.assign({},this.$specs)},assign:function(e){for(let t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},isValid:function(e,t){let r=this.$specs[e];if(r){switch(r.type){case"string":if(r.regexp&&!new RegExp(r.regexp).test(t))return!1;break;case"integer":if(!/^-?[0-9]+$/.test(t)||isNaN(parseInt(t)))return!1;case"float":if(r.type=="float"&&(!/^-?[0-9]+(\.[0-9]+)?|(\.[0-9]+)$/.test(t)||isNaN(parseFloat(t)))||typeof r.minimum<"u"&&t<r.minimum||typeof r.maximum<"u"&&t>r.maximum)return!1;break;case"choice":{let i=!1;if((r.choices||[]).forEach(n=>{t==n.value&&(i=!0)}),!i)return!1}break}return!0}},reducer:function(e={},t){switch(t.type){case"weh.SET_PREFS":e=Object.assign({},e,t.payload);break}return e},reduxDispatch(e){this.on("",{pack:!0},t=>{e.dispatch({type:"weh.SET_PREFS",payload:t})})}};var as=new Ep;for(let e in as)as.hasOwnProperty(e)&&(xp[e]=!0);Tp.exports=as});var Op=m((mM,Sp)=>{"use strict";Sp.exports=[{name:"networkProbe",type:"boolean",defaultValue:!0},{name:"titleMode",type:"choice",defaultValue:"right",choices:["right","left","multiline"]},{name:"iconActivation",type:"choice",defaultValue:"currenttab",choices:["currenttab","anytab"]},{name:"iconBadge",type:"choice",defaultValue:"tasks",choices:["none","tasks","activetab","anytab","pinned","mixed"]},{name:"hitsGotoTab",type:"boolean",defaultValue:!0},{name:"default-action-0",type:"string",defaultValue:"quickdownload",hidden:!0},{name:"default-action-1",type:"string",defaultValue:"openlocalfile",hidden:!0},{name:"default-action-2",type:"string",defaultValue:"abort",hidden:!0},{name:"smartnamerFnameSpaces",type:"choice",defaultValue:"keep",choices:["keep","remove","hyphen","underscore"]},{name:"smartnamerFnameMaxlen",type:"integer",defaultValue:64,minimum:12,maximum:256},{name:"downloadControlledMax",type:"integer",defaultValue:6,minimum:0},{name:"downloadStreamControlledMax",type:"integer",defaultValue:6,minimum:0},{name:"autoPin",type:"boolean",defaultValue:!1},{name:"mediaExtensions",type:"string",defaultValue:"flv|ram|mpg|mpeg|avi|rm|wmv|mov|asf|mp3|rar|movie|divx|rbs|mp4|mpeg4"},{name:"dashHideM4s",type:"boolean",defaultValue:!0},{name:"mpegtsHideTs",type:"boolean",defaultValue:!0},{name:"orphanExpiration",type:"integer",defaultValue:60,minimum:0},{name:"chunksEnabled",type:"boolean",defaultValue:!0},{name:"hlsEnabled",type:"boolean",defaultValue:!0},{name:"dashEnabled",type:"boolean",defaultValue:!0},{name:"dashOnAdp",type:"choice",defaultValue:"audio_video",choices:["audio","video","audio_video"]},{name:"hlsDownloadAsM2ts",type:"boolean",defaultValue:!1},{name:"networkFilterOut",type:"string",defaultValue:"/frag\\\\([0-9]+\\\\)/|[&\\\\?]range=[0-9]+-[0-9]+|/silverlight/"},{name:"mediaweightThreshold",type:"integer",defaultValue:2097152},{name:"mediaweightMinSize",type:"integer",defaultValue:8192},{name:"tbvwsEnabled",type:"boolean",defaultValue:!0,hidden:!0},{name:"converterThreads",type:"string",defaultValue:"auto"},{name:"converterAggregTuneH264",type:"boolean",defaultValue:!1},{name:"notifyReady",type:"boolean",defaultValue:!0},{name:"noPrivateNotification",type:"boolean",defaultValue:!0},{name:"avplayEnabled",type:"boolean",defaultValue:!0},{name:"blacklistEnabled",type:"boolean",defaultValue:!0},{name:"chunksConcurrentDownloads",type:"integer",defaultValue:4},{name:"chunksPrefetchCount",type:"integer",defaultValue:4},{name:"downloadRetries",type:"integer",defaultValue:3},{name:"downloadRetryDelay",type:"integer",defaultValue:1e3},{name:"mpegtsSaveRaw",type:"boolean",defaultValue:!1,hidden:!0},{name:"mpegtsSaveRawStreams",type:"boolean",defaultValue:!1,hidden:!0},{name:"mpegtsEndsOnSeenChunk",type:"boolean",defaultValue:!0,hidden:!0},{name:"converterKeepTmpFiles",type:"boolean",defaultValue:!1},{name:"backgroundReduxLogger",type:"boolean",defaultValue:!1,hidden:!0},{name:"dlconvLastOutput",type:"string",defaultValue:"",hidden:!0},{name:"qrMessageNotAgain",type:"boolean",defaultValue:!1,hidden:!0},{name:"coappShellEnabled",type:"boolean",defaultValue:!1,hidden:!0},{name:"downloadCount",type:"integer",defaultValue:0,hidden:!0},{name:"donateNotAgainExpire",type:"integer",defaultValue:0,hidden:!0},{name:"popupHeightLeftOver",type:"integer",defaultValue:100,hidden:!0},{name:"coappDownloads",type:"choice",defaultValue:"ask",choices:["ask","coapp","browser"]},{name:"lastDownloadDirectory",type:"string",defaultValue:"dwhelper"},{name:"fileDialogType",type:"choice",defaultValue:"tab",choices:["tab","panel"]},{name:"alertDialogType",type:"choice",defaultValue:"tab",choices:["tab","panel"]},{name:"monitorNetworkRequests",type:"boolean",defaultValue:!0},{name:"chunkedCoappManifestsRequests",type:"boolean",defaultValue:!1},{name:"chunkedCoappDataRequests",type:"boolean",defaultValue:!0},{name:"coappRestartDelay",type:"integer",defaultValue:1e3},{name:"rememberLastDir",type:"boolean",defaultValue:!0},{name:"coappIdleExit",type:"integer",defaultValue:6e4},{name:"dialogAutoClose",type:"boolean",defaultValue:!1},{name:"convertControlledMax",type:"integer",defaultValue:1},{name:"checkCoappOnStartup",type:"boolean",defaultValue:!0},{name:"coappUseProxy",type:"boolean",defaultValue:!0},{name:"downloadCompleteDelay",type:"integer",defaultValue:1e3},{name:"contentRedirectEnabled",type:"boolean",defaultValue:!0},{name:"contextMenuEnabled",type:"boolean",defaultValue:!0},{name:"toolsMenuEnabled",type:"boolean",defaultValue:!1},{name:"medialinkExtensions",type:"string",defaultValue:"jpg|jpeg|gif|png|mpg|mpeg|avi|rm|wmv|mov|flv|mp3|mp4"},{name:"medialinkMaxHits",type:"integer",defaultValue:50},{name:"medialinkMinFilesPerGroup",type:"integer",defaultValue:6},{name:"medialinkMinImgSize",type:"integer",defaultValue:80},{name:"medialinkAutoDetect",type:"boolean",defaultValue:!1},{name:"medialinkScanImages",type:"boolean",defaultValue:!0},{name:"medialinkScanLinks",type:"boolean",defaultValue:!0},{name:"bulkEnabled",type:"boolean",defaultValue:!0},{name:"tbvwsGrabDelay",type:"integer",defaultValue:2e3},{name:"forcedCoappVersion",type:"string",regexp:"^$|^\\d+\\.\\d+\\.\\d+$",defaultValue:""},{name:"lastHlsDownload",type:"integer",defaultValue:0,hidden:!0},{name:"galleryNaming",type:"choice",choices:["type-index","url","index-url"],defaultValue:"type-index"},{name:"hlsRememberPrevLiveChunks",type:"boolean",defaultValue:!1},{name:"hlsEndTimeout",type:"integer",defaultValue:20},{name:"tbvwsExtractionMethod",type:"choice",choices:["page_android_ios_tvep","page_ios_android_tvep","android_ios_tvep_page","ios_android_tvep_page","page_tvep_android_ios","android_ios_tvep","page","android","tvep","ios"],defaultValue:"page_android_ios_tvep"},{name:"hitUpdateFloodProtect",type:"integer",defaultValue:100,hidden:!0},{name:"use_native_filepicker",type:"boolean",defaultValue:!1}]});var J=m((gM,Mp)=>{"use strict";var Y=Sr(),us=Y.browser,Re={},Ve={};Y.rpc=Mt(),Y.rpc.setUseTarget(!0),Y.rpc.setPost((e,t)=>{let r=Re[e];r&&r.port&&r.port.postMessage(t)}),Y.rpc.listen({appStarted:e=>{},appReady:e=>{},closePanel:e=>{Y.ui.close(e)}}),us.runtime.onConnect.addListener(e=>{/^weh:(.*?):(.*)/.exec(e.name)&&(e.onMessage.addListener(t=>{if(typeof t._method<"u"&&(t._method==="appStarted"||t._method==="appReady")){let r=t._args[0]&&t._args[0].uiName||null,i=Re[r]||{ready:!1};if(Re[r]=i,Object.assign(i,t._args[0],{port:e}),t._method=="appReady"){i.ready=!0,i.initData&&setTimeout(()=>Y.rpc.call(r,"wehInitData",i.initData));let n=Ve[r];n&&n.timer&&clearTimeout(n.timer)}e._weh_app=r}Y.rpc.receive(t,e.postMessage.bind(e),e._weh_app)}),e.onDisconnect.addListener(()=>{let t=e._weh_app;if(t){delete Re[t];let r=Ve[t];r&&(r.timer&&clearTimeout(r.timer),delete Ve[t],r.reject(new Error("Disconnected waiting for "+t)))}}))}),Y.__declareAppTab=function(e,t){Re[e]||(Re[e]={}),Object.assign(Re[e],t)},Y.__closeByTab=function(e){Object.keys(Re).forEach(t=>{if(Re[t].tab===e){delete Re[t];let r=Ve[t];r&&(r.timer&&clearTimeout(r.timer),delete Ve[t],r.reject(new Error("Disconnected waiting for "+t)))}})},Y._=ns().getMessage,Y.ui=wp(),Y.openedContents=()=>Object.keys(Re);function $_(e){let t=0,r;if(e.length===0)return t;for(let i=0;i<e.length;i++)r=e.charCodeAt(i),t=(t<<5)-t+r,t=t&t;return t}function Q_(e){return JSON.stringify(Object.keys(e).sort().map(function(t){return{name:t,value:e[t]}}))}var Pp=0;Y.unsafe_prefs=ss(),Y.prefs=us.storage.local.get("weh-prefs").then(e=>{let t=Y.unsafe_prefs,r=e["weh-prefs"]||{};return t.assign(r),t.on("",{pack:!0},function(i,n){Object.assign(r,i);let o=Q_(r),a=$_(o);a!=Pp&&(Pp=a,us.storage.local.set({"weh-prefs":r})),Object.keys(Re).forEach(s=>{Y.rpc.call(s,"setPrefs",i)})}),t.declare(Op()),t}).catch(e=>{console.error("web-background error:",e)}),Y.wait=(e,t={})=>{let r=Ve[e];return r&&(r.timer&&clearTimeout(r.timer),delete Ve[e],r.reject(new Error("Waiter for "+e+" overriden"))),new Promise((i,n)=>{Ve[e]={resolve:i,reject:n,timer:setTimeout(()=>{delete Ve[e],n(new Error("Waiter for "+e+" timed out"))},t.timeout||6e4)}})},Y.rpc.listen({prefsGetAll:async()=>(await Y.prefs).getAll(),prefsGetSpecs:async()=>(await Y.prefs).getSpecs(),prefsSet:async e=>(await Y.prefs).assign(e),trigger:(e,t)=>{let r=Ve[e];if(!r)throw new Error("No waiter for",e);r.timer&&(clearTimeout(r.timer),delete r.timer),delete Ve[e],r.resolve(t)}}),Mp.exports=Y});var er=m((hM,K_)=>{K_.exports={prod:!0,channel:"stable",buildDate:"2024-02-19",buildOptions:{linuxlic:!1,noyt:!0,target:"google",browser:"chrome"}}});var Np=m((yM,Ip)=>{"use strict";var z_=Sr(),Rp=Mt(),ls=ss(),En=z_.browser,wi=null,Dp=null,xi=!1;En.runtime.onMessageExternal&&(En.runtime.onMessageExternal.addListener(function(e,t,r){switch(e.type){case"weh#inspect-ping":wi=t.id,r({type:"weh#inspect-pong",version:1,manifest:En.runtime.getManifest()});break;case"weh#inspect":wi=t.id,xi=e.inspected,xi?Rp.setHook(i=>{xi&&wi&&En.runtime.sendMessage(wi,{type:"weh#inspect-message",message:i}).catch(n=>{console.info("Error sending message",n),xi=!1})}):Rp.setHook(null),r({type:"weh#inspect",version:1,inspected:xi});break;case"weh#get-prefs":wi=t.id,r({type:"weh#prefs",prefs:ls.getAll(),specs:ls.getSpecs()});break;case"weh#set-pref":ls[e.pref]=e.value,r(!0);break}}),Dp={send:()=>{console.info("TODO implement inspect.send")}}),Ip.exports=Dp});var qp={};Z(qp,{removeOriginAndReferrerSetterForUrl:()=>Z_,setOriginAndReferrerSetterForUrl:()=>Y_});async function Y_(e,t,r){if(!(!t&&!r))if(Cp){let i=[];t&&i.push({operation:"set",header:"origin",value:t}),r&&i.push({operation:"set",header:"referer",value:r});let n=J_++,o={id:n,priority:1,action:{type:"modifyHeaders",requestHeaders:i},condition:{urlFilter:e,resourceTypes:["xmlhttprequest"]}};ps.set(e,[n]);try{await Ei.declarativeNetRequest.updateSessionRules({addRules:[o]})}catch{}}else{let i=n=>{let o=n.requestHeaders.filter(a=>a.name!="origin"&&a.name!="referer");return t&&o.push({name:"origin",value:t}),r&&o.push({name:"referer",value:r}),{requestHeaders:o}};cs.set(e,i),Ei.webRequest.onBeforeSendHeaders.addListener(i,{urls:[e]},["blocking","requestHeaders"])}}async function Z_(e){if(Cp){let t=ps.get(e);t&&(ps.delete(e),await Ei.declarativeNetRequest.updateSessionRules({removeRuleIds:t}))}else{let t=cs.get(e);t&&(cs.delete(t),Ei.webRequest.onBeforeSendHeaders.removeListener(t))}}var Ei,cs,ps,J_,Cp,kp=I(()=>{"use strict";({browser:Ei}=J()),cs=new Map,ps=new Map,J_=1,Cp=Ei.runtime.getManifest().manifest_version>=3});var de={};Z(de,{Cache:()=>ds,Concurrent:()=>d0,DetailsError:()=>gs,VDHError:()=>Tn,arrayEquals:()=>o0,bufferToHex:()=>p0,executeScriptWithGlobal:()=>m0,fromByteArray:()=>s0,generateRandomString:()=>Vp,gotoOrOpenTab:()=>n0,gotoTab:()=>Fp,hash:()=>Bp,hashHex:()=>i0,headerSubsSalt:()=>l0,isMinimumVersion:()=>f0,request:()=>c0,toByteArray:()=>a0});function Bp(e){let t=0,r,i,n;if(e.length===0)return t;for(r=0,n=e.length;r<n;r++)i=e.charCodeAt(r),t=(t<<5)-t+i,t|=0;return t}function i0(e){return Math.abs(Bp(e)).toString(16)}function Fp(e){return De.tabs.query({url:e}).then(t=>t.length>0?(De.tabs.update(t[0].id,{active:!0}),De.windows.update(t[0].windowId,{focused:!0}),!0):!1)}function n0(e,t=null){let r=0;function i(){return De.windows.getLastFocused({windowTypes:["normal"]}).then(n=>n.type!="normal"?++r<20?new Promise((o,a)=>{setTimeout(()=>i(),100)}):new Promise((o,a)=>{De.windows.getAll({windowTypes:["normal"]}).then(s=>{if(s.every(u=>u.type=="normal"?(o(u.id),!1):!0))throw new Error("No normal window to open tab")})}):n.id).then(n=>{let o=null;if(n)return De.tabs.query({active:!0,lastFocusedWindow:!0}).then(a=>(a.length>0&&(o=a[0].id),new Promise((s,u)=>{let l=null,p=(c,g,b)=>{c==l&&g.status==="complete"&&(De.tabs.onUpdated.removeListener(p),s(b))};De.tabs.onUpdated.addListener(p),De.tabs.create({url:e,windowId:n}).then(c=>{c.status==="complete"?(De.tabs.onUpdated.removeListener(p),s(c)):l=c.id})}).then(s=>{o&&t&&t(s.id,o)})))})}return Fp(e).then(n=>n?Promise.resolve():i())}function o0(e,t){if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function Vp(e){let t=new Uint8Array(e);crypto.getRandomValues(t);let r="";for(let i=0;i<t.length;i++)r+=("0"+t[i].toString(16)).slice(-2);return r.substring(0,e)}async function c0(e){let t="include";e.anonymous&&(t="omit");let r=e.url,i=e.method||"GET",n="",o=new Headers;if(e.headers){if(e.headers instanceof Array)for(let u of e.headers)o.append(u.name,u.value);else o=new Headers(e.headers);o.has("referer")&&(n=o.get("referer")),o.has("referrer")&&(n=o.get("referrer"));for(let u of u0)o.delete(u)}let a;e.contentJSON?a=JSON.stringify(e.contentJSON):e.content&&(a=e.content),await t0(r,o.get("origin"),n);let s;try{s=await fetch(r,{referrer:n,method:i,headers:o,body:a,credentials:t})}finally{await r0(r)}return s}function p0(e){let t=[],r=new DataView(e);for(let i=0;i<r.byteLength;i+=4){let o=r.getUint32(i).toString(16),a="00000000",s=(a+o).slice(-a.length);t.push(s)}return t.join("")}function d0(...e){let t=new fs(...e);return t.callFn().bind(t)}function f0(e="0.0.0",t){let r=e.split(".").map(n=>parseInt(n)),i=t.split(".").map(n=>parseInt(n));for(let n=0;n<r.length;n++){if(typeof i[n]>"u"||r[n]>i[n])return!0;if(r[n]<i[n])return!1}return!0}async function m0(e,t,r){let i=s=>s&&typeof s=="object",n=s=>JSON.parse(JSON.stringify(s));if(!i(t))throw new Error("global argument is not an object");t=n(t);let a={target:e,func:s=>{Object.assign(window,s)},args:[t]};await De.scripting.executeScript(a),a={target:e,files:[r]},await De.scripting.executeScript(a)}var e0,De,t0,r0,a0,s0,u0,l0,ds,fs,ms,Tn,gs,fe=I(()=>{"use strict";e0=J(),De=e0.browser,{setOriginAndReferrerSetterForUrl:t0,removeOriginAndReferrerSetterForUrl:r0}=(kp(),P(qp));({toByteArray:a0,fromByteArray:s0}=(()=>{let e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(e=0;e<t.length;e++)r[e]=t[e];let i=[];for(e=0;e<t.length;++e)i[t.charCodeAt(e)]=e;i[45]=62,i[95]=63;let n=typeof Uint8Array<"u"?Uint8Array:Array;function o(c){let g=i[c.charCodeAt(0)];return g!==void 0?g:-1}function a(c){let g,b,d,A,f,h;if(c.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");let y=c.length;f=c.charAt(y-2)==="="?2:c.charAt(y-1)==="="?1:0,h=new n(c.length*3/4-f),d=f>0?c.length-4:c.length;let T=0;function w(S){h[T++]=S}for(g=0,b=0;g<d;g+=4,b+=3)A=o(c.charAt(g))<<18|o(c.charAt(g+1))<<12|o(c.charAt(g+2))<<6|o(c.charAt(g+3)),w((A&16711680)>>>16>>>0),w((A&65280)>>>8>>>0),w((A&255)>>>0);return f===2?(A=o(c.charAt(g))<<2|o(c.charAt(g+1))>>>4>>>0,w(A&255)):f===1&&(A=o(c.charAt(g))<<10|o(c.charAt(g+1))<<4|o(c.charAt(g+2))>>>2>>>0,w(A>>>8>>>0&255),w(A&255)),h}function s(c){return r[c]}function u(c){return s(c>>>18>>>0&63)+s(c>>>12>>>0&63)+s(c>>>6>>>0&63)+s(c&63)}function l(c,g,b){let d,A=[];for(let f=g;f<b;f+=3)d=(c[f]<<16)+(c[f+1]<<8)+c[f+2],A.push(u(d));return A.join("")}function p(c){let g,b=c.length%3,d="",A=[],f,h,y=16383;for(g=0,h=c.length-b;g<h;g+=y)A.push(l(c,g,g+y>h?h:g+y));switch(b){case 1:f=c[c.length-1],d+=s(f>>>2>>>0),d+=s(f<<4&63),d+="==";break;case 2:f=(c[c.length-2]<<8)+c[c.length-1],d+=s(f>>>10>>>0),d+=s(f>>>4>>>0&63),d+=s(f<<2&63),d+="=";break;default:break}return A.push(d),A.join("")}return{toByteArray:a,fromByteArray:p}})()),u0=["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via","x-chrome-uma-enabled","x-client-data"];l0=Vp(8);ds=class{constructor(t,r){this.getFn=t,this.setFn=r,this.callbacks=[],this.queried=!1,this.value=void 0}get(){let t=this;return()=>typeof t.value<"u"?Promise.resolve(t.value):new Promise((r,i)=>{if(t.callbacks.push({resolve:r,reject:i}),!t.queried){t.queried=!0;try{Promise.resolve(t.getFn()).then(n=>{for(t.value=n;t.callbacks.length;)t.callbacks.shift().resolve(n)}).catch(n=>{for(;t.callbacks.length;)t.callbacks.shift().reject(n)})}catch(n){for(t.queried=!1;t.callbacks.length;)t.callbacks.shift().reject(n)}}})}set(t){if(!this.setFn)return Promise.reject(new Error("Value is read-only"));if(typeof t>"u")return Promise.reject(new Error("Cannot set undefined value"));for(this.value=t;this.callbacks.length;)this.callbacks.shift().resolve();return this.setFn(t),Promise.resolve()}},fs=class{constructor(t=1){this.maxFn=t,this.pendings=[],this.count=0}async getMax(){return typeof this.maxFn=="function"?this.maxFn():this.maxFn}callFn(){let t=this;return(r,i)=>t.getMax().then(n=>t.count<n?t.doCall(r):new Promise((o,a)=>{let s=()=>Promise.resolve(r()).then(o).catch(a);t.pendings.push(s),i&&i(u=>{let l=t.pendings.indexOf(s);l>=0&&(t.pendings.splice(l,1),o(u))},u=>{let l=t.pendings.indexOf(s);l>=0&&(t.pendings.splice(l,1),a(u))})}))}attempt(){if(this.pendings.length>0){let t=this;t.getMax().then(r=>{t.count<r&&t.doCall(t.pendings.shift())})}}doCall(t){let r=this;return this.count++,Promise.resolve(t()).then(i=>(r.count--,r.attempt(),i)).catch(i=>{throw r.count--,r.attempt(),i})}};ms=class extends Error{constructor(t){super(t),this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(t).stack}},Tn=class extends ms{constructor(t,r){super(t),Object.assign(this,r)}},gs=class extends Tn{constructor(t,r){super(t,{_details:r})}get details(){return this._details}toString(){return`${this.message}: ${this._details}`}}});var Hp={};Z(Hp,{Downloads:()=>hs});var hs,jp=I(()=>{"use strict";hs=class{constructor(t){this.coapp=t}download(t){return this.coapp.call("downloads.download",t)}search(t){return this.coapp.call("downloads.search",t)}cancel(t){return this.coapp.call("downloads.cancel",t)}}});var Or,ze,Lp=I(()=>{Or=e=>Object.prototype.toString.call(e).slice(8,-1),ze=e=>typeof e=="string"||e instanceof String});var g0,Sn,Xp,Up,h0,Wp,y0,$p,Gp,ys,vs,Pr,tr,bs,As,v0,b0,A0,Qp,Kp=I(()=>{Lp();g0=10,Sn="0|[1-9]\\d*",Xp="\\d*[A-Z-][A-Z\\d-]*",Up=`(?:${Xp}|${Sn})`,h0=`${Up}(?:\\.${Up})*`,Wp=`(?:${Xp}|\\d+)`,y0=`${Wp}(?:\\.${Wp})*`,$p=`((?:${Sn})(?:\\.(?:${Sn})){2})(?:-(${h0}))?(?:\\+(${y0}))?`,Gp=new RegExp(`^(?:${Sn})$`),ys=new RegExp(`^v?${$p}$`,"i"),vs=new RegExp(`^${$p}$`,"i"),Pr=(e,t=!1)=>{if(!ze(e))throw new TypeError(`Expected String but got ${Or(e)}.`);return(t?vs:ys).test(e)},tr=(e,t=!1)=>{if(!ze(e))throw new TypeError(`Expected String but got ${Or(e)}.`);if(!(t||Gp.test(e)))throw new Error(`${e} is not a stringified positive integer.`);let r;if(Gp.test(e)){if(r=parseInt(e,g0),!Number.isSafeInteger(r))throw new RangeError(`${r} exceeds ${Number.MAX_SAFE_INTEGER}.`)}else r=e;return r},bs=(e,t,r=!1)=>{if(!ze(e))throw new TypeError(`Expected String but got ${Or(e)}.`);if(!ze(t))throw new TypeError(`Expected String but got ${Or(t)}.`);if(!Pr(e,!!r))throw new Error(`${e} is not valid version string.`);if(!Pr(t,!!r))throw new Error(`${t} is not valid version string.`);let i;if(e===t)i=0;else{let n=r?vs:ys,[,o,a]=e.match(n),[,s,u]=t.match(n),[l,p,c]=o.split(".").map(A=>tr(A)),[g,b,d]=s.split(".").map(A=>tr(A));if(l>g)i=1;else if(l<g)i=-1;else if(p>b)i=1;else if(p<b)i=-1;else if(c>d)i=1;else if(c<d)i=-1;else if(a===u)i=0;else if(!a&&u)i=1;else if(a&&!u)i=-1;else{let A=a.split(".").map(T=>tr(T,!0)),f=u.split(".").map(T=>tr(T,!0)),h=Math.max(A.length,f.length),y=0;for(;y<h;){let T=A[y],w=f[y];if(T&&!w||ze(T)&&Number.isInteger(w)?i=1:!T&&w||Number.isInteger(T)&&ze(w)?i=-1:T!==w&&ze(T)&&ze(w)?i=T.localeCompare(w):Number.isInteger(T)&&Number.isInteger(w)&&(T>w?i=1:T<w&&(i=-1)),Number.isInteger(i))break;y++}}}return i},As=(e,t=!1)=>{if(!ze(e))throw new TypeError(`Expected String but got ${Or(e)}.`);let r=Pr(e,!!t),i,n,o,a,s;if(r){let u=t?vs:ys,[,l,p,c]=e.match(u);[i,n,o]=l.split(".").map(g=>tr(g)),p&&(a=p.split(".").map(g=>tr(g,!0))),c&&(s=c.split(".").map(g=>tr(g,!0)))}return{version:e,matches:r,major:i,minor:n,patch:o,pre:a,build:s}},v0=async(e,t,r=!1)=>bs(e,t,r),b0=async(e,t=!1)=>Pr(e,t),A0=async(e,t=!1)=>As(e,t),Qp={compareSemVer:v0,isValidSemVer:b0,parseSemVer:A0}});var zp={};Z(zp,{compareSemVer:()=>bs,isValidSemVer:()=>Pr,parseSemVer:()=>As,promises:()=>Qp});var Jp=I(()=>{Kp();});var Zp=m((wM,Yp)=>{"use strict";var _0=Sr(),_s=_0.browser,On=Mt(),Ti=class{constructor(){this.listeners=[]}addListener(t){this.listeners.push(t)}removeListener(t){this.listeners=this.listeners.filter(r=>t!==r)}removeAllListeners(){this.listeners=[]}notify(...t){this.listeners.forEach(r=>{try{r(...t)}catch(i){console.warn(i)}})}},Rt=1,Pn=2,ws=class{constructor(t,r={}){this.appId=t,this.name=r.name||t,this.appPort=null,this.pendingCalls=[],this.runningCalls=[],this.state="idle",this.postFn=this.post.bind(this),this.postMessageFn=this.postMessage.bind(this),this.onAppNotFound=new Ti,this.onAppNotFoundCheck=new Ti,this.onCallCount=new Ti,this.appStatus="unknown",this.app2AddonCallCount=0,this.addon2AppCallCount=0}post(t,r){this.appPort.postMessage(r)}postMessage(t){this.appPort.postMessage(t)}updateCallCount(t,r){switch(t){case Pn:this.app2AddonCallCount+=r;break;case Rt:this.addon2AppCallCount+=r;break}this.onCallCount.notify(this.addon2AppCallCount,this.app2AddonCallCount)}close(){if(this.appPort)try{this.appPort.disconnect(),this.cleanup()}catch{}}call(...t){return this.callCatchAppNotFound(null,...t)}callCatchAppNotFound(t,...r){let i=this;function n(o){let a;for(;a=i.pendingCalls.shift();)if(o)a.reject(o);else{i.runningCalls.push(a);let s=a;On.call(i.postFn,i.name,...a.params).then(u=>(i.runningCalls.splice(i.runningCalls.indexOf(s),1),u)).then(s.resolve).catch(u=>{i.runningCalls.splice(i.runningCalls.indexOf(s),1),s.reject(u)})}}switch(t&&(i.appStatus=="unknown"||i.appStatus=="checking")&&i.onAppNotFoundCheck.addListener(t),i.updateCallCount(Rt,1),this.state){case"running":return new Promise((o,a)=>{let s={resolve:o,reject:a,params:[...r]};i.runningCalls.push(s),On.call(i.postFn,i.name,...r).then(u=>(i.runningCalls.splice(i.runningCalls.indexOf(s),1),u)).then(s.resolve).catch(u=>{i.runningCalls.splice(i.runningCalls.indexOf(s),1),s.reject(u)})}).then(o=>(i.updateCallCount(Rt,-1),o)).catch(o=>{throw i.updateCallCount(Rt,-1),o});case"idle":return i.state="pending",new Promise((o,a)=>{i.pendingCalls.push({resolve:o,reject:a,params:[...r]});let s=_s.runtime.connectNative(i.appId);i.appStatus="checking",i.appPort=s,s.onMessage.addListener(u=>{i.appStatus=="checking"&&(i.appStatus="ok",i.onAppNotFoundCheck.removeAllListeners()),On.receive(u,i.postMessageFn,i.name)}),s.onDisconnect.addListener(()=>{n(new Error("Disconnected")),i.cleanup(),i.appStatus=="checking"&&!t&&i.onAppNotFound.notify(i.appPort&&i.appPort.error||_s.runtime.lastError)}),i.state="running",n()}).then(o=>(i.updateCallCount(Rt,-1),o)).catch(o=>{throw i.updateCallCount(Rt,-1),o});case"pending":return new Promise((o,a)=>{i.pendingCalls.push({resolve:o,reject:a,params:[...r]})}).then(o=>(i.updateCallCount(Rt,-1),o)).catch(o=>{throw i.updateCallCount(Rt,-1),o})}}listen(t){let r=this,i={};return Object.keys(t).forEach(n=>{i[n]=(...o)=>(r.updateCallCount(Pn,1),Promise.resolve(t[n](...o)).then(a=>(r.updateCallCount(Pn,-1),a)).catch(a=>{throw r.updateCallCount(Pn,-1),a}))}),On.listen(i)}cleanup(){let t=this;t.appStatus=="checking"&&(t.onAppNotFoundCheck.notify(t.appPort&&t.appPort.error||_s.runtime.lastError),t.onAppNotFoundCheck.removeAllListeners());let r;for(;r=t.runningCalls.shift();)r.reject(new Error("Native port disconnected"));t.state="idle",t.appStatus="unknown",t.appPort=null}};Yp.exports=function(...e){return new ws(...e)}});async function Mn(e,t){return(await xs.storage.local.get({[e]:t}))[e]}async function Rn(e,t){await xs.storage.local.set({[e]:t})}var xs,Dn=I(()=>{"use strict";xs=wn(ts(),1)});function Dt(e){var t=String(e);if(t==="[object Object]")try{t=JSON.stringify(e)}catch{}return t}var Es=I(()=>{});var w0,M,x0,C,Si,Ts=I(()=>{Es();In();w0=function(){function e(){}return e.prototype.isSome=function(){return!1},e.prototype.isNone=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(t){return t},e.prototype.expect=function(t){throw new Error("".concat(t))},e.prototype.unwrap=function(){throw new Error("Tried to unwrap None")},e.prototype.map=function(t){return this},e.prototype.mapOr=function(t,r){return t},e.prototype.mapOrElse=function(t,r){return t()},e.prototype.or=function(t){return t},e.prototype.orElse=function(t){return t()},e.prototype.andThen=function(t){return this},e.prototype.toResult=function(t){return K(t)},e.prototype.toString=function(){return"None"},e}(),M=new w0;Object.freeze(M);x0=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.isSome=function(){return!0},e.prototype.isNone=function(){return!1},e.prototype[Symbol.iterator]=function(){var t=Object(this.value);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(t){return this.value},e.prototype.expect=function(t){return this.value},e.prototype.unwrap=function(){return this.value},e.prototype.map=function(t){return C(t(this.value))},e.prototype.mapOr=function(t,r){return r(this.value)},e.prototype.mapOrElse=function(t,r){return r(this.value)},e.prototype.or=function(t){return this},e.prototype.orElse=function(t){return this},e.prototype.andThen=function(t){return t(this.value)},e.prototype.toResult=function(t){return $(this.value)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Some(".concat(Dt(this.value),")")},e.EMPTY=new e(void 0),e}(),C=x0;(function(e){function t(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];for(var a=[],s=0,u=n;s<u.length;s++){var l=u[s];if(l.isSome())a.push(l.value);else return l}return C(a)}e.all=t;function r(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];for(var a=0,s=n;a<s.length;a++){var u=s[a];return u.isSome(),u}return M}e.any=r;function i(n){return n instanceof C||n===M}e.isOption=i})(Si||(Si={}))});var E0,K,T0,$,Nn,In=I(()=>{Es();Ts();Os();E0=function(){function e(t){if(!(this instanceof e))return new e(t);this.error=t;var r=new Error().stack.split(`
`).slice(2);r&&r.length>0&&r[0].includes("ErrImpl")&&r.shift(),this._stack=r.join(`
`)}return e.prototype.isOk=function(){return!1},e.prototype.isErr=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(t){return t},e.prototype.unwrapOr=function(t){return t},e.prototype.expect=function(t){throw new Error("".concat(t," - Error: ").concat(Dt(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.expectErr=function(t){return this.error},e.prototype.unwrap=function(){throw new Error("Tried to unwrap Error: ".concat(Dt(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.unwrapErr=function(){return this.error},e.prototype.map=function(t){return this},e.prototype.andThen=function(t){return this},e.prototype.mapErr=function(t){return new K(t(this.error))},e.prototype.mapOr=function(t,r){return t},e.prototype.mapOrElse=function(t,r){return t(this.error)},e.prototype.or=function(t){return t},e.prototype.orElse=function(t){return t(this.error)},e.prototype.toOption=function(){return M},e.prototype.toString=function(){return"Err(".concat(Dt(this.error),")")},Object.defineProperty(e.prototype,"stack",{get:function(){return"".concat(this,`
`).concat(this._stack)},enumerable:!1,configurable:!0}),e.prototype.toAsyncResult=function(){return new Ss(this)},e.EMPTY=new e(void 0),e}(),K=E0,T0=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.isOk=function(){return!0},e.prototype.isErr=function(){return!1},e.prototype[Symbol.iterator]=function(){var t=Object(this.value);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(t){return this.value},e.prototype.unwrapOr=function(t){return this.value},e.prototype.expect=function(t){return this.value},e.prototype.expectErr=function(t){throw new Error(t)},e.prototype.unwrap=function(){return this.value},e.prototype.unwrapErr=function(){throw new Error("Tried to unwrap Ok: ".concat(Dt(this.value)),{cause:this.value})},e.prototype.map=function(t){return new $(t(this.value))},e.prototype.andThen=function(t){return t(this.value)},e.prototype.mapErr=function(t){return this},e.prototype.mapOr=function(t,r){return r(this.value)},e.prototype.mapOrElse=function(t,r){return r(this.value)},e.prototype.or=function(t){return this},e.prototype.orElse=function(t){return this},e.prototype.toOption=function(){return C(this.value)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Ok(".concat(Dt(this.value),")")},e.prototype.toAsyncResult=function(){return new Ss(this)},e.EMPTY=new e(void 0),e}(),$=T0;(function(e){function t(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];for(var u=[],l=0,p=a;l<p.length;l++){var c=p[l];if(c.isOk())u.push(c.value);else return c}return new $(u)}e.all=t;function r(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];for(var u=[],l=0,p=a;l<p.length;l++){var c=p[l];if(c.isOk())return c;u.push(c.error)}return new K(u)}e.any=r;function i(a){try{return new $(a())}catch(s){return new K(s)}}e.wrap=i;function n(a){try{return a().then(function(s){return new $(s)}).catch(function(s){return new K(s)})}catch(s){return Promise.resolve(new K(s))}}e.wrapAsync=n;function o(a){return a instanceof K||a instanceof $}e.isResult=o})(Nn||(Nn={}))});var ed,td,Ss,Os=I(()=>{In();ed=function(e,t,r,i){function n(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function s(p){try{l(i.next(p))}catch(c){a(c)}}function u(p){try{l(i.throw(p))}catch(c){a(c)}}function l(p){p.done?o(p.value):n(p.value).then(s,u)}l((i=i.apply(e,t||[])).next())})},td=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,n,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(p){return u([l,p])}}function u(l){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(r=0)),r;)try{if(i=1,n&&(o=l[0]&2?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(p){l=[6,p],n=0}finally{i=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Ss=function(){function e(t){this.promise=Promise.resolve(t)}return e.prototype.andThen=function(t){var r=this;return this.thenInternal(function(i){return ed(r,void 0,void 0,function(){var n;return td(this,function(o){return i.isErr()?[2,i]:(n=t(i.value),[2,n instanceof e?n.promise:n])})})})},e.prototype.map=function(t){var r=this;return this.thenInternal(function(i){return ed(r,void 0,void 0,function(){var n;return td(this,function(o){switch(o.label){case 0:return i.isErr()?[2,i]:(n=$,[4,t(i.value)]);case 1:return[2,n.apply(void 0,[o.sent()])]}})})})},e.prototype.thenInternal=function(t){return new e(this.promise.then(t))},e}()});var rd=I(()=>{Os();In();Ts()});var me=I(()=>{"use strict";rd()});var He=I(()=>{"use strict";me()});function ge(e){return Object.assign(e.prototype,{find:function(t){for(let r of this)if(t(r))return C(r);return M},count:function(t){return this.reduce((r,i)=>(t(i)&&r++,r),0)},reduce:function(t,r){let i=r;for(let n of this)i=t(i,n);return i},every:function(t){return!this.any(r=>!t(r))},any:function(t){for(let r of this)if(t(r))return!0;return!1},map:function(t){return this.filterMap(r=>C(t(r)))},filter:function(t){return this.filterMap(r=>t(r)?C(r):M)},enumerate:function(){let t=this;return ge(function*(){let r=0;for(let i of t)yield[r,i],r++})()},filterMap:function(t){let r=this;return ge(function*(){for(let i of r){let n=t(i);n.isSome()&&(yield n.unwrap())}})()},sort:function(t){let r=this.toArray();return r.sort(t),r},toArray:function(){return[...this]}}),e}var Cn=I(()=>{"use strict";me();He();Array.prototype.as_iter||(Array.prototype.as_iter=function(){let e=this;return ge(function*(){for(let t of e)yield t})()});Set.prototype.as_iter||(Set.prototype.as_iter=function(){let e=this;return ge(function*(){for(let t of e)yield t})()});Map.prototype.as_iter||(Map.prototype.as_iter=function(){let e=this;return ge(function*(){for(let t of e)yield t})()})});function je(e){return qn[e]}function dt(e){return Ps[e]}function Ms(e){return typeof e=="string"&&e in qn?C(e):M}var Mr,qn,Ps,Rr,Dr,ft=I(()=>{"use strict";me();Cn();He();Mr=/.^/,qn={Av1:{name:"Av1",type:"video",mimetype:/av01.*/i,defacto_container:"WebM"},H264:{name:"H264",type:"video",mimetype:/avc1.*/i,defacto_container:"Mp4"},H263:{name:"H263",type:"video",mimetype:Mr,defacto_container:"3gp"},H265:{name:"H265",type:"video",mimetype:/(hvc1|hevc|h265|h\.265).*/i,defacto_container:"Mp4"},MP4V:{name:"MP4V",type:"video",mimetype:/mp4v\.20.*/i,defacto_container:"Mp4"},MPEG1:{name:"MPEG1",type:"video",mimetype:Mr,defacto_container:"Mpeg"},MPEG2:{name:"MPEG2",type:"video",mimetype:Mr,defacto_container:"Mpeg"},Theora:{name:"Theora",type:"video",mimetype:/theora/i,defacto_container:"Ogg"},VP8:{name:"VP8",type:"video",mimetype:/vp0?8.*/i,defacto_container:"WebM"},VP9:{name:"VP9",type:"video",mimetype:/vp0?9.*/i,defacto_container:"WebM"},unknown:{name:"unknown",type:"video",mimetype:Mr,defacto_container:"Mp4"}},Ps={AAC:{name:"AAC",type:"audio",mimetype:/(aac|mp4a.40).*/i,defacto_container:"Mp4"},PCM:{name:"PCM",type:"audio",mimetype:/pcm.*/i,defacto_container:"Wav"},FLAC:{name:"FLAC",type:"audio",mimetype:/flac/i,defacto_container:"Flac"},MP3:{name:"MP3",type:"audio",mimetype:/(\.?mp3|mp4a\.69|mp4a\.6b).*/i,defacto_container:"Mpeg"},Opus:{name:"Opus",type:"audio",mimetype:/(opus|(mp4a\.ad.*))/i,defacto_container:"Ogg"},Vorbis:{name:"Vorbis",type:"audio",mimetype:/vorbis/i,defacto_container:"Ogg"},Wav:{name:"Wav",type:"audio",mimetype:Mr,defacto_container:"Wav"},unknown:{name:"unknown",type:"audio",mimetype:Mr,defacto_container:"Mp4"}},Rr=ge(function*(){for(let e of Object.keys(qn))yield qn[e]}),Dr=ge(function*(){for(let e of Object.keys(Ps))yield Ps[e]})});function Ds(e){return typeof e=="string"&&e in kn?C(e):M}function id(e){for(let t of Rs()){if(t.extension===e)return C(t);if(t.audio_only_extension&&t.audio_only_extension===e)return C(t)}return M}function le(e){return kn[e]}var kn,S0,Rs,mt=I(()=>{"use strict";me();Cn();ft();He();kn={M2TS:{name:"M2TS",extension:"mt2s",audio_only_extension:"mp3",defacto_codecs:{audio:M,video:M},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2","VP9","unknown"],supported_audio_codecs:["Opus","MP3","FLAC","AAC"],mimetype:/(?:x-)?flv/i},MP2T:{name:"MP2T",extension:"mp2t",audio_only_extension:"mp3",defacto_codecs:{audio:C("MP3"),video:C("H264")},supported_video_codecs:["MPEG2","MPEG1"],supported_audio_codecs:["MP3"],mimetype:/(?:x-)?mp2t/i},Flash:{name:"Flash",extension:"flv",audio_only_extension:"mp3",defacto_codecs:{audio:M,video:M},supported_video_codecs:["H264"],supported_audio_codecs:["AAC"],mimetype:/(?:x-)?flv/i},Mp4:{name:"Mp4",extension:"mp4",audio_only_extension:"mp3",defacto_codecs:{audio:M,video:M},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2","unknown"],supported_audio_codecs:["Opus","MP3","FLAC","AAC","unknown"],mimetype:/(?:x-)?mp4/i},M4V:{name:"M4V",extension:"m4v",audio_only_extension:"mp3",defacto_codecs:{audio:M,video:M},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2"],supported_audio_codecs:["Opus","MP3","FLAC","AAC"],mimetype:/(?:x-)?m4v/i},Flac:{name:"Flac",extension:"flac",audio_only_extension:"flac",defacto_codecs:{audio:C("FLAC"),video:M},supported_video_codecs:[],supported_audio_codecs:["FLAC"],mimetype:/(?:x-)?flac/i},Mpeg:{name:"Mpeg",extension:"mpeg",audio_only_extension:"mp3",defacto_codecs:{audio:C("MP3"),video:C("H264")},supported_video_codecs:["MPEG2","MPEG1"],supported_audio_codecs:["MP3"],mimetype:/(?:x-)?mpeg/i},Ogg:{name:"Ogg",extension:"ogv",audio_only_extension:"oga",defacto_codecs:{audio:M,video:M},supported_video_codecs:["VP9","VP8","Theora"],supported_audio_codecs:["Opus","Vorbis","FLAC"],mimetype:/(?:x-)?og./i},Wav:{name:"Wav",extension:"wav",audio_only_extension:"wav",defacto_codecs:{audio:C("Wav"),video:M},supported_video_codecs:[],supported_audio_codecs:["Wav","PCM"],mimetype:/(?:x-)?(?:pn-)?wave?/i},Mkv:{name:"Mkv",extension:"mkv",audio_only_extension:"mp3",defacto_codecs:{audio:M,video:M},supported_video_codecs:Rr().filter(e=>e.name!="unknown").map(e=>e.name).toArray(),supported_audio_codecs:Dr().filter(e=>e.name!="unknown").map(e=>e.name).toArray(),mimetype:/(?:x-)?matroska/i},"3gp":{name:"3gp",extension:"3gpp",audio_only_extension:"mp3",defacto_codecs:{audio:M,video:M},supported_video_codecs:["H264","H263","MP4V","VP8"],supported_audio_codecs:["MP3","AAC"],mimetype:/(?:x-)?3gpp2?/i},QuickTime:{name:"QuickTime",extension:"mov",audio_only_extension:"mp3",defacto_codecs:{audio:M,video:M},supported_video_codecs:["MPEG1","MPEG2"],supported_audio_codecs:[],mimetype:/(?:x-)?mov/i},WebM:{name:"WebM",extension:"webm",audio_only_extension:"oga",defacto_codecs:{audio:M,video:M},supported_video_codecs:["H264","VP8","VP9","Av1"],supported_audio_codecs:["Opus","Vorbis"],mimetype:/(?:x-)?webm/i}},S0=ge(function*(){for(let e of Object.keys(kn))yield e}),Rs=ge(function*(){for(let e of S0())yield kn[e]})});function nd(e,t){let r=!!e.audio,i=!!t.audio,n=!!e.video,o=!!t.video;return r===i&&n&&o}function gt(e,t,r){if(e.audio&&e.video)return{audio:t(e.audio),video:r(e.video)};if(e.video)return{video:r(e.video),audio:!1};if(e.audio)return{audio:t(e.audio),video:!1};throw"unreachable"}var Ir=I(()=>{"use strict"});function ad(e,t){let r=parseInt(e),i=parseInt(t);return r<i}function Bn(e,t){let r=parseInt(e),i=parseInt(t);return r>i}function sd(e){for(let t of Fn())if(e.includes(t))return C(t);return M}function Nr(e){let t=Fn().map(r=>parseInt(r)).toArray();t.sort((r,i)=>r-i),t.reverse();for(let r of t)if(e>=r)return r.toString();return O0}function Vn(e){if(typeof e=="string")return Fn().find(t=>t==e);if(typeof e=="number"){let t=e.toString();return Vn(t)}return M}var O0,od,Fn,lR,Cr=I(()=>{"use strict";me();Cn();He();O0="240",od={240:{id:"240",loose_name:"Small"},360:{id:"360",loose_name:"SD"},480:{id:"480",loose_name:"SD"},720:{id:"720",loose_name:"HD"},1080:{id:"1080",loose_name:"FullHD"},1440:{id:"1440",loose_name:"UHD"},2160:{id:"2160",loose_name:"UHD"},4320:{id:"4320",loose_name:"UHD"}};Fn=ge(function*(){for(let e of Object.keys(od))yield e}),lR=ge(function*(){for(let e of Fn())yield od[e]})});function Hn(){return{codec:je("unknown"),fps:M,dimensions:M,quality:M,bitrate:M}}function ud(e,t,r){if(e.protocol==="hls"&&t.protocol!="hls")return-1;if(t.protocol==="hls"&&e.protocol!="hls"||e.protocol==="non-adaptative"&&t.protocol!="non-adaptative")return 1;if(t.protocol==="non-adaptative"&&e.protocol!="non-adaptative")return-1;if(e.container.name!=t.container.name){if(e.container.name==r.container)return-1;if(t.container.name==r.container)return 1;let a=r.ignored_containers.includes(e.container.name),s=r.ignored_containers.includes(t.container.name);if(!a&&s)return-1;if(a&&!s)return 1}if(!nd(e.av,t.av)){if(e.av.audio&&e.av.video)return-1;if(t.av.audio&&t.av.video)return 1;if(e.av.video)return-1;if(t.av.video)return 1}if(e.duration&&t.duration){if(e.duration>t.duration)return-1;if(t.duration>e.duration)return 1}if(e.av.video&&t.av.video){let a=e.av.video,s=t.av.video;if(a.codec.name!=s.codec.name){if(a.codec.name==r.video_codec)return-1;if(s.codec.name==r.video_codec)return 1;let u=r.ignored_video_codecs.includes(a.codec.name),l=r.ignored_video_codecs.includes(s.codec.name);if(!u&&l)return-1;if(u&&!l)return 1}if(a.dimensions.isSome()){if(s.dimensions.isNone())return-1;let u=a.dimensions.unwrap(),l=s.dimensions.unwrap();if(u.height>l.height)return-1;if(l.height>u.height)return 1}if(a.quality.isSome()){if(s.quality.isNone())return-1;let u=a.quality.unwrap(),l=s.quality.unwrap(),p=b=>Bn(b,r.best_video_quality)||ad(b,r.lowest_video_quality),c=p(u),g=p(l);if(!c&&g)return-1;if(c&&!g)return 1;if(Bn(u,l))return-1;if(Bn(l,u))return 1}if(a.bitrate.isSome()){if(s.bitrate.isNone())return-1;let u=a.bitrate.unwrap(),l=s.bitrate.unwrap();if(u>l)return-1;if(l>u)return 1}if(a.fps.isSome()){if(s.fps.isNone())return-1;let u=a.fps.unwrap(),l=s.fps.unwrap();if(u!=l){if(u==60&&r.prefer_60fps||l==60&&r.prefer_60fps||u>l)return-1;if(l>u)return 1}}}return 0}function ld(e,t){let r={...t};return r.duration==="unknown"&&(r.duration=e.duration),r.av.audio||(r.av.audio=e.av.audio),r.av.video||(r.av.video=e.av.video),e.av.audio&&r.av.audio&&(r.av.audio.codec.name=="unknown"&&(r.av.audio.codec=e.av.audio.codec),r.av.audio.bitrate.isNone()&&(r.av.audio.bitrate=e.av.audio.bitrate)),e.av.video&&r.av.video&&(r.av.video.codec.name=="unknown"&&(r.av.video.codec=e.av.video.codec),r.av.video.quality.isNone()&&(r.av.video.quality=e.av.video.quality),r.av.video.dimensions.isNone()&&(r.av.video.dimensions=e.av.video.dimensions),r.av.video.fps.isNone()&&(r.av.video.fps=e.av.video.fps),r.av.video.bitrate.isNone()&&(r.av.video.bitrate=e.av.video.bitrate)),r}var Oi=I(()=>{"use strict";me();mt();ft();Ir();Cr();He()});var cd,pd,dd,fd,md=I(()=>{"use strict";cd=Object.keys({id:1,actions:1,status:1,raw_bitrate:1,operation:1,description:1,opStartDate:1,descrPrefix:1,title:1,topUrl:1,thumbnail:1,thumbnailUrl:1,size:1,duration:1,quality:1,bitrate:1,length:1,mediaDomain:1,type:1,extension:1,originalExt:1}),pd=Object.keys({id:1,type:1,originalExt:1,running:1,localFilePath:1,localDirectory:1,extension:1,extensions:1,baseJs:1,chunked:1,proxy:1,isPrivate:1,possibleContentRedirect:1,urls:1,masterManifest:1,audioMediaManifest:1,videoMediaManifest:1,headers:1,title:1,referrer:1,convert:1,baseUrl:1,mpd_url:1,mpd_video_id:1,mpd_audio_id:1,gallery_urls:1,bulk_ids:1,bulk:1,tabId:1}),dd=Object.keys({group:1}),fd=["url","videoUrl","audioUrl","topUrl","pageUrl","mediaManifest","mediaDomain"]});function gd(e,t,r){return new Map([...e.entries()].filter(([,i])=>!t.some(o=>fd.some(a=>{if(a in i){let s=i[a];if(typeof s=="string")try{let l=new URL(s).hostname.split(".").reverse();for(let p=0;p<l.length;p++)if(l[p]!=o[p])return!1;return!0}catch{}}return!1}))).filter(([,i])=>i.status=="running"?!0:!(typeof i.length=="number"&&i.length<r)))}function hd(e,t){let r=new Map;for(let a of e.values()){let s=a.group??a.id;r.has(s)||r.set(s,[]),r.get(s).push(a)}let i=[...r.values()];for(let a of i)a.sort((s,u)=>!s.core_media||!u.core_media?(console.warn("No core_media for hit"),0):ud(s.core_media,u.core_media,t));i.sort((a,s)=>{let c=a[0]?.core_media?.builder,g=s[0]?.core_media?.builder;return c===g?0:c==="HTTPMedia"?1:g==="HTTPMedia"?-1:c==="NakedHls"?1:g==="NakedHls"||c==="Hls"?-1:g==="Hls"?1:c==="MPDParser"?-1:g==="MPDParser"?1:0});let n=a=>{let s=a[0]?.status=="active",u=a[0]?.core_media?.builder==="Hls"||a[0]?.core_media?.builder==="JsonMPDParser"||a[0]?.core_media?.builder==="MPDParser";return s&&u},o=a=>a.every(s=>s.status=="active");return t.ignore_low_quality_hits&&i.some(n)&&(i=i.filter(a=>{let s=o(a),u=n(a);return!(s&&!u)})),i.map(a=>a.map(s=>{let u={};for(let l of cd)u[l]=s[l];for(let l of pd)u[l]=s[l];for(let l of dd)u[l]=s[l];return u}).slice(0,t.max_variants))}var yd=I(()=>{"use strict";Oi();md()});var rr,qr,jn=I(()=>{"use strict";rr=(e,t)=>typeof e[t]=="string",qr=(e,t)=>typeof e[t]=="number"});function Pi(e){try{if(rr(e,"__serializer_tag")){if(e.__serializer_tag==="primitive")return $(e.__serializer_value);if(e.__serializer_tag==="array"){let i=[];for(let n of e.__serializer_value){let o=Pi(n);if(o.isErr())return o;i.push(o.unwrap())}return $(i)}else if(e.__serializer_tag==="option_some"){let i=e.__serializer_value,n=Pi(i);return n.isErr()?n:$(C(n.unwrap()))}else if(e.__serializer_tag==="option_none")return $(M)}let t=typeof e;if(t==="string"||t==="number"||t==="boolean"||t==="undefined"||Array.isArray(e)||e==null)return K("This object was not serialized with Serialize");let r={};for(let i of Object.keys(e))if(typeof i=="string"){let n=Pi(e[i]);if(n.isErr())return n;r[i]=n.unwrap()}return $(r)}catch{return K("Failed to inspect object. Not JSON?")}}var vd=I(()=>{"use strict";me();jn();He()});function P0(){return{prefer_60fps:!0,ignore_low_quality_hits:!0,max_variants:3,container:"Mp4",video_codec:"H264",best_video_quality:"4320",lowest_video_quality:"480",ignored_containers:[],ignored_video_codecs:[]}}function bd(e){let t=Pi(e).unwrapOr({}),r=P0(),i=Ds(t.container).unwrapOr(r.container),n=Ms(t.video_codec).unwrapOr(r.video_codec),o=Vn(t.best_video_quality).unwrapOr(r.best_video_quality),a=Vn(t.lowest_video_quality).unwrapOr(r.lowest_video_quality),s=r.max_variants;if(typeof t.max_variants=="number"){let g=t.max_variants;Number.isInteger(g)&&g<=11&&g>0&&(s=g)}let u=r.prefer_60fps;typeof t.prefer_60fps=="boolean"&&(u=t.prefer_60fps);let l=r.ignore_low_quality_hits;typeof t.ignore_low_quality_hits=="boolean"&&(l=t.ignore_low_quality_hits);let p=[];if(Array.isArray(t.ignored_containers))for(let g of t.ignored_containers){let b=Ds(g);b.isSome()&&p.push(b.unwrap())}let c=[];if(Array.isArray(t.ignored_video_codecs))for(let g of t.ignored_video_codecs){let b=Ms(g);b.isSome()&&c.push(b.unwrap())}return{prefer_60fps:u,ignore_low_quality_hits:l,container:i,max_variants:s,video_codec:n,lowest_video_quality:a,best_video_quality:o,ignored_containers:p,ignored_video_codecs:c}}var kr,Ad=I(()=>{"use strict";vd();mt();ft();Cr();He();kr="user_media_preferences"});var wd=m((KR,_d)=>{var M0=typeof global=="object"&&global&&global.Object===Object&&global;_d.exports=M0});var Ed=m((zR,xd)=>{var R0=wd(),D0=typeof self=="object"&&self&&self.Object===Object&&self,I0=R0||D0||Function("return this")();xd.exports=I0});var Is=m((JR,Td)=>{var N0=Ed(),C0=N0.Symbol;Td.exports=C0});var Md=m((YR,Pd)=>{var Sd=Is(),Od=Object.prototype,q0=Od.hasOwnProperty,k0=Od.toString,Mi=Sd?Sd.toStringTag:void 0;function B0(e){var t=q0.call(e,Mi),r=e[Mi];try{e[Mi]=void 0;var i=!0}catch{}var n=k0.call(e);return i&&(t?e[Mi]=r:delete e[Mi]),n}Pd.exports=B0});var Dd=m((ZR,Rd)=>{var F0=Object.prototype,V0=F0.toString;function H0(e){return V0.call(e)}Rd.exports=H0});var qd=m((eD,Cd)=>{var Id=Is(),j0=Md(),L0=Dd(),U0="[object Null]",W0="[object Undefined]",Nd=Id?Id.toStringTag:void 0;function G0(e){return e==null?e===void 0?W0:U0:Nd&&Nd in Object(e)?j0(e):L0(e)}Cd.exports=G0});var Bd=m((tD,kd)=>{function X0(e,t){return function(r){return e(t(r))}}kd.exports=X0});var Vd=m((rD,Fd)=>{var $0=Bd(),Q0=$0(Object.getPrototypeOf,Object);Fd.exports=Q0});var jd=m((iD,Hd)=>{function K0(e){return e!=null&&typeof e=="object"}Hd.exports=K0});var Ns=m((nD,Ud)=>{var z0=qd(),J0=Vd(),Y0=jd(),Z0="[object Object]",e1=Function.prototype,t1=Object.prototype,Ld=e1.toString,r1=t1.hasOwnProperty,i1=Ld.call(Object);function n1(e){if(!Y0(e)||z0(e)!=Z0)return!1;var t=J0(e);if(t===null)return!0;var r=r1.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Ld.call(r)==i1}Ud.exports=n1});var Wd=m(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});Cs.default=o1;function o1(e){var t,r=e.Symbol;return typeof r=="function"?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}});var Gd=m((ks,qs)=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});var a1=Wd(),s1=u1(a1);function u1(e){return e&&e.__esModule?e:{default:e}}var Br;typeof self<"u"?Br=self:typeof window<"u"?Br=window:typeof global<"u"?Br=global:typeof qs<"u"?Br=qs:Br=Function("return this")();var l1=(0,s1.default)(Br);ks.default=l1});var Bs=m(Ri=>{"use strict";Ri.__esModule=!0;Ri.ActionTypes=void 0;Ri.default=Kd;var c1=Ns(),p1=Qd(c1),d1=Gd(),Xd=Qd(d1);function Qd(e){return e&&e.__esModule?e:{default:e}}var $d=Ri.ActionTypes={INIT:"@@redux/INIT"};function Kd(e,t,r){var i;if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error("Expected the enhancer to be a function.");return r(Kd)(e,t)}if(typeof e!="function")throw new Error("Expected the reducer to be a function.");var n=e,o=t,a=[],s=a,u=!1;function l(){s===a&&(s=a.slice())}function p(){return o}function c(A){if(typeof A!="function")throw new Error("Expected listener to be a function.");var f=!0;return l(),s.push(A),function(){if(f){f=!1,l();var y=s.indexOf(A);s.splice(y,1)}}}function g(A){if(!(0,p1.default)(A))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(typeof A.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(u)throw new Error("Reducers may not dispatch actions.");try{u=!0,o=n(o,A)}finally{u=!1}for(var f=a=s,h=0;h<f.length;h++){var y=f[h];y()}return A}function b(A){if(typeof A!="function")throw new Error("Expected the nextReducer to be a function.");n=A,g({type:$d.INIT})}function d(){var A,f=c;return A={subscribe:function(y){if(typeof y!="object")throw new TypeError("Expected the observer to be an object.");function T(){y.next&&y.next(p())}T();var w=f(T);return{unsubscribe:w}}},A[Xd.default]=function(){return this},A}return g({type:$d.INIT}),i={dispatch:g,subscribe:c,getState:p,replaceReducer:b},i[Xd.default]=d,i}});var Vs=m(Fs=>{"use strict";Fs.__esModule=!0;Fs.default=f1;function f1(e){typeof console<"u"&&typeof console.error=="function"&&console.error(e);try{throw new Error(e)}catch{}}});var Yd=m(Hs=>{"use strict";Hs.__esModule=!0;Hs.default=v1;var zd=Bs(),m1=Ns(),uD=Jd(m1),g1=Vs(),lD=Jd(g1);function Jd(e){return e&&e.__esModule?e:{default:e}}function h1(e,t){var r=t&&t.type,i=r&&'"'+r.toString()+'"'||"an action";return"Given action "+i+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function y1(e){Object.keys(e).forEach(function(t){var r=e[t],i=r(void 0,{type:zd.ActionTypes.INIT});if(typeof i>"u")throw new Error('Reducer "'+t+`" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);var n="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if(typeof r(void 0,{type:n})>"u")throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+zd.ActionTypes.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")})}function v1(e){for(var t=Object.keys(e),r={},i=0;i<t.length;i++){var n=t[i];typeof e[n]=="function"&&(r[n]=e[n])}var o=Object.keys(r),a=void 0,s=void 0;try{y1(r)}catch(u){s=u}return function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=arguments[1];if(s)throw s;if(0)var c;for(var g=!1,b={},d=0;d<o.length;d++){var A=o[d],f=r[A],h=l[A],y=f(h,p);if(typeof y>"u"){var T=h1(A,p);throw new Error(T)}b[A]=y,g=g||y!==h}return g?b:l}}});var ef=m(js=>{"use strict";js.__esModule=!0;js.default=b1;function Zd(e,t){return function(){return t(e.apply(void 0,arguments))}}function b1(e,t){if(typeof e=="function")return Zd(e,t);if(typeof e!="object"||e===null)throw new Error("bindActionCreators expected an object or a function, instead received "+(e===null?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),i={},n=0;n<r.length;n++){var o=r[n],a=e[o];typeof a=="function"&&(i[o]=Zd(a,t))}return i}});var Us=m(Ls=>{"use strict";Ls.__esModule=!0;Ls.default=A1;function A1(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?function(i){return i}:t.length===1?t[0]:t.reduce(function(i,n){return function(){return i(n.apply(void 0,arguments))}})}});var tf=m(Ws=>{"use strict";Ws.__esModule=!0;var _1=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};Ws.default=T1;var w1=Us(),x1=E1(w1);function E1(e){return e&&e.__esModule?e:{default:e}}function T1(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(i){return function(n,o,a){var s=i(n,o,a),u=s.dispatch,l=[],p={getState:s.getState,dispatch:function(g){return u(g)}};return l=t.map(function(c){return c(p)}),u=x1.default.apply(void 0,l)(s.dispatch),_1({},s,{dispatch:u})}}}});var rf=m(Ie=>{"use strict";Ie.__esModule=!0;Ie.compose=Ie.applyMiddleware=Ie.bindActionCreators=Ie.combineReducers=Ie.createStore=void 0;var S1=Bs(),O1=Fr(S1),P1=Yd(),M1=Fr(P1),R1=ef(),D1=Fr(R1),I1=tf(),N1=Fr(I1),C1=Us(),q1=Fr(C1),k1=Vs(),mD=Fr(k1);function Fr(e){return e&&e.__esModule?e:{default:e}}Ie.createStore=O1.default;Ie.combineReducers=M1.default;Ie.bindActionCreators=D1.default;Ie.applyMiddleware=N1.default;Ie.compose=q1.default});var of=m((Ln,nf)=>{(function(e,t){typeof Ln=="object"&&typeof nf<"u"?t(Ln):typeof define=="function"&&define.amd?define(["exports"],t):t(e.reduxLogger=e.reduxLogger||{})})(Ln,function(e){"use strict";function t(v,E){v.super_=E,v.prototype=Object.create(E.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}})}function r(v,E){Object.defineProperty(this,"kind",{value:v,enumerable:!0}),E&&E.length&&Object.defineProperty(this,"path",{value:E,enumerable:!0})}function i(v,E,_){i.super_.call(this,"E",v),Object.defineProperty(this,"lhs",{value:E,enumerable:!0}),Object.defineProperty(this,"rhs",{value:_,enumerable:!0})}function n(v,E){n.super_.call(this,"N",v),Object.defineProperty(this,"rhs",{value:E,enumerable:!0})}function o(v,E){o.super_.call(this,"D",v),Object.defineProperty(this,"lhs",{value:E,enumerable:!0})}function a(v,E,_){a.super_.call(this,"A",v),Object.defineProperty(this,"index",{value:E,enumerable:!0}),Object.defineProperty(this,"item",{value:_,enumerable:!0})}function s(v,E,_){var R=v.slice((_||E)+1||v.length);return v.length=E<0?v.length+E:E,v.push.apply(v,R),v}function u(v){var E=typeof v>"u"?"undefined":V(v);return E!=="object"?E:v===Math?"math":v===null?"null":Array.isArray(v)?"array":Object.prototype.toString.call(v)==="[object Date]"?"date":typeof v.toString=="function"&&/^\/.*\//.test(v.toString())?"regexp":"object"}function l(v,E,_,R,F,H,j){F=F||[],j=j||[];var U=F.slice(0);if(typeof H<"u"){if(R){if(typeof R=="function"&&R(U,H))return;if((typeof R>"u"?"undefined":V(R))==="object"){if(R.prefilter&&R.prefilter(U,H))return;if(R.normalize){var Me=R.normalize(U,H,v,E);Me&&(v=Me[0],E=Me[1])}}}U.push(H)}u(v)==="regexp"&&u(E)==="regexp"&&(v=v.toString(),E=E.toString());var Be=typeof v>"u"?"undefined":V(v),_e=typeof E>"u"?"undefined":V(E),ue=Be!=="undefined"||j&&j[j.length-1].lhs&&j[j.length-1].lhs.hasOwnProperty(H),Fe=_e!=="undefined"||j&&j[j.length-1].rhs&&j[j.length-1].rhs.hasOwnProperty(H);if(!ue&&Fe)_(new n(U,E));else if(!Fe&&ue)_(new o(U,v));else if(u(v)!==u(E))_(new i(U,v,E));else if(u(v)==="date"&&v-E!==0)_(new i(U,v,E));else if(Be==="object"&&v!==null&&E!==null)if(j.filter(function(te){return te.lhs===v}).length)v!==E&&_(new i(U,v,E));else{if(j.push({lhs:v,rhs:E}),Array.isArray(v)){var Q;for(v.length,Q=0;Q<v.length;Q++)Q>=E.length?_(new a(U,Q,new o(void 0,v[Q]))):l(v[Q],E[Q],_,R,U,Q,j);for(;Q<E.length;)_(new a(U,Q,new n(void 0,E[Q++])))}else{var Yt=Object.keys(v),ut=Object.keys(E);Yt.forEach(function(te,Tr){var hi=ut.indexOf(te);hi>=0?(l(v[te],E[te],_,R,U,te,j),ut=s(ut,hi)):l(v[te],void 0,_,R,U,te,j)}),ut.forEach(function(te){l(void 0,E[te],_,R,U,te,j)})}j.length=j.length-1}else v!==E&&(Be==="number"&&isNaN(v)&&isNaN(E)||_(new i(U,v,E)))}function p(v,E,_,R){return R=R||[],l(v,E,function(F){F&&R.push(F)},_),R.length?R:void 0}function c(v,E,_){if(_.path&&_.path.length){var R,F=v[E],H=_.path.length-1;for(R=0;R<H;R++)F=F[_.path[R]];switch(_.kind){case"A":c(F[_.path[R]],_.index,_.item);break;case"D":delete F[_.path[R]];break;case"E":case"N":F[_.path[R]]=_.rhs}}else switch(_.kind){case"A":c(v[E],_.index,_.item);break;case"D":v=s(v,E);break;case"E":case"N":v[E]=_.rhs}return v}function g(v,E,_){if(v&&E&&_&&_.kind){for(var R=v,F=-1,H=_.path?_.path.length-1:0;++F<H;)typeof R[_.path[F]]>"u"&&(R[_.path[F]]=typeof _.path[F]=="number"?[]:{}),R=R[_.path[F]];switch(_.kind){case"A":c(_.path?R[_.path[F]]:R,_.index,_.item);break;case"D":delete R[_.path[F]];break;case"E":case"N":R[_.path[F]]=_.rhs}}}function b(v,E,_){if(_.path&&_.path.length){var R,F=v[E],H=_.path.length-1;for(R=0;R<H;R++)F=F[_.path[R]];switch(_.kind){case"A":b(F[_.path[R]],_.index,_.item);break;case"D":F[_.path[R]]=_.lhs;break;case"E":F[_.path[R]]=_.lhs;break;case"N":delete F[_.path[R]]}}else switch(_.kind){case"A":b(v[E],_.index,_.item);break;case"D":v[E]=_.lhs;break;case"E":v[E]=_.lhs;break;case"N":v=s(v,E)}return v}function d(v,E,_){if(v&&E&&_&&_.kind){var R,F,H=v;for(F=_.path.length-1,R=0;R<F;R++)typeof H[_.path[R]]>"u"&&(H[_.path[R]]={}),H=H[_.path[R]];switch(_.kind){case"A":b(H[_.path[R]],_.index,_.item);break;case"D":H[_.path[R]]=_.lhs;break;case"E":H[_.path[R]]=_.lhs;break;case"N":delete H[_.path[R]]}}}function A(v,E,_){if(v&&E){var R=function(F){_&&!_(v,E,F)||g(v,E,F)};l(v,E,R)}}function f(v){return"color: "+ae[v].color+"; font-weight: bold"}function h(v){var E=v.kind,_=v.path,R=v.lhs,F=v.rhs,H=v.index,j=v.item;switch(E){case"E":return[_.join("."),R,"\u2192",F];case"N":return[_.join("."),F];case"D":return[_.join(".")];case"A":return[_.join(".")+"["+H+"]",j];default:return[]}}function y(v,E,_,R){var F=p(v,E);try{R?_.groupCollapsed("diff"):_.group("diff")}catch{_.log("diff")}F?F.forEach(function(H){var j=H.kind,U=h(H);_.log.apply(_,["%c "+ae[j].text,f(j)].concat(ee(U)))}):_.log("\u2014\u2014 no diff \u2014\u2014");try{_.groupEnd()}catch{_.log("\u2014\u2014 diff end \u2014\u2014 ")}}function T(v,E,_,R){switch(typeof v>"u"?"undefined":V(v)){case"object":return typeof v[R]=="function"?v[R].apply(v,ee(_)):v[R];case"function":return v(E);default:return v}}function w(v){var E=v.timestamp,_=v.duration;return function(R,F,H){var j=["action"];return j.push("%c"+String(R.type)),E&&j.push("%c@ "+F),_&&j.push("%c(in "+H.toFixed(2)+" ms)"),j.join(" ")}}function S(v,E){var _=E.logger,R=E.actionTransformer,F=E.titleFormatter,H=F===void 0?w(E):F,j=E.collapsed,U=E.colors,Me=E.level,Be=E.diff,_e=typeof E.titleFormatter>"u";v.forEach(function(ue,Fe){var Q=ue.started,Yt=ue.startedTime,ut=ue.action,te=ue.prevState,Tr=ue.error,hi=ue.took,Zt=ue.nextState,Ka=v[Fe+1];Ka&&(Zt=Ka.prevState,hi=Ka.started-Q);var Ke=R(ut),pp=typeof j=="function"?j(function(){return Zt},ut,ue):j,S_=q(Yt),O_=U.title?"color: "+U.title(Ke)+";":"",yi=["color: gray; font-weight: lighter;"];yi.push(O_),E.timestamp&&yi.push("color: gray; font-weight: lighter;"),E.duration&&yi.push("color: gray; font-weight: lighter;");var vi=H(Ke,S_,hi);try{pp?U.title&&_e?_.groupCollapsed.apply(_,["%c "+vi].concat(yi)):_.groupCollapsed(vi):U.title&&_e?_.group.apply(_,["%c "+vi].concat(yi)):_.group(vi)}catch{_.log(vi)}var za=T(Me,Ke,[te],"prevState"),Ja=T(Me,Ke,[Ke],"action"),Ya=T(Me,Ke,[Tr,te],"error"),Za=T(Me,Ke,[Zt],"nextState");if(za)if(U.prevState){var P_="color: "+U.prevState(te)+"; font-weight: bold";_[za]("%c prev state",P_,te)}else _[za]("prev state",te);if(Ja)if(U.action){var M_="color: "+U.action(Ke)+"; font-weight: bold";_[Ja]("%c action    ",M_,Ke)}else _[Ja]("action    ",Ke);if(Tr&&Ya)if(U.error){var R_="color: "+U.error(Tr,te)+"; font-weight: bold;";_[Ya]("%c error     ",R_,Tr)}else _[Ya]("error     ",Tr);if(Za)if(U.nextState){var D_="color: "+U.nextState(Zt)+"; font-weight: bold";_[Za]("%c next state",D_,Zt)}else _[Za]("next state",Zt);Be&&y(te,Zt,_,pp);try{_.groupEnd()}catch{_.log("\u2014\u2014 log end \u2014\u2014")}})}function x(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=Object.assign({},Er,v),_=E.logger,R=E.stateTransformer,F=E.errorTransformer,H=E.predicate,j=E.logErrors,U=E.diffPredicate;if(typeof _>"u")return function(){return function(Be){return function(_e){return Be(_e)}}};if(v.getState&&v.dispatch)return console.error(`[redux-logger] redux-logger not installed. Make sure to pass logger instance as middleware:
// Logger with default options
import { logger } from 'redux-logger'
const store = createStore(
  reducer,
  applyMiddleware(logger)
)
// Or you can create your own logger with custom options http://bit.ly/redux-logger-options
import createLogger from 'redux-logger'
const logger = createLogger({
  // ...options
});
const store = createStore(
  reducer,
  applyMiddleware(logger)
)
`),function(){return function(Be){return function(_e){return Be(_e)}}};var Me=[];return function(Be){var _e=Be.getState;return function(ue){return function(Fe){if(typeof H=="function"&&!H(_e,Fe))return ue(Fe);var Q={};Me.push(Q),Q.started=W.now(),Q.startedTime=new Date,Q.prevState=R(_e()),Q.action=Fe;var Yt=void 0;if(j)try{Yt=ue(Fe)}catch(te){Q.error=F(te)}else Yt=ue(Fe);Q.took=W.now()-Q.started,Q.nextState=R(_e());var ut=E.diff&&typeof U=="function"?U(_e,Fe):E.diff;if(S(Me,Object.assign({},E,{diff:ut})),Me.length=0,Q.error)throw Q.error;return Yt}}}}var O,D,N=function(v,E){return new Array(E+1).join(v)},B=function(v,E){return N("0",E-v.toString().length)+v},q=function(v){return B(v.getHours(),2)+":"+B(v.getMinutes(),2)+":"+B(v.getSeconds(),2)+"."+B(v.getMilliseconds(),3)},W=typeof performance<"u"&&performance!==null&&typeof performance.now=="function"?performance:Date,V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},ee=function(v){if(Array.isArray(v)){for(var E=0,_=Array(v.length);E<v.length;E++)_[E]=v[E];return _}return Array.from(v)},Pe=[];O=(typeof global>"u"?"undefined":V(global))==="object"&&global?global:typeof window<"u"?window:{},D=O.DeepDiff,D&&Pe.push(function(){typeof D<"u"&&O.DeepDiff===p&&(O.DeepDiff=D,D=void 0)}),t(i,r),t(n,r),t(o,r),t(a,r),Object.defineProperties(p,{diff:{value:p,enumerable:!0},observableDiff:{value:l,enumerable:!0},applyDiff:{value:A,enumerable:!0},applyChange:{value:g,enumerable:!0},revertChange:{value:d,enumerable:!0},isConflict:{value:function(){return typeof D<"u"},enumerable:!0},noConflict:{value:function(){return Pe&&(Pe.forEach(function(v){v()}),Pe=null),p},enumerable:!0}});var ae={E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}},Er={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(v){return v},actionTransformer:function(v){return v},errorTransformer:function(v){return v},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},cp=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=v.dispatch,_=v.getState;return typeof E=="function"||typeof _=="function"?x()({dispatch:E,getState:_}):void console.error(`
[redux-logger v3] BREAKING CHANGE
[redux-logger v3] Since 3.0.0 redux-logger exports by default logger with default settings.
[redux-logger v3] Change
[redux-logger v3] import createLogger from 'redux-logger'
[redux-logger v3] to
[redux-logger v3] import { createLogger } from 'redux-logger'
`)};e.defaults=Er,e.createLogger=x,e.logger=cp,e.default=cp,Object.defineProperty(e,"__esModule",{value:!0})})});var sf=m((af,Un)=>{(function(e,t){"use strict";typeof Un=="object"&&typeof Un.exports=="object"?Un.exports=t():typeof define=="function"&&define.amd?define([],t):e.objectPath=t()})(af,function(){"use strict";var e=Object.prototype.toString;function t(p,c){return p==null?!1:Object.prototype.hasOwnProperty.call(p,c)}function r(p){if(!p||o(p)&&p.length===0)return!0;if(typeof p!="string"){for(var c in p)if(t(p,c))return!1;return!0}return!1}function i(p){return e.call(p)}function n(p){return typeof p=="object"&&i(p)==="[object Object]"}var o=Array.isArray||function(p){return e.call(p)==="[object Array]"};function a(p){return typeof p=="boolean"||i(p)==="[object Boolean]"}function s(p){var c=parseInt(p);return c.toString()===p?c:p}function u(p){p=p||{};var c=function(f){return Object.keys(c).reduce(function(h,y){return y==="create"||typeof c[y]=="function"&&(h[y]=c[y].bind(c,f)),h},{})},g;p.includeInheritedProps?g=function(){return!0}:g=function(f,h){return typeof h=="number"&&Array.isArray(f)||t(f,h)};function b(f,h){if(g(f,h))return f[h]}var d;p.includeInheritedProps?d=function(f,h){typeof h!="string"&&typeof h!="number"&&(h=String(h));var y=b(f,h);if(h==="__proto__"||h==="prototype"||h==="constructor"&&typeof y=="function")throw new Error("For security reasons, object's magic properties cannot be set");return y}:d=function(f,h){return b(f,h)};function A(f,h,y,T){if(typeof h=="number"&&(h=[h]),!h||h.length===0)return f;if(typeof h=="string")return A(f,h.split(".").map(s),y,T);var w=h[0],S=d(f,w);return h.length===1?((S===void 0||!T)&&(f[w]=y),S):(S===void 0&&(typeof h[1]=="number"?f[w]=[]:f[w]={}),A(f[w],h.slice(1),y,T))}return c.has=function(f,h){if(typeof h=="number"?h=[h]:typeof h=="string"&&(h=h.split(".")),!h||h.length===0)return!!f;for(var y=0;y<h.length;y++){var T=s(h[y]);if(typeof T=="number"&&o(f)&&T<f.length||(p.includeInheritedProps?T in Object(f):t(f,T)))f=f[T];else return!1}return!0},c.ensureExists=function(f,h,y){return A(f,h,y,!0)},c.set=function(f,h,y,T){return A(f,h,y,T)},c.insert=function(f,h,y,T){var w=c.get(f,h);T=~~T,o(w)||(w=[],c.set(f,h,w)),w.splice(T,0,y)},c.empty=function(f,h){if(!r(h)&&f!=null){var y,T;if(y=c.get(f,h)){if(typeof y=="string")return c.set(f,h,"");if(a(y))return c.set(f,h,!1);if(typeof y=="number")return c.set(f,h,0);if(o(y))y.length=0;else if(n(y))for(T in y)g(y,T)&&delete y[T];else return c.set(f,h,null)}}},c.push=function(f,h){var y=c.get(f,h);o(y)||(y=[],c.set(f,h,y)),y.push.apply(y,Array.prototype.slice.call(arguments,2))},c.coalesce=function(f,h,y){for(var T,w=0,S=h.length;w<S;w++)if((T=c.get(f,h[w]))!==void 0)return T;return y},c.get=function(f,h,y){if(typeof h=="number"&&(h=[h]),!h||h.length===0)return f;if(f==null)return y;if(typeof h=="string")return c.get(f,h.split("."),y);var T=s(h[0]),w=d(f,T);return w===void 0?y:h.length===1?w:c.get(f[T],h.slice(1),y)},c.del=function(h,y){if(typeof y=="number"&&(y=[y]),h==null||r(y))return h;if(typeof y=="string")return c.del(h,y.split("."));var T=s(y[0]);if(d(h,T),!g(h,T))return h;if(y.length===1)o(h)?h.splice(T,1):delete h[T];else return c.del(h[T],y.slice(1));return h},c}var l=u();return l.create=u,l.withInheritedProps=u({includeInheritedProps:!0}),l})});var cf=m((hD,lf)=>{"use strict";var uf=sf().get;function B1(e,t){return e===t}function F1(e,t,r){r=r||B1;var i=uf(e(),t);return function(o){return function(){var a=uf(e(),t);if(!r(i,a)){var s=i;i=a,o(a,s,t)}}}}lf.exports=F1});var Wn={};Z(Wn,{clear:()=>df,error:()=>L1,getEntry:()=>mf,log:()=>pf,logDetails:()=>ff,reducer:()=>j1});function j1(e=[],t){switch(t.type){case"log.new":e=e.concat([Object.assign({key:++H1},t.payload)]);break;case"log.clear":e=[];break}return e}function pf(e,t="log"){if(e instanceof Error){let r="";e.fileName&&e.lineNumber&&(r=e.fileName+":"+e.lineNumber,r.columnNumber&&(r+=":"+e.columnNumber),r+=`
`),e.stack&&(r+=e.stack),e={message:e.message,details:e.details||r||void 0,videoTitle:e.videoTitle||void 0}}else typeof e=="string"?e={message:e}:e={message:e.message||""+e,details:e.details||void 0};Xs.dispatch("log.new",Object.assign(e,{type:t}))}function L1(e){pf(e,"error")}function df(){Xs.dispatch("log.clear")}function ff(e){Gs.rpc.call("main","embed",V1.runtime.getURL("content/logdetails-embed.html?panel=logdetails#"+encodeURIComponent(e)))}function mf(e){let t=null;if(Xs.getLogs().forEach(i=>{i.key==e&&(t=i)}),t)return t;throw new Error("Log entry not found")}var Gs,V1,Xs,H1,Gn=I(()=>{"use strict";Gs=J(),V1=Gs.browser,Xs=(Ce(),P(Ne)),H1=0;Gs.rpc.listen({clearLogs:df,logDetails:ff,getLogEntry:mf})});var hf=m(gf=>{"use strict";Object.defineProperty(gf,"__esModule",{value:!0})});var Di=m(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.THROW_THE_ERROR=void 0;Xn.THROW_THE_ERROR=e=>{throw e}});var Ii=m(ir=>{"use strict";var U1=ir&&ir.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),W1=ir&&ir.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&U1(t,e,r)};Object.defineProperty(ir,"__esModule",{value:!0});W1(Di(),ir)});var yf=m($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.httpStatusCodeFrom=void 0;var G1=Qn(),X1=Ii();function $1(e,t=X1.THROW_THE_ERROR){return G1.mustBeHttpStatusCode(e,t),e}$n.httpStatusCodeFrom=$1});var vf=m(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.isHttpStatusCode=void 0;function Q1(e){return e>=100&&e<=599}Kn.isHttpStatusCode=Q1});var nr=m(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.AppError=void 0;var $s=class extends Error{constructor(t){super(t.detail),this.details=t,this.name=this.details.packageName+"/"+this.details.errorName}};zn.AppError=$s});var Ks=m(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.ValueObject=void 0;var Qs=class{constructor(t){this.value=t}valueOf(){return this.value}isValue(){return!0}};Jn.ValueObject=Qs});var or=m(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.StructuredProblemReport=void 0;var K1=Ks(),zs=class e extends K1.ValueObject{static from(t){return new e(t)}get detail(){return this.value.template.detail}get errorId(){var t;return(t=this.value.errorId)!==null&&t!==void 0?t:null}get errorName(){return this.value.template.errorName}get extra(){return this.value.extra}get fqErrorName(){return this.packageName+"/"+this.errorName}get packageName(){return this.value.template.packageName}get status(){return this.value.template.status}get template(){return this.value.template}};Yn.StructuredProblemReport=zs});var ar=m(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.ERROR_TABLE=we.PackageErrorTable=we.PACKAGE_NAME=void 0;we.PACKAGE_NAME="@ganbarodigital/ts-lib-error-reporting/lib/v1";var Zn=class{constructor(){this["http-status-code-out-of-range"]={packageName:we.PACKAGE_NAME,errorName:"http-status-code-out-of-range",detail:"input falls outside the range of a valid HTTP status code",status:422},this["invalid-package-name"]={packageName:we.PACKAGE_NAME,errorName:"invalid-package-name",detail:"package name does not meet spec 'isPackageName()'",status:422},this["not-an-integer"]={packageName:we.PACKAGE_NAME,errorName:"not-an-integer",detail:"input must be an integer; was a float",status:422},this["not-implemented"]={packageName:we.PACKAGE_NAME,errorName:"not-implemented",detail:"this function or feature has not been implemented",status:500},this["unreachable-code"]={packageName:we.PACKAGE_NAME,errorName:"unreachable-code",status:500,detail:"this code should never execute"}}};we.PackageErrorTable=Zn;we.ERROR_TABLE=new Zn});var Ys=m(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.HttpStatusCodeOutOfRangeError=void 0;var z1=nr(),J1=or(),Y1=ar(),Js=class extends z1.AppError{constructor(t){let r={template:Y1.ERROR_TABLE["http-status-code-out-of-range"],errorId:t.errorId,extra:{public:t.public}};super(J1.StructuredProblemReport.from(r))}};eo.HttpStatusCodeOutOfRangeError=Js});var eu=m(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.NotAnIntegerError=void 0;var Z1=nr(),ew=or(),tw=ar(),Zs=class extends Z1.AppError{constructor(t){let r={template:tw.ERROR_TABLE["not-an-integer"],errorId:t.errorId,extra:{public:t.public}};super(ew.StructuredProblemReport.from(r))}};to.NotAnIntegerError=Zs});var bf=m(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.mustBeHttpStatusCode=void 0;var rw=Qn(),iw=Ys(),nw=eu(),ow=Ii();function aw(e,t=ow.THROW_THE_ERROR){e>>>0!==e&&t(new nw.NotAnIntegerError({public:{input:e}})),rw.isHttpStatusCode(e)||t(new iw.HttpStatusCodeOutOfRangeError({public:{input:e}}))}ro.mustBeHttpStatusCode=aw});var Qn=m(Je=>{"use strict";var sw=Je&&Je.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),io=Je&&Je.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&sw(t,e,r)};Object.defineProperty(Je,"__esModule",{value:!0});io(hf(),Je);io(yf(),Je);io(vf(),Je);io(bf(),Je)});var Af=m(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});var tu=Qn();Object.defineProperty(Ni,"isHttpStatusCode",{enumerable:!0,get:function(){return tu.isHttpStatusCode}});Object.defineProperty(Ni,"mustBeHttpStatusCode",{enumerable:!0,get:function(){return tu.mustBeHttpStatusCode}});Object.defineProperty(Ni,"httpStatusCodeFrom",{enumerable:!0,get:function(){return tu.httpStatusCodeFrom}})});var _f=m(sr=>{"use strict";var uw=sr&&sr.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),lw=sr&&sr.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&uw(t,e,r)};Object.defineProperty(sr,"__esModule",{value:!0});lw(Af(),sr)});var xf=m(wf=>{"use strict";Object.defineProperty(wf,"__esModule",{value:!0})});var Tf=m(Ef=>{"use strict";Object.defineProperty(Ef,"__esModule",{value:!0})});var Sf=m(ht=>{"use strict";var cw=ht&&ht.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),ru=ht&&ht.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&cw(t,e,r)};Object.defineProperty(ht,"__esModule",{value:!0});ru(nr(),ht);ru(xf(),ht);ru(Tf(),ht)});var Pf=m(Of=>{"use strict";Object.defineProperty(Of,"__esModule",{value:!0})});var Mf=m(ur=>{"use strict";var pw=ur&&ur.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),dw=ur&&ur.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&pw(t,e,r)};Object.defineProperty(ur,"__esModule",{value:!0});dw(Pf(),ur)});var Df=m(Rf=>{"use strict";Object.defineProperty(Rf,"__esModule",{value:!0})});var If=m(lr=>{"use strict";var fw=lr&&lr.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),mw=lr&&lr.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&fw(t,e,r)};Object.defineProperty(lr,"__esModule",{value:!0});mw(Df(),lr)});var Nf=m(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.InvalidPackageNameError=void 0;var gw=nr(),hw=or(),yw=ar(),iu=class extends gw.AppError{constructor(t){let r={template:yw.ERROR_TABLE["invalid-package-name"],errorId:t.errorId,extra:{public:t.public}};super(hw.StructuredProblemReport.from(r))}};no.InvalidPackageNameError=iu});var Cf=m(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.NotImplementedError=void 0;var vw=nr(),bw=or(),Aw=ar(),nu=class extends vw.AppError{constructor(t={}){let r={template:Aw.ERROR_TABLE["not-implemented"],errorId:t.errorId};super(bw.StructuredProblemReport.from(r))}};oo.NotImplementedError=nu});var qf=m(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.UnreachableCodeError=void 0;var _w=nr(),ww=or(),xw=ar(),ou=class extends _w.AppError{constructor(t){let r={template:xw.ERROR_TABLE["unreachable-code"],errorId:t.errorId,extra:{logsOnly:t.logsOnly}};super(ww.StructuredProblemReport.from(r))}};ao.UnreachableCodeError=ou});var au=m(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});var Ew=Ys();Object.defineProperty(cr,"HttpStatusCodeOutOfRangeError",{enumerable:!0,get:function(){return Ew.HttpStatusCodeOutOfRangeError}});var Tw=Nf();Object.defineProperty(cr,"InvalidPackageNameError",{enumerable:!0,get:function(){return Tw.InvalidPackageNameError}});var Sw=eu();Object.defineProperty(cr,"NotAnIntegerError",{enumerable:!0,get:function(){return Sw.NotAnIntegerError}});var Ow=Cf();Object.defineProperty(cr,"NotImplementedError",{enumerable:!0,get:function(){return Ow.NotImplementedError}});var Pw=qf();Object.defineProperty(cr,"UnreachableCodeError",{enumerable:!0,get:function(){return Pw.UnreachableCodeError}})});var Bf=m(kf=>{"use strict";Object.defineProperty(kf,"__esModule",{value:!0})});var Vf=m(Ff=>{"use strict";Object.defineProperty(Ff,"__esModule",{value:!0})});var jf=m(Hf=>{"use strict";Object.defineProperty(Hf,"__esModule",{value:!0})});var Uf=m(Lf=>{"use strict";Object.defineProperty(Lf,"__esModule",{value:!0})});var Gf=m(Wf=>{"use strict";Object.defineProperty(Wf,"__esModule",{value:!0})});var Xf=m(Le=>{"use strict";var Mw=Le&&Le.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Ci=Le&&Le.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Mw(t,e,r)};Object.defineProperty(Le,"__esModule",{value:!0});Ci(Bf(),Le);Ci(Vf(),Le);Ci(jf(),Le);Ci(Uf(),Le);Ci(Gf(),Le)});var $f=m(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.extractReasonFromCaught=pr.DEFAULT_ERROR_REASON=void 0;pr.DEFAULT_ERROR_REASON="no error information available";function Rw(e,{stackTrace:t=!1}={}){let r=pr.DEFAULT_ERROR_REASON;return e instanceof Error?(t&&e.stack?r=e.stack:r=e.toString(),r):(e===null||e===void 0||typeof e=="number"&&isNaN(e)||typeof e=="boolean"||e.toString!==void 0&&typeof e.toString=="function"&&e.toString!==Object.prototype.toString&&(r=e.toString()),r)}pr.extractReasonFromCaught=Rw});var Qf=m(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.extractStackFromCaught=void 0;function Dw(e){return e instanceof Error?e.stack.substring(e.stack.indexOf(`
`)+1):""}so.extractStackFromCaught=Dw});var zf=m(It=>{"use strict";var Iw=It&&It.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Kf=It&&It.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Iw(t,e,r)};Object.defineProperty(It,"__esModule",{value:!0});Kf($f(),It);Kf(Qf(),It)});var Yf=m(Jf=>{"use strict";Object.defineProperty(Jf,"__esModule",{value:!0})});var em=m(Zf=>{"use strict";Object.defineProperty(Zf,"__esModule",{value:!0})});var tm=m(yt=>{"use strict";var Nw=yt&&yt.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),su=yt&&yt.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Nw(t,e,r)};Object.defineProperty(yt,"__esModule",{value:!0});su(or(),yt);su(Yf(),yt);su(em(),yt)});var ye=m(he=>{"use strict";var Cw=he&&he.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Nt=he&&he.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Cw(t,e,r)};Object.defineProperty(he,"__esModule",{value:!0});Nt(Sf(),he);Nt(Mf(),he);Nt(If(),he);Nt(au(),he);Nt(Xf(),he);Nt(zf(),he);Nt(Ii(),he);Nt(tm(),he)});var rm=m(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});var qw=ar();Object.defineProperty(uo,"PackageErrorTable",{enumerable:!0,get:function(){return qw.PackageErrorTable}});var kw=ye();Object.defineProperty(uo,"InvalidPackageNameError",{enumerable:!0,get:function(){return kw.InvalidPackageNameError}})});var nm=m(im=>{"use strict";Object.defineProperty(im,"__esModule",{value:!0})});var uu=m(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.isPackageNameData=dr.PackageNameDataRegex=void 0;dr.PackageNameDataRegex=new RegExp("^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]+(/[A-Za-z0-9-~][A-Za-z0-9-._~]+)*$");function Bw(e){return dr.PackageNameDataRegex.test(e)}dr.isPackageNameData=Bw});var lu=m(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.mustBePackageNameData=void 0;var Fw=au(),Vw=Di(),Hw=uu();function jw(e,t=Vw.THROW_THE_ERROR){Hw.isPackageNameData(e)||t(new Fw.InvalidPackageNameError({public:{packageName:e}}))}lo.mustBePackageNameData=jw});var om=m(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.packageNameFrom=void 0;var Lw=Ii(),Uw=lu();function Ww(e,t=Lw.THROW_THE_ERROR){return Uw.mustBePackageNameData(e,t),e}co.packageNameFrom=Ww});var am=m(Ye=>{"use strict";var Gw=Ye&&Ye.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),po=Ye&&Ye.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Gw(t,e,r)};Object.defineProperty(Ye,"__esModule",{value:!0});po(nm(),Ye);po(uu(),Ye);po(lu(),Ye);po(om(),Ye)});var sm=m(fr=>{"use strict";var Xw=fr&&fr.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),$w=fr&&fr.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Xw(t,e,r)};Object.defineProperty(fr,"__esModule",{value:!0});$w(am(),fr)});var lm=m(Ct=>{"use strict";var Qw=Ct&&Ct.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),um=Ct&&Ct.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Qw(t,e,r)};Object.defineProperty(Ct,"__esModule",{value:!0});um(rm(),Ct);um(sm(),Ct)});var cu=m(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.ERROR_TABLE=Vr.PackageErrorTable=void 0;var fo=_f(),Kw=lm(),mo=Kw.packageNameFrom("@ganbarodigital/ts-lib-mediatypes"),go=class{constructor(){this["mediatypematchregex-is-broken"]={packageName:mo,errorName:"mediatypematchregex-is-broken",detail:"the MediaTypeMatchRegex no longer returns the expected named groups",status:fo.httpStatusCodeFrom(500)},this["not-a-content-type"]={packageName:mo,errorName:"not-a-content-type",detail:"the given string does not have the structure of a ContentType",status:fo.httpStatusCodeFrom(422)},this["not-a-media-type"]={packageName:mo,errorName:"not-a-media-type",detail:"the given string does not have the structure of a MediaType",status:fo.httpStatusCodeFrom(422)},this["unexpected-content-type"]={packageName:mo,errorName:"unexpected-content-type",detail:"the given MediaType does not match any of the expected content types",status:fo.httpStatusCodeFrom(422)}}};Vr.PackageErrorTable=go;Vr.ERROR_TABLE=new go});var pm=m(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.NotAContentTypeError=void 0;var cm=ye(),zw=Ze(),pu=class extends cm.AppError{constructor(t){let r={template:zw.ERROR_TABLE["not-a-content-type"],errorId:t.errorId,extra:{public:t.public}};super(cm.StructuredProblemReport.from(r))}};ho.NotAContentTypeError=pu});var fm=m(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.NotAMediaTypeError=void 0;var dm=ye(),Jw=Ze(),du=class extends dm.AppError{constructor(t){let r={template:Jw.ERROR_TABLE["not-a-media-type"],errorId:t.errorId,extra:{public:t.public}};super(dm.StructuredProblemReport.from(r))}};yo.NotAMediaTypeError=du});var bo=m(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.MediaTypeMatchRegexIsBrokenError=void 0;var mm=ye(),Yw=cu(),fu=class extends mm.AppError{constructor(t){let r={template:Yw.ERROR_TABLE["mediatypematchregex-is-broken"],errorId:t.errorId,extra:null};super(mm.StructuredProblemReport.from(r))}};vo.MediaTypeMatchRegexIsBrokenError=fu});var gu=m(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.UnexpectedContentTypeError=void 0;var gm=ye(),Zw=Ze(),mu=class extends gm.AppError{constructor(t){let r={template:Zw.ERROR_TABLE["unexpected-content-type"],errorId:t.errorId,extra:{public:t.public}};super(gm.StructuredProblemReport.from(r))}};Ao.UnexpectedContentTypeError=mu});var Ze=m(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});var ex=cu();Object.defineProperty(mr,"ERROR_TABLE",{enumerable:!0,get:function(){return ex.ERROR_TABLE}});var tx=pm();Object.defineProperty(mr,"NotAContentTypeError",{enumerable:!0,get:function(){return tx.NotAContentTypeError}});var rx=fm();Object.defineProperty(mr,"NotAMediaTypeError",{enumerable:!0,get:function(){return rx.NotAMediaTypeError}});var ix=bo();Object.defineProperty(mr,"MediaTypeMatchRegexIsBrokenError",{enumerable:!0,get:function(){return ix.MediaTypeMatchRegexIsBrokenError}});var nx=gu();Object.defineProperty(mr,"UnexpectedContentTypeError",{enumerable:!0,get:function(){return nx.UnexpectedContentTypeError}})});var ym=m(hm=>{"use strict";Object.defineProperty(hm,"__esModule",{value:!0})});var Hr=m(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.MediaTypeParamRegex=qt.MediaTypeMatchRegex=qt.ContentTypeMatchRegex=void 0;qt.ContentTypeMatchRegex=/^(?<contentType>(?<type>[A-Za-z0-9][-\w!#$&^]*)\/((?<tree>[A-Za-z0-9][\w\d-!#$&^]*)\.){0,1}(?<subtype>[^+()<>@,;:\\/"[\]?=+]+)(\+(?<suffix>[\w\d]+)){0,1})$/;qt.MediaTypeMatchRegex=/^(?<contentType>(?<type>[A-Za-z0-9][-\w!#$&^]*)\/((?<tree>[A-Za-z0-9][\w\d-!#$&^]*)\.){0,1}(?<subtype>[^+()<>@,;:\\/"[\]?=+]+)(\+(?<suffix>[\w\d]+)){0,1})(;[\s]+(?<parameter>[\w\d]+=([^+()<>@,;:\\/"[\]?=]+|"[^"]*\")))*$/;qt.MediaTypeParamRegex=/(;[\s]+((?<parameterName>[\w\d]+)=((?<parameterValueA>[^+()<>@,;:\\/"[\]?=+]+)|"(?<parameterValueB>[^"]*)")))/g});var hu=m(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.isContentType=void 0;var ox=Hr();function ax(e){return ox.ContentTypeMatchRegex.test(e)}_o.isContentType=ax});var yu=m(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.mustBeContentType=void 0;var sx=ye(),ux=Ze(),lx=hu();function cx(e,t=sx.THROW_THE_ERROR){lx.isContentType(e)||t(new ux.NotAContentTypeError({public:{input:e}}))}wo.mustBeContentType=cx});var xo=m(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr._contentTypeFrom=jr.contentTypeFrom=void 0;var px=ye(),dx=yu();jr.contentTypeFrom=vm.bind(null,e=>e.toLowerCase());function vm(e,t,r=px.THROW_THE_ERROR){return dx.mustBeContentType(t,r),e(t)}jr._contentTypeFrom=vm});var Am=m(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr._contentTypeFromMediaType=Lr.contentTypeFromMediaType=void 0;var fx=ye(),mx=Ze(),gx=Hr(),hx=bo(),yx=xo();Lr.contentTypeFromMediaType=bm.bind(null,gx.MediaTypeMatchRegex,e=>e.toLowerCase());function bm(e,t,r,i=fx.THROW_THE_ERROR){let n=r.valueOf(),o=e.exec(n);if(o===null)throw i(new mx.NotAMediaTypeError({public:{input:n}}));if(o.groups===void 0)throw i(new hx.MediaTypeMatchRegexIsBrokenError({}));return yx._contentTypeFrom(t,o.groups.contentType)}Lr._contentTypeFromMediaType=bm});var bu=m(Ue=>{"use strict";var vx=Ue&&Ue.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),vu=Ue&&Ue.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&vx(t,e,r)};Object.defineProperty(Ue,"__esModule",{value:!0});vu(ym(),Ue);var bx=xo();Object.defineProperty(Ue,"contentTypeFrom",{enumerable:!0,get:function(){return bx.contentTypeFrom}});var Ax=Am();Object.defineProperty(Ue,"contentTypeFromMediaType",{enumerable:!0,get:function(){return Ax.contentTypeFromMediaType}});vu(hu(),Ue);vu(yu(),Ue)});var Au=m(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.isMediaType=void 0;var _x=Hr();function wx(e){return _x.MediaTypeMatchRegex.test(e)}Eo.isMediaType=wx});var wm=m(_m=>{"use strict";Object.defineProperty(_m,"__esModule",{value:!0})});var xm=m(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.resolveToContentType=void 0;var xx=So(),Ex=bu();function Tx(e){return e instanceof xx.MediaType?Ex.contentTypeFromMediaType(e):e}To.resolveToContentType=Tx});var Tm=m(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.resolveToMediaType=void 0;var Em=So();function Sx(e){return e instanceof Em.MediaType?e:new Em.MediaType(e)}Oo.resolveToMediaType=Sx});var Po=m(vt=>{"use strict";var Ox=vt&&vt.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),_u=vt&&vt.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Ox(t,e,r)};Object.defineProperty(vt,"__esModule",{value:!0});_u(wm(),vt);_u(xm(),vt);_u(Tm(),vt)});var wu=m(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.matchesContentType=void 0;var Sm=Po();function Px(e,t){let r=Sm.resolveToContentType(e);return t.some(i=>{let n=Sm.resolveToContentType(i);return r===n})}Mo.matchesContentType=Px});var xu=m(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.mustBeMediaType=void 0;var Mx=ye(),Rx=Ze(),Dx=Au();function Ix(e,t=Mx.THROW_THE_ERROR){Dx.isMediaType(e)||t(new Rx.NotAMediaTypeError({public:{input:e}}))}Ro.mustBeMediaType=Ix});var Pm=m(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.mustMatchContentType=void 0;var Nx=ye(),Cx=gu(),qx=wu(),Om=Po();function kx(e,t,r=Nx.THROW_THE_ERROR){if(qx.matchesContentType(e,t))return;let i=t.map(n=>Om.resolveToContentType(n));r(new Cx.UnexpectedContentTypeError({public:{input:Om.resolveToContentType(e),required:{anyOf:i}}}))}Do.mustMatchContentType=kx});var Rm=m(Mm=>{"use strict";Object.defineProperty(Mm,"__esModule",{value:!0})});var Im=m(Dm=>{"use strict";Object.defineProperty(Dm,"__esModule",{value:!0})});var Cm=m(Nm=>{"use strict";Object.defineProperty(Nm,"__esModule",{value:!0})});var qm=m(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.EntityObject=void 0;var Eu=class{constructor(t){this.value=t}valueOf(){return this.value}isEntity(){return!0}};Io.EntityObject=Eu});var Bm=m(km=>{"use strict";Object.defineProperty(km,"__esModule",{value:!0})});var Vm=m(Fm=>{"use strict";Object.defineProperty(Fm,"__esModule",{value:!0})});var jm=m(Hm=>{"use strict";Object.defineProperty(Hm,"__esModule",{value:!0})});var Lm=m(bt=>{"use strict";var Bx=bt&&bt.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Tu=bt&&bt.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Bx(t,e,r)};Object.defineProperty(bt,"__esModule",{value:!0});Tu(Vm(),bt);Tu(jm(),bt);Tu(Ks(),bt)});var Su=m(qe=>{"use strict";var Fx=qe&&qe.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),qi=qe&&qe.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Fx(t,e,r)};Object.defineProperty(qe,"__esModule",{value:!0});qi(Rm(),qe);qi(Im(),qe);qi(Cm(),qe);qi(qm(),qe);qi(Bm(),qe);var Vx=Lm();Object.defineProperty(qe,"ValueObject",{enumerable:!0,get:function(){return Vx.ValueObject}})});var Pu=m(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.RefinedType=void 0;var Hx=Su(),Ou=class extends Hx.ValueObject{constructor(t,r,i){r(t,i),super(t)}};No.RefinedType=Ou});var qo=m(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.RefinedPrimitive=void 0;var jx=Pu(),Mu=class extends jx.RefinedType{};Co.RefinedPrimitive=Mu});var Um=m(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.RefinedNumber=void 0;var Lx=qo(),Ru=class extends Lx.RefinedPrimitive{[Symbol.toPrimitive](t){return t==="string"?this.value.toString():this.value}};ko.RefinedNumber=Ru});var Wm=m(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.RefinedString=void 0;var Ux=qo(),Du=class extends Ux.RefinedPrimitive{[Symbol.toPrimitive](t){return t==="number"?null:this.value}};Bo.RefinedString=Du});var Gm=m(et=>{"use strict";var Wx=et&&et.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Fo=et&&et.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Wx(t,e,r)};Object.defineProperty(et,"__esModule",{value:!0});Fo(Um(),et);Fo(qo(),et);Fo(Wm(),et);Fo(Pu(),et)});var $m=m(Xm=>{"use strict";Object.defineProperty(Xm,"__esModule",{value:!0})});var Qm=m(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.makeRefinedTypeFactory=void 0;var Gx=Di();Vo.makeRefinedTypeFactory=(e,t=Gx.THROW_THE_ERROR)=>(r,i=t)=>(e(r,i),r)});var Km=m(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.makeRefinedTypeFactoryWithFormatter=void 0;var Xx=Di();Ho.makeRefinedTypeFactoryWithFormatter=(e,t,r=Xx.THROW_THE_ERROR)=>(i,n=r)=>(e(i,n),t(i))});var Jm=m(zm=>{"use strict";Object.defineProperty(zm,"__esModule",{value:!0})});var Ym=m(tt=>{"use strict";var $x=tt&&tt.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),jo=tt&&tt.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&$x(t,e,r)};Object.defineProperty(tt,"__esModule",{value:!0});jo($m(),tt);jo(Qm(),tt);jo(Km(),tt);jo(Jm(),tt)});var Zm=m(gr=>{"use strict";var Qx=gr&&gr.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Kx=gr&&gr.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&Qx(t,e,r)};Object.defineProperty(gr,"__esModule",{value:!0});Kx(Ym(),gr)});var eg=m(At=>{"use strict";var zx=At&&At.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Iu=At&&At.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&zx(t,e,r)};Object.defineProperty(At,"__esModule",{value:!0});Iu(Gm(),At);Iu(Zm(),At);Iu(Su(),At)});var Nu=m(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur._parseContentType=Ur.parseContentType=void 0;var Jx=ye(),tg=Ze(),Yx=Hr(),Zx=xo();Ur.parseContentType=rg.bind(null,Yx.MediaTypeMatchRegex,e=>e.toLowerCase());function rg(e,t,r,i=Jx.THROW_THE_ERROR){let n=e.exec(r);if(n===null)throw i(new tg.NotAMediaTypeError({public:{input:r}}));if(n.groups===void 0)throw i(new tg.MediaTypeMatchRegexIsBrokenError({}));return Zx._contentTypeFrom(t,n.groups.contentType)}Ur._parseContentType=rg});var Cu=m(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.parseMediaTypeUnbound=Wr.parseMediaType=void 0;var e3=ye(),t3=Ze(),r3=bo(),ig=Hr();Wr.parseMediaType=ng.bind(null,ig.MediaTypeMatchRegex,ig.MediaTypeParamRegex);function ng(e,t,r,i=e3.THROW_THE_ERROR,n=o=>o.toLocaleLowerCase()){let o=e.exec(r);if(o===null)throw i(new t3.NotAMediaTypeError({public:{input:r}}));if(o.groups===void 0)throw i(new r3.MediaTypeMatchRegexIsBrokenError({}));let a={type:n(o.groups.type),subtype:n(o.groups.subtype)};o.groups.tree&&(a.tree=n(o.groups.tree)),o.groups.suffix&&(a.suffix=n(o.groups.suffix));let s=t.exec(r);if(s!==null)for(a.parameters={};s!==null&&s.groups!==void 0;){let u=n(s.groups.parameterName);a.parameters[u]=s.groups.parameterValueA||s.groups.parameterValueB,s=t.exec(r)}return a}Wr.parseMediaTypeUnbound=ng});var Bu=m(kt=>{"use strict";var Lo=kt&&kt.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},og=kt&&kt.__classPrivateFieldSet||function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},ki,Bi;Object.defineProperty(kt,"__esModule",{value:!0});kt.MediaType=void 0;var qu=ye(),i3=eg(),n3=xu(),o3=Nu(),a3=Cu(),ku=class e extends i3.RefinedString{constructor(t,r=qu.THROW_THE_ERROR){super(t,n3.mustBeMediaType,r),ki.set(this,void 0),Bi.set(this,void 0)}static from(t,r=qu.THROW_THE_ERROR){return new e(t,r)}getContentType(){return Lo(this,ki)||og(this,ki,o3.parseContentType(this.valueOf())),Lo(this,ki)}parse(){return Lo(this,Bi)||og(this,Bi,a3.parseMediaType(this.value,qu.THROW_THE_ERROR)),Lo(this,Bi)}};kt.MediaType=ku;ki=new WeakMap,Bi=new WeakMap});var ag=m(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.mediaTypeFrom=void 0;var s3=Bu();Uo.mediaTypeFrom=s3.MediaType.from});var ug=m(sg=>{"use strict";Object.defineProperty(sg,"__esModule",{value:!0})});var So=m(ce=>{"use strict";var u3=ce&&ce.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),_t=ce&&ce.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&u3(t,e,r)};Object.defineProperty(ce,"__esModule",{value:!0});_t(Au(),ce);_t(wu(),ce);_t(xu(),ce);_t(Pm(),ce);_t(ag(),ce);_t(Bu(),ce);_t(ug(),ce);_t(Nu(),ce);_t(Cu(),ce)});var lg=m(rt=>{"use strict";var l3=rt&&rt.__createBinding||(Object.create?function(e,t,r,i){i===void 0&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}),Wo=rt&&rt.__exportStar||function(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&l3(t,e,r)};Object.defineProperty(rt,"__esModule",{value:!0});Wo(Ze(),rt);Wo(bu(),rt);Wo(So(),rt);Wo(Po(),rt)});function Fu(e,t,r){let i=t.andThen(a=>a.defacto_codecs.audio),n=t.andThen(a=>a.defacto_codecs.video),o=e.split(",");if(o.length>1){let a=Rr().find(g=>g.mimetype.test(o[0])),s=Rr().find(g=>g.mimetype.test(o[1])),u=Dr().find(g=>g.mimetype.test(o[0])),l=Dr().find(g=>g.mimetype.test(o[1])),p=i.unwrapOr("unknown"),c=n.unwrapOr("unknown");return{audio:u.or(l).map(g=>g.name).unwrapOr(p),video:a.or(s).map(g=>g.name).unwrapOr(c)}}else{let a=Rr().find(l=>l.mimetype.test(o[0])).map(l=>l.name),s=Dr().find(l=>l.mimetype.test(o[0])).map(l=>l.name);return s.isSome()?{video:!1,audio:s.unwrap()}:a.isSome()?{video:a.unwrap(),audio:!1}:r.map(l=>l==="audio").unwrapOr(!1)?{video:!1,audio:s.or(i).unwrapOr("unknown")}:{video:a.or(n).unwrapOr("unknown"),audio:!1}}}function Gr(e){let t;try{t=(0,cg.mediaTypeFrom)(e).parse()}catch(s){return K("parse error:"+s)}let r=M;t.type=="video"&&(r=C("video")),t.type=="audio"&&(r=C("audio"));let i=Rs().find(s=>s.mimetype.test(t.subtype));if(i.isNone())return K(`Unknown container (parsed from ${t.subtype})`);let n=t.parameters?.codecs??"",o=Fu(n,i,r),a=i.unwrap();return $({container:a.name,av_codecs:o})}var cg,Fi=I(()=>{"use strict";cg=wn(lg(),1);me();mt();ft();He()});function Vu(e,t){if(!rr(e,"mimeType"))return K("Missing mimeType");let r=Gr(e.mimeType);if(r.isErr())return r;let i=r.unwrap(),n=le(i.container),o="unknown";if(rr(e,"approxDurationMs")){let u=parseInt(e.approxDurationMs)/1e3;u&&(o=u)}let a=M;qr(e,"bitrate")&&(a=C(e.bitrate));let s=gt(i.av_codecs,u=>({codec:dt(u),bitrate:a}),u=>{let l=je(u),p=M,c=M,g=M;return qr(e,"fps")&&(p=C(e.fps)),qr(e,"width")&&qr(e,"height")&&(c=C({height:e.height,width:e.width})),rr(e,"qualityLabel")&&(g=sd(e.qualityLabel)),g.isNone()&&c.isSome()&&(g=C(Nr(c.unwrap().height))),{codec:l,bitrate:a,fps:p,dimensions:c,quality:g}});return $({builder:"YoutubeFormat",protocol:t,duration:o,container:n,av:s})}var pg=I(()=>{"use strict";me();Fi();ft();mt();jn();Ir();Cr()});var Xr={};Z(Xr,{defineInPage:()=>d3,getFilenameFromTitle:()=>m3,getSpecs:()=>f3,set:()=>p3});async function Go(){let e=await hr;await Hu.storage.local.set({smartname:e})}async function p3(e){hr=Promise.resolve(e),Go()}async function d3(){let e=await Hu.tabs.query({active:!0,currentWindow:!0});if(e.length===0)throw new Error("Can't find current tab");c3.executeScriptWithGlobal({tabId:e[0].id},{},"/injected/smartname.js")}async function f3(e){let t=await hr,r=new URL(e).hostname.split(".");for(let i=0;i<r.length-1;i++){let n=t[r.slice(i).join(".")];if(n)return n}return null}async function m3(e,t=null){e=e.trim(),t&&e.endsWith(`.${t}`)&&(t=null);let r={keep:" ",remove:"",hyphen:"-",underscore:"_"},i=await We.prefs;t&&(t=t.replace(dg,""),t=t.replace(fg,r[i.smartnamerFnameSpaces])),e=e.replace(dg,""),e=e.replace(fg,r[i.smartnamerFnameSpaces]);let n=i.smartnamerFnameMaxlen;return t?(e.length+t.length+1>n&&(e=e.substr(0,n-t.length-1)),e+"."+t):(e.length>n&&(e=e.substr(0,n)),e)}var We,c3,Hu,hr,dg,fg,$r=I(()=>{"use strict";We=J(),c3=(fe(),P(de)),Hu=We.browser,hr=Hu.storage.local.get({smartname:{}}).then(e=>e.smartname);dg=new RegExp('[/?<>\\:*|":]|[\0-\x80-\x9F]|\\\\',"g"),fg=new RegExp(" +","g");We.rpc.listen({openSmartNameDefiner:async()=>{let e=await We.ui.open("smartname-definer",{url:"content/smartname-define.html",type:"panel",width:600,height:400});return await We.wait("smartname-definer"),e},closeSmartNameDefiner:()=>We.ui.close("smartname-definer"),closedSmartNameDefiner:e=>We.rpc.call(e,"close"),setSmartNameData:e=>We.rpc.call("smartname-definer","setData",e),evaluateSmartName:(e,t)=>We.rpc.call(e,"evaluate",t),addSmartNameRule:async e=>{let t=await hr;t[e.domain]=e,Go()},selectSmartNameXPath:(e,t)=>We.rpc.call(e,"select",t),setSmartName:async e=>{hr=Promise.resolve({}),Go()},getSmartNameRules:async()=>hr,editSmartName:()=>{We.ui.open("smartname-edit",{type:"tab",url:"content/smartname-edit.html"})},removeFromSmartName:async e=>{let t=await hr;delete t[e],Go()}})});var Vi={};Z(Vi,{alert:()=>gg,dialog:()=>Lu,fileDialog:()=>Qr,saveAs:()=>b3,selectConvertFiles:()=>A3,selectDirectory:()=>hg,selectMergeAudioFile:()=>w3,selectMergeVideoFile:()=>_3});async function mg(){let e="2.0.17";if((await ie.prefs).use_native_filepicker){let{status:r,info:i}=await ju.check();if(r){let n=i.version;if(y3.isMinimumVersion(n,e))return!0}}return!1}function Lu(e){let t=Promise.resolve();e.type==="tab"&&(t=t.then(()=>g3.tabs.query({active:!0,lastFocusedWindow:!0}).then(i=>{i.length>0&&h3.setTransientTab("<next-tab>",i[0].id)})));let r="dialog"+ ++v3;return t=t.then(()=>{ie.ui.open(r,e)}).then(()=>ie.wait(r)),t.__dialogName=r,t}async function gg(e){let t={autoResize:!0},r=await ie.prefs;return r.alertDialogType=="tab"&&(t={bodyClass:"dialog-in-tab",autoResize:!1}),Lu({url:"content/alert.html",type:r.alertDialogType,height:e.height||200,autoClose:r.dialogAutoClose,initData:Object.assign(t,e)})}async function Qr(e){let t=await ie.prefs,r=Lu({type:t.fileDialogType,url:"content/file-dialog.html",height:500,width:750,autoClose:t.dialogAutoClose,initData:Object.assign({filename:null,directory:null,uniqueFilename:!0,titleText:"",noSizeColumn:!1,dirOnly:!1,upDir:!0,editFileInput:!0,readonlyDir:!1,showDir:!0,okText:"OK",confirmOverwrite:!1,newDir:!1,createDir:!0},e)});return r.then(i=>(ie.ui.close(r.__dialogName),i)).catch(i=>(ie.ui.close(r.__dialogName),null))}async function b3(e,t,r={}){let i=ie._("save_file_as");if(await mg()){let o=(await ju.call("filepicker","save_file",t,i,e)).split(`
`),a=o[0],s=o[1];return a&&t?{filePath:a,directory:s}:null}return Qr(Object.assign({filename:e,directory:t,uniqueFilename:!0,titleText:i,noSizeColumn:!1,dirOnly:!1,upDir:!0,editFileInput:!0,readonlyDir:!1,showDir:!0,okText:ie._("save"),confirmOverwrite:!0,newDir:!0,createDir:!0},r))}async function hg(e,t={}){let r=ie._("weh_prefs_label_lastDownloadDirectory");return await mg()?{directory:(await ju.call("filepicker","pick_folder","~",r)).split(`
`)[0]}:Qr(Object.assign({directory:e,uniqueFilename:!1,titleText:r,noSizeColumn:!0,dirOnly:!0,upDir:!0,editFileInput:!1,readonlyDir:!0,showDir:!1,okText:ie._("ok"),confirmOverwrite:!1,newDir:!0,createDir:!1},t))}function A3(e,t={}){return Qr(Object.assign({directory:e,uniqueFilename:!1,titleText:ie._("select_files_to_convert"),noSizeColumn:!1,dirOnly:!1,upDir:!0,readonlyDir:!0,editFileInput:!1,showDir:!1,okText:ie._("convert"),confirmOverwrite:!1,newDir:!1,createDir:!1,selectMultiple:!0,outputConfigs:!0},t))}function _3(e,t={}){return Qr(Object.assign({directory:e,uniqueFilename:!1,titleText:ie._("select_video_file_to_merge"),noSizeColumn:!1,dirOnly:!1,upDir:!0,readonlyDir:!0,editFileInput:!1,showDir:!1,okText:ie._("next"),confirmOverwrite:!1,newDir:!1,createDir:!1,selectMultiple:!1,outputConfigs:!1},t))}function w3(e,t={}){return Qr(Object.assign({directory:e,uniqueFilename:!1,titleText:ie._("select_audio_file_to_merge"),noSizeColumn:!1,dirOnly:!1,upDir:!0,readonlyDir:!0,editFileInput:!1,showDir:!1,okText:ie._("next"),confirmOverwrite:!1,newDir:!1,createDir:!1,selectMultiple:!1,outputConfigs:!1},t))}var ie,g3,h3,ju,y3,v3,Hi=I(()=>{"use strict";ie=J(),g3=ie.browser,h3=(Ft(),P(Bt)),ju=(Ht(),P(Vt)),y3=(fe(),P(de)),v3=0;ie.rpc.listen({alert:gg,selectDirectory:hg})});var Xo=m(wt=>{"use strict";var yg=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",x3=yg+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",vg="["+yg+"]["+x3+"]*",E3=new RegExp("^"+vg+"$"),T3=function(e,t){let r=[],i=t.exec(e);for(;i;){let n=[];n.startIndex=t.lastIndex-i[0].length;let o=i.length;for(let a=0;a<o;a++)n.push(i[a]);r.push(n),i=t.exec(e)}return r},S3=function(e){let t=E3.exec(e);return!(t===null||typeof t>"u")};wt.isExist=function(e){return typeof e<"u"};wt.isEmptyObject=function(e){return Object.keys(e).length===0};wt.merge=function(e,t,r){if(t){let i=Object.keys(t),n=i.length;for(let o=0;o<n;o++)r==="strict"?e[i[o]]=[t[i[o]]]:e[i[o]]=t[i[o]]}};wt.getValue=function(e){return wt.isExist(e)?e:""};wt.isName=S3;wt.getAllMatches=T3;wt.nameRegexp=vg});var Wu=m(xg=>{"use strict";var Uu=Xo(),O3={allowBooleanAttributes:!1,unpairedTags:[]};xg.validate=function(e,t){t=Object.assign({},O3,t);let r=[],i=!1,n=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let o=0;o<e.length;o++)if(e[o]==="<"&&e[o+1]==="?"){if(o+=2,o=Ag(e,o),o.err)return o}else if(e[o]==="<"){let a=o;if(o++,e[o]==="!"){o=_g(e,o);continue}else{let s=!1;e[o]==="/"&&(s=!0,o++);let u="";for(;o<e.length&&e[o]!==">"&&e[o]!==" "&&e[o]!=="	"&&e[o]!==`
`&&e[o]!=="\r";o++)u+=e[o];if(u=u.trim(),u[u.length-1]==="/"&&(u=u.substring(0,u.length-1),o--),!q3(u)){let c;return u.trim().length===0?c="Invalid space after '<'.":c="Tag '"+u+"' is an invalid name.",re("InvalidTag",c,ve(e,o))}let l=R3(e,o);if(l===!1)return re("InvalidAttr","Attributes for '"+u+"' have open quote.",ve(e,o));let p=l.value;if(o=l.index,p[p.length-1]==="/"){let c=o-p.length;p=p.substring(0,p.length-1);let g=wg(p,t);if(g===!0)i=!0;else return re(g.err.code,g.err.msg,ve(e,c+g.err.line))}else if(s)if(l.tagClosed){if(p.trim().length>0)return re("InvalidTag","Closing tag '"+u+"' can't have attributes or invalid starting.",ve(e,a));{let c=r.pop();if(u!==c.tagName){let g=ve(e,c.tagStartPos);return re("InvalidTag","Expected closing tag '"+c.tagName+"' (opened in line "+g.line+", col "+g.col+") instead of closing tag '"+u+"'.",ve(e,a))}r.length==0&&(n=!0)}}else return re("InvalidTag","Closing tag '"+u+"' doesn't have proper closing.",ve(e,o));else{let c=wg(p,t);if(c!==!0)return re(c.err.code,c.err.msg,ve(e,o-p.length+c.err.line));if(n===!0)return re("InvalidXml","Multiple possible root nodes found.",ve(e,o));t.unpairedTags.indexOf(u)!==-1||r.push({tagName:u,tagStartPos:a}),i=!0}for(o++;o<e.length;o++)if(e[o]==="<")if(e[o+1]==="!"){o++,o=_g(e,o);continue}else if(e[o+1]==="?"){if(o=Ag(e,++o),o.err)return o}else break;else if(e[o]==="&"){let c=N3(e,o);if(c==-1)return re("InvalidChar","char '&' is not expected.",ve(e,o));o=c}else if(n===!0&&!bg(e[o]))return re("InvalidXml","Extra text at the end",ve(e,o));e[o]==="<"&&o--}}else{if(bg(e[o]))continue;return re("InvalidChar","char '"+e[o]+"' is not expected.",ve(e,o))}if(i){if(r.length==1)return re("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",ve(e,r[0].tagStartPos));if(r.length>0)return re("InvalidXml","Invalid '"+JSON.stringify(r.map(o=>o.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return re("InvalidXml","Start tag expected.",1);return!0};function bg(e){return e===" "||e==="	"||e===`
`||e==="\r"}function Ag(e,t){let r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){let i=e.substr(r,t-r);if(t>5&&i==="xml")return re("InvalidXml","XML declaration allowed only at the start of the document.",ve(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function _g(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}var P3='"',M3="'";function R3(e,t){let r="",i="",n=!1;for(;t<e.length;t++){if(e[t]===P3||e[t]===M3)i===""?i=e[t]:i!==e[t]||(i="");else if(e[t]===">"&&i===""){n=!0;break}r+=e[t]}return i!==""?!1:{value:r,index:t,tagClosed:n}}var D3=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function wg(e,t){let r=Uu.getAllMatches(e,D3),i={};for(let n=0;n<r.length;n++){if(r[n][1].length===0)return re("InvalidAttr","Attribute '"+r[n][2]+"' has no space in starting.",ji(r[n]));if(r[n][3]!==void 0&&r[n][4]===void 0)return re("InvalidAttr","Attribute '"+r[n][2]+"' is without value.",ji(r[n]));if(r[n][3]===void 0&&!t.allowBooleanAttributes)return re("InvalidAttr","boolean attribute '"+r[n][2]+"' is not allowed.",ji(r[n]));let o=r[n][2];if(!C3(o))return re("InvalidAttr","Attribute '"+o+"' is an invalid name.",ji(r[n]));if(!i.hasOwnProperty(o))i[o]=1;else return re("InvalidAttr","Attribute '"+o+"' is repeated.",ji(r[n]))}return!0}function I3(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function N3(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,I3(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function re(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function C3(e){return Uu.isName(e)}function q3(e){return Uu.isName(e)}function ve(e,t){let r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function ji(e){return e.startIndex+e[1].length}});var Tg=m(Gu=>{var Eg={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},k3=function(e){return Object.assign({},Eg,e)};Gu.buildOptions=k3;Gu.defaultOptions=Eg});var Og=m((DN,Sg)=>{"use strict";var Xu=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}};Sg.exports=Xu});var Mg=m((IN,Pg)=>{var B3=Xo();function F3(e,t){let r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let i=1,n=!1,o=!1,a="";for(;t<e.length;t++)if(e[t]==="<"&&!o){if(n&&j3(e,t))t+=7,[entityName,val,t]=V3(e,t+1),val.indexOf("&")===-1&&(r[G3(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&L3(e,t))t+=8;else if(n&&U3(e,t))t+=8;else if(n&&W3(e,t))t+=9;else if(H3)o=!0;else throw new Error("Invalid DOCTYPE");i++,a=""}else if(e[t]===">"){if(o?e[t-1]==="-"&&e[t-2]==="-"&&(o=!1,i--):i--,i===0)break}else e[t]==="["?n=!0:a+=e[t];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function V3(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");let i=e[t++],n="";for(;t<e.length&&e[t]!==i;t++)n+=e[t];return[r,n,t]}function H3(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function j3(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function L3(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function U3(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function W3(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}function G3(e){if(B3.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}Pg.exports=F3});var Dg=m((NN,Rg)=>{var X3=/^[-+]?0x[a-fA-F0-9]+$/,$3=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var Q3={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function K3(e,t={}){if(t=Object.assign({},Q3,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&X3.test(r))return Number.parseInt(r,16);{let i=$3.exec(r);if(i){let n=i[1],o=i[2],a=z3(i[3]),s=i[4]||i[6];if(!t.leadingZeros&&o.length>0&&n&&r[2]!==".")return e;if(!t.leadingZeros&&o.length>0&&!n&&r[1]!==".")return e;{let u=Number(r),l=""+u;return l.search(/[eE]/)!==-1||s?t.eNotation?u:e:r.indexOf(".")!==-1?l==="0"&&a===""||l===a||n&&l==="-"+a?u:e:o?a===l||n+a===l?u:e:r===l||r===n+l?u:e}}else return e}}function z3(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}Rg.exports=K3});var Ng=m((qN,Ig)=>{"use strict";var zu=Xo(),Li=Og(),J3=Mg(),Y3=Dg(),CN="<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,zu.nameRegexp),$u=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"}},this.addExternalEntities=Z3,this.parseXml=nE,this.parseTextData=eE,this.resolveNameSpace=tE,this.buildAttributesMap=iE,this.isItStopNode=uE,this.replaceEntitiesValue=aE,this.readStopNodeData=cE,this.saveTextToParentTag=sE,this.addChild=oE}};function Z3(e){let t=Object.keys(e);for(let r=0;r<t.length;r++){let i=t[r];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:e[i]}}}function eE(e,t,r,i,n,o,a){if(e!==void 0&&(this.options.trimValues&&!i&&(e=e.trim()),e.length>0)){a||(e=this.replaceEntitiesValue(e));let s=this.options.tagValueProcessor(t,e,r,n,o);return s==null?e:typeof s!=typeof e||s!==e?s:this.options.trimValues?Ku(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?Ku(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function tE(e){if(this.options.removeNSPrefix){let t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}var rE=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function iE(e,t,r){if(!this.options.ignoreAttributes&&typeof e=="string"){let i=zu.getAllMatches(e,rE),n=i.length,o={};for(let a=0;a<n;a++){let s=this.resolveNameSpace(i[a][1]),u=i[a][4],l=this.options.attributeNamePrefix+s;if(s.length)if(this.options.transformAttributeName&&(l=this.options.transformAttributeName(l)),l==="__proto__"&&(l="#__proto__"),u!==void 0){this.options.trimValues&&(u=u.trim()),u=this.replaceEntitiesValue(u);let p=this.options.attributeValueProcessor(s,u,t);p==null?o[l]=u:typeof p!=typeof u||p!==u?o[l]=p:o[l]=Ku(u,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(o[l]=!0)}if(!Object.keys(o).length)return;if(this.options.attributesGroupName){let a={};return a[this.options.attributesGroupName]=o,a}return o}}var nE=function(e){e=e.replace(/\r\n?/g,`
`);let t=new Li("!xml"),r=t,i="",n="";for(let o=0;o<e.length;o++)if(e[o]==="<")if(e[o+1]==="/"){let s=yr(e,">",o,"Closing Tag is not closed."),u=e.substring(o+2,s).trim();if(this.options.removeNSPrefix){let c=u.indexOf(":");c!==-1&&(u=u.substr(c+1))}this.options.transformTagName&&(u=this.options.transformTagName(u)),r&&(i=this.saveTextToParentTag(i,r,n));let l=n.substring(n.lastIndexOf(".")+1);if(u&&this.options.unpairedTags.indexOf(u)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${u}>`);let p=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(p=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):p=n.lastIndexOf("."),n=n.substring(0,p),r=this.tagsNodeStack.pop(),i="",o=s}else if(e[o+1]==="?"){let s=Qu(e,o,!1,"?>");if(!s)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,r,n),!(this.options.ignoreDeclaration&&s.tagName==="?xml"||this.options.ignorePiTags)){let u=new Li(s.tagName);u.add(this.options.textNodeName,""),s.tagName!==s.tagExp&&s.attrExpPresent&&(u[":@"]=this.buildAttributesMap(s.tagExp,n,s.tagName)),this.addChild(r,u,n)}o=s.closeIndex+1}else if(e.substr(o+1,3)==="!--"){let s=yr(e,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){let u=e.substring(o+4,s-2);i=this.saveTextToParentTag(i,r,n),r.add(this.options.commentPropName,[{[this.options.textNodeName]:u}])}o=s}else if(e.substr(o+1,2)==="!D"){let s=J3(e,o);this.docTypeEntities=s.entities,o=s.i}else if(e.substr(o+1,2)==="!["){let s=yr(e,"]]>",o,"CDATA is not closed.")-2,u=e.substring(o+9,s);if(i=this.saveTextToParentTag(i,r,n),this.options.cdataPropName)r.add(this.options.cdataPropName,[{[this.options.textNodeName]:u}]);else{let l=this.parseTextData(u,r.tagname,n,!0,!1,!0);l==null&&(l=""),r.add(this.options.textNodeName,l)}o=s+2}else{let s=Qu(e,o,this.options.removeNSPrefix),u=s.tagName,l=s.rawTagName,p=s.tagExp,c=s.attrExpPresent,g=s.closeIndex;this.options.transformTagName&&(u=this.options.transformTagName(u)),r&&i&&r.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,r,n,!1));let b=r;if(b&&this.options.unpairedTags.indexOf(b.tagname)!==-1&&(r=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),u!==t.tagname&&(n+=n?"."+u:u),this.isItStopNode(this.options.stopNodes,n,u)){let d="";if(p.length>0&&p.lastIndexOf("/")===p.length-1)o=s.closeIndex;else if(this.options.unpairedTags.indexOf(u)!==-1)o=s.closeIndex;else{let f=this.readStopNodeData(e,l,g+1);if(!f)throw new Error(`Unexpected end of ${l}`);o=f.i,d=f.tagContent}let A=new Li(u);u!==p&&c&&(A[":@"]=this.buildAttributesMap(p,n,u)),d&&(d=this.parseTextData(d,u,n,!0,c,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),A.add(this.options.textNodeName,d),this.addChild(r,A,n)}else{if(p.length>0&&p.lastIndexOf("/")===p.length-1){u[u.length-1]==="/"?(u=u.substr(0,u.length-1),n=n.substr(0,n.length-1),p=u):p=p.substr(0,p.length-1),this.options.transformTagName&&(u=this.options.transformTagName(u));let d=new Li(u);u!==p&&c&&(d[":@"]=this.buildAttributesMap(p,n,u)),this.addChild(r,d,n),n=n.substr(0,n.lastIndexOf("."))}else{let d=new Li(u);this.tagsNodeStack.push(r),u!==p&&c&&(d[":@"]=this.buildAttributesMap(p,n,u)),this.addChild(r,d,n),r=d}i="",o=g}}else i+=e[o];return t.child};function oE(e,t,r){let i=this.options.updateTag(t.tagname,r,t[":@"]);i===!1||(typeof i=="string"&&(t.tagname=i),e.addChild(t))}var aE=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){let r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){let r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){let r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function sE(e,t,r,i){return e&&(i===void 0&&(i=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,i),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function uE(e,t,r){let i="*."+r;for(let n in e){let o=e[n];if(i===o||t===o)return!0}return!1}function lE(e,t,r=">"){let i,n="";for(let o=t;o<e.length;o++){let a=e[o];if(i)a===i&&(i="");else if(a==='"'||a==="'")i=a;else if(a===r[0])if(r[1]){if(e[o+1]===r[1])return{data:n,index:o}}else return{data:n,index:o};else a==="	"&&(a=" ");n+=a}}function yr(e,t,r,i){let n=e.indexOf(t,r);if(n===-1)throw new Error(i);return n+t.length-1}function Qu(e,t,r,i=">"){let n=lE(e,t+1,i);if(!n)return;let o=n.data,a=n.index,s=o.search(/\s/),u=o,l=!0;s!==-1&&(u=o.substr(0,s).replace(/\s\s*$/,""),o=o.substr(s+1));let p=u;if(r){let c=u.indexOf(":");c!==-1&&(u=u.substr(c+1),l=u!==n.data.substr(c+1))}return{tagName:u,tagExp:o,closeIndex:a,attrExpPresent:l,rawTagName:p}}function cE(e,t,r){let i=r,n=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){let o=yr(e,">",r,`${t} is not closed`);if(e.substring(r+2,o).trim()===t&&(n--,n===0))return{tagContent:e.substring(i,r),i:o};r=o}else if(e[r+1]==="?")r=yr(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=yr(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=yr(e,"]]>",r,"StopNode is not closed.")-2;else{let o=Qu(e,r,">");o&&((o&&o.tagName)===t&&o.tagExp[o.tagExp.length-1]!=="/"&&n++,r=o.closeIndex)}}function Ku(e,t,r){if(t&&typeof e=="string"){let i=e.trim();return i==="true"?!0:i==="false"?!1:Y3(e,r)}else return zu.isExist(e)?e:""}Ig.exports=$u});var kg=m(qg=>{"use strict";function pE(e,t){return Cg(e,t)}function Cg(e,t,r){let i,n={};for(let o=0;o<e.length;o++){let a=e[o],s=dE(a),u="";if(r===void 0?u=s:u=r+"."+s,s===t.textNodeName)i===void 0?i=a[s]:i+=""+a[s];else{if(s===void 0)continue;if(a[s]){let l=Cg(a[s],t,u),p=mE(l,t);a[":@"]?fE(l,a[":@"],u,t):Object.keys(l).length===1&&l[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?l=l[t.textNodeName]:Object.keys(l).length===0&&(t.alwaysCreateTextNode?l[t.textNodeName]="":l=""),n[s]!==void 0&&n.hasOwnProperty(s)?(Array.isArray(n[s])||(n[s]=[n[s]]),n[s].push(l)):t.isArray(s,u,p)?n[s]=[l]:n[s]=l}}}return typeof i=="string"?i.length>0&&(n[t.textNodeName]=i):i!==void 0&&(n[t.textNodeName]=i),n}function dE(e){let t=Object.keys(e);for(let r=0;r<t.length;r++){let i=t[r];if(i!==":@")return i}}function fE(e,t,r,i){if(t){let n=Object.keys(t),o=n.length;for(let a=0;a<o;a++){let s=n[a];i.isArray(s,r+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function mE(e,t){let{textNodeName:r}=t,i=Object.keys(e).length;return!!(i===0||i===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}qg.prettify=pE});var Fg=m((BN,Bg)=>{var{buildOptions:gE}=Tg(),hE=Ng(),{prettify:yE}=kg(),vE=Wu(),Ju=class{constructor(t){this.externalEntities={},this.options=gE(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});let o=vE.validate(t,r);if(o!==!0)throw Error(`${o.err.msg}:${o.err.line}:${o.err.col}`)}let i=new hE(this.options);i.addExternalEntities(this.externalEntities);let n=i.parseXml(t);return this.options.preserveOrder||n===void 0?n:yE(n,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};Bg.exports=Ju});var Ug=m((FN,Lg)=>{var bE=`
`;function AE(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=bE),Hg(e,t,"",r)}function Hg(e,t,r,i){let n="",o=!1;for(let a=0;a<e.length;a++){let s=e[a],u=_E(s);if(u===void 0)continue;let l="";if(r.length===0?l=u:l=`${r}.${u}`,u===t.textNodeName){let d=s[u];wE(l,t)||(d=t.tagValueProcessor(u,d),d=jg(d,t)),o&&(n+=i),n+=d,o=!1;continue}else if(u===t.cdataPropName){o&&(n+=i),n+=`<![CDATA[${s[u][0][t.textNodeName]}]]>`,o=!1;continue}else if(u===t.commentPropName){n+=i+`<!--${s[u][0][t.textNodeName]}-->`,o=!0;continue}else if(u[0]==="?"){let d=Vg(s[":@"],t),A=u==="?xml"?"":i,f=s[u][0][t.textNodeName];f=f.length!==0?" "+f:"",n+=A+`<${u}${f}${d}?>`,o=!0;continue}let p=i;p!==""&&(p+=t.indentBy);let c=Vg(s[":@"],t),g=i+`<${u}${c}`,b=Hg(s[u],t,l,p);t.unpairedTags.indexOf(u)!==-1?t.suppressUnpairedNode?n+=g+">":n+=g+"/>":(!b||b.length===0)&&t.suppressEmptyNode?n+=g+"/>":b&&b.endsWith(">")?n+=g+`>${b}${i}</${u}>`:(n+=g+">",b&&i!==""&&(b.includes("/>")||b.includes("</"))?n+=i+t.indentBy+b+i:n+=b,n+=`</${u}>`),o=!0}return n}function _E(e){let t=Object.keys(e);for(let r=0;r<t.length;r++){let i=t[r];if(e.hasOwnProperty(i)&&i!==":@")return i}}function Vg(e,t){let r="";if(e&&!t.ignoreAttributes)for(let i in e){if(!e.hasOwnProperty(i))continue;let n=t.attributeValueProcessor(i,e[i]);n=jg(n,t),n===!0&&t.suppressBooleanAttributes?r+=` ${i.substr(t.attributeNamePrefix.length)}`:r+=` ${i.substr(t.attributeNamePrefix.length)}="${n}"`}return r}function wE(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===e||t.stopNodes[i]==="*."+r)return!0;return!1}function jg(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){let i=t.entities[r];e=e.replace(i.regex,i.val)}return e}Lg.exports=AE});var Gg=m((VN,Wg)=>{"use strict";var xE=Ug(),EE={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function jt(e){this.options=Object.assign({},EE,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=OE),this.processTextOrObjNode=TE,this.options.format?(this.indentate=SE,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}jt.prototype.build=function(e){return this.options.preserveOrder?xE(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)};jt.prototype.j2x=function(e,t){let r="",i="";for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n))if(typeof e[n]>"u")this.isAttribute(n)&&(i+="");else if(e[n]===null)this.isAttribute(n)?i+="":n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(e[n]instanceof Date)i+=this.buildTextValNode(e[n],n,"",t);else if(typeof e[n]!="object"){let o=this.isAttribute(n);if(o)r+=this.buildAttrPairStr(o,""+e[n]);else if(n===this.options.textNodeName){let a=this.options.tagValueProcessor(n,""+e[n]);i+=this.replaceEntitiesValue(a)}else i+=this.buildTextValNode(e[n],n,"",t)}else if(Array.isArray(e[n])){let o=e[n].length,a="";for(let s=0;s<o;s++){let u=e[n][s];typeof u>"u"||(u===null?n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar:typeof u=="object"?this.options.oneListGroup?a+=this.j2x(u,t+1).val:a+=this.processTextOrObjNode(u,n,t):a+=this.buildTextValNode(u,n,"",t))}this.options.oneListGroup&&(a=this.buildObjectNode(a,n,"",t)),i+=a}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){let o=Object.keys(e[n]),a=o.length;for(let s=0;s<a;s++)r+=this.buildAttrPairStr(o[s],""+e[n][o[s]])}else i+=this.processTextOrObjNode(e[n],n,t);return{attrStr:r,val:i}};jt.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function TE(e,t,r){let i=this.j2x(e,r+1);return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,i.attrStr,r):this.buildObjectNode(i.val,t,i.attrStr,r)}jt.prototype.buildObjectNode=function(e,t,r,i){if(e==="")return t[0]==="?"?this.indentate(i)+"<"+t+r+"?"+this.tagEndChar:this.indentate(i)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,o="";return t[0]==="?"&&(o="?",n=""),(r||r==="")&&e.indexOf("<")===-1?this.indentate(i)+"<"+t+r+o+">"+e+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&o.length===0?this.indentate(i)+`<!--${e}-->`+this.newLine:this.indentate(i)+"<"+t+r+o+this.tagEndChar+e+this.indentate(i)+n}};jt.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t};jt.prototype.buildTextValNode=function(e,t,r,i){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(i)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(i)+"<"+t+r+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,e);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+r+">"+n+"</"+t+this.tagEndChar}};jt.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){let r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function SE(e){return this.options.indentBy.repeat(e)}function OE(e){return e.startsWith(this.options.attributeNamePrefix)&&e!==this.options.textNodeName?e.substr(this.attrPrefixLen):!1}Wg.exports=jt});var $g=m((HN,Xg)=>{"use strict";var PE=Wu(),ME=Fg(),RE=Gg();Xg.exports={XMLParser:ME,XMLValidator:PE,XMLBuilder:RE}});function Kg(e){let r=new Qg.XMLParser({attributesGroupName:"@_",ignoreDeclaration:!0,parseAttributeValue:!0,ignoreAttributes:!1,removeNSPrefix:!0,trimValues:!0,isArray:s=>s==="adaptationset"||s==="representation",transformTagName:s=>s.toLowerCase(),transformAttributeName:s=>s.toLowerCase()}).parse(e),i=r.mpd?.period?.adaptationset;if(!Array.isArray(i))return K("Invalid MPD XML");let n="unknown";{let s=r.mpd?.["@_"]?.["@_mediapresentationduration"];if(typeof s=="string"){let u=/\d+(\.\d+)?S/,l=/\d+M/,p=u.exec(s),c=l.exec(s);(p||c)&&(n=0,p&&p.length>0&&(n=parseFloat(p[0])),c&&c.length>0&&(n+=60*(parseFloat(c[0])??0)))}}let o=0,a=[];for(let s of i){let u=[s];"contentcomponent"in s&&"@_"in s.contentcomponent&&u.push(s.contentcomponent),"segmenttemplate"in s&&"@_"in s.segmenttemplate&&u.push(s.segmenttemplate);let l={bitrate:M,content_type:void 0,mime_type:void 0,codecs:void 0,width:void 0,height:void 0,framerate:M},p=(g,b)=>{let d={...b};for(let A of g){let f=A["@_"]??[];for(let h of Object.keys(f)){if(h==="@_bandwidth"){let y=f["@_bandwidth"];typeof y=="number"&&(d.bitrate=C(y))}if(h==="@_contenttype"){let y=f["@_contenttype"];typeof y=="string"&&(d.content_type=y)}if(h==="@_mimetype"){let y=f["@_mimetype"];typeof y=="string"&&(d.mime_type=y)}if(h==="@_codecs"){let y=f["@_codecs"];typeof y=="string"&&(d.codecs=y)}if(h==="@_width"){let y=f["@_width"];typeof y=="number"&&(d.width=y)}if(h==="@_height"){let y=f["@_height"];typeof y=="number"&&(d.height=y)}if(h==="@_framerate"){let y=f["@_framerate"];typeof y=="number"&&(d.framerate=C(y))}}}return d};l=p(u,l);let c=s.representation;if(!Array.isArray(c))break;for(let g of c){let b=o.toString();o++;let d=p([g],l),{codecs:A,mime_type:f,bitrate:h,width:y,height:T,framerate:w}=d,S=K("Invalid mimetype/codecs");if(typeof f=="string"&&typeof A=="string"){let B=`${f}; codecs="${A}"`;S=Gr(B)}if(S.isErr()){console.warn("Failed to parse mimetype from",f,A);continue}let{av_codecs:x,container:O}=S.unwrap(),D=gt(x,B=>({codec:dt(B),bitrate:h}),B=>{let q=je(B),W=w,V=M,ee=M;return typeof y=="number"&&typeof T=="number"&&(ee=C(Nr(T)),V=C({width:y,height:T})),{codec:q,bitrate:h,fps:W,dimensions:V,quality:ee}}),N={builder:"MPDParser",protocol:"dash",duration:n,container:le(O),av:D};a.push([N,b])}}return $(a)}var Qg,zg=I(()=>{"use strict";me();Fi();ft();mt();Ir();jn();Qg=wn($g(),1);Cr();He()});var $o,Jg=I(()=>{$o=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(i,n){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(n)},t.off=function(i,n){if(!this.listeners[i])return!1;var o=this.listeners[i].indexOf(n);return this.listeners[i]=this.listeners[i].slice(0),this.listeners[i].splice(o,1),o>-1},t.trigger=function(i){var n=this.listeners[i];if(n)if(arguments.length===2)for(var o=n.length,a=0;a<o;++a)n[a].call(this,arguments[1]);else for(var s=Array.prototype.slice.call(arguments,1),u=n.length,l=0;l<u;++l)n[l].apply(this,s)},t.dispose=function(){this.listeners={}},t.pipe=function(i){this.on("data",function(n){i.push(n)})},e}()});function Lt(){return Lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Lt.apply(this,arguments)}var Yg=I(()=>{});var eh=m((r5,Zg)=>{var Ui;typeof window<"u"?Ui=window:typeof global<"u"?Ui=global:typeof self<"u"?Ui=self:Ui={};Zg.exports=Ui});function Zu(e){for(var t=DE(e),r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}var Yu,DE,th=I(()=>{Yu=wn(eh()),DE=function(t){return Yu.default.atob?Yu.default.atob(t):Buffer.from(t,"base64").toString("binary")}});var rl,IE,el,NE,xe,il,CE,Ut,tl,Kr,rh=I(()=>{Jg();Yg();th();rl=class extends $o{constructor(){super(),this.buffer=""}push(t){let r;for(this.buffer+=t,r=this.buffer.indexOf(`
`);r>-1;r=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,r)),this.buffer=this.buffer.substring(r+1)}},IE="	",el=function(e){let t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),r={};return t[1]&&(r.length=parseInt(t[1],10)),t[2]&&(r.offset=parseInt(t[2],10)),r},NE=function(){let r="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+r+")")},xe=function(e){let t={};if(!e)return t;let r=e.split(NE()),i=r.length,n;for(;i--;)r[i]!==""&&(n=/([^=]*)=(.*)/.exec(r[i]).slice(1),n[0]=n[0].replace(/^\s+|\s+$/g,""),n[1]=n[1].replace(/^\s+|\s+$/g,""),n[1]=n[1].replace(/^['"](.*)['"]$/g,"$1"),t[n[0]]=n[1]);return t},il=class extends $o{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(t){let r,i;if(t=t.trim(),t.length===0)return;if(t[0]!=="#"){this.trigger("data",{type:"uri",uri:t});return}this.tagMappers.reduce((o,a)=>{let s=a(t);return s===t?o:o.concat([s])},[t]).forEach(o=>{for(let a=0;a<this.customParsers.length;a++)if(this.customParsers[a].call(this,o))return;if(o.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:o.slice(1)});return}if(o=o.replace("\r",""),r=/^#EXTM3U/.exec(o),r){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(r=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(o),r){i={type:"tag",tagType:"inf"},r[1]&&(i.duration=parseFloat(r[1])),r[2]&&(i.title=r[2]),this.trigger("data",i);return}if(r=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(o),r){i={type:"tag",tagType:"targetduration"},r[1]&&(i.duration=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-VERSION:([0-9.]*)?/.exec(o),r){i={type:"tag",tagType:"version"},r[1]&&(i.version=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(o),r){i={type:"tag",tagType:"media-sequence"},r[1]&&(i.number=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(o),r){i={type:"tag",tagType:"discontinuity-sequence"},r[1]&&(i.number=parseInt(r[1],10)),this.trigger("data",i);return}if(r=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(o),r){i={type:"tag",tagType:"playlist-type"},r[1]&&(i.playlistType=r[1]),this.trigger("data",i);return}if(r=/^#EXT-X-BYTERANGE:(.*)?$/.exec(o),r){i=Lt(el(r[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",i);return}if(r=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(o),r){i={type:"tag",tagType:"allow-cache"},r[1]&&(i.allowed=!/NO/.test(r[1])),this.trigger("data",i);return}if(r=/^#EXT-X-MAP:(.*)$/.exec(o),r){if(i={type:"tag",tagType:"map"},r[1]){let a=xe(r[1]);a.URI&&(i.uri=a.URI),a.BYTERANGE&&(i.byterange=el(a.BYTERANGE))}this.trigger("data",i);return}if(r=/^#EXT-X-STREAM-INF:(.*)$/.exec(o),r){if(i={type:"tag",tagType:"stream-inf"},r[1]){if(i.attributes=xe(r[1]),i.attributes.RESOLUTION){let a=i.attributes.RESOLUTION.split("x"),s={};a[0]&&(s.width=parseInt(a[0],10)),a[1]&&(s.height=parseInt(a[1],10)),i.attributes.RESOLUTION=s}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}this.trigger("data",i);return}if(r=/^#EXT-X-MEDIA:(.*)$/.exec(o),r){i={type:"tag",tagType:"media"},r[1]&&(i.attributes=xe(r[1])),this.trigger("data",i);return}if(r=/^#EXT-X-ENDLIST/.exec(o),r){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(r=/^#EXT-X-DISCONTINUITY/.exec(o),r){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(r=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(o),r){i={type:"tag",tagType:"program-date-time"},r[1]&&(i.dateTimeString=r[1],i.dateTimeObject=new Date(r[1])),this.trigger("data",i);return}if(r=/^#EXT-X-KEY:(.*)$/.exec(o),r){i={type:"tag",tagType:"key"},r[1]&&(i.attributes=xe(r[1]),i.attributes.IV&&(i.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),this.trigger("data",i);return}if(r=/^#EXT-X-START:(.*)$/.exec(o),r){i={type:"tag",tagType:"start"},r[1]&&(i.attributes=xe(r[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),this.trigger("data",i);return}if(r=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(o),r){i={type:"tag",tagType:"cue-out-cont"},r[1]?i.data=r[1]:i.data="",this.trigger("data",i);return}if(r=/^#EXT-X-CUE-OUT:(.*)?$/.exec(o),r){i={type:"tag",tagType:"cue-out"},r[1]?i.data=r[1]:i.data="",this.trigger("data",i);return}if(r=/^#EXT-X-CUE-IN:(.*)?$/.exec(o),r){i={type:"tag",tagType:"cue-in"},r[1]?i.data=r[1]:i.data="",this.trigger("data",i);return}if(r=/^#EXT-X-SKIP:(.*)$/.exec(o),r&&r[1]){i={type:"tag",tagType:"skip"},i.attributes=xe(r[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split(IE)),this.trigger("data",i);return}if(r=/^#EXT-X-PART:(.*)$/.exec(o),r&&r[1]){i={type:"tag",tagType:"part"},i.attributes=xe(r[1]),["DURATION"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseFloat(i.attributes[a]))}),["INDEPENDENT","GAP"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=/YES/.test(i.attributes[a]))}),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=el(i.attributes.BYTERANGE)),this.trigger("data",i);return}if(r=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(o),r&&r[1]){i={type:"tag",tagType:"server-control"},i.attributes=xe(r[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseFloat(i.attributes[a]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=/YES/.test(i.attributes[a]))}),this.trigger("data",i);return}if(r=/^#EXT-X-PART-INF:(.*)$/.exec(o),r&&r[1]){i={type:"tag",tagType:"part-inf"},i.attributes=xe(r[1]),["PART-TARGET"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseFloat(i.attributes[a]))}),this.trigger("data",i);return}if(r=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(o),r&&r[1]){i={type:"tag",tagType:"preload-hint"},i.attributes=xe(r[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(a){if(i.attributes.hasOwnProperty(a)){i.attributes[a]=parseInt(i.attributes[a],10);let s=a==="BYTERANGE-LENGTH"?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[s]=i.attributes[a],delete i.attributes[a]}}),this.trigger("data",i);return}if(r=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(o),r&&r[1]){i={type:"tag",tagType:"rendition-report"},i.attributes=xe(r[1]),["LAST-MSN","LAST-PART"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseInt(i.attributes[a],10))}),this.trigger("data",i);return}if(r=/^#EXT-X-DATERANGE:(.*)$/.exec(o),r&&r[1]){i={type:"tag",tagType:"daterange"},i.attributes=xe(r[1]),["ID","CLASS"].forEach(function(s){i.attributes.hasOwnProperty(s)&&(i.attributes[s]=String(i.attributes[s]))}),["START-DATE","END-DATE"].forEach(function(s){i.attributes.hasOwnProperty(s)&&(i.attributes[s]=new Date(i.attributes[s]))}),["DURATION","PLANNED-DURATION"].forEach(function(s){i.attributes.hasOwnProperty(s)&&(i.attributes[s]=parseFloat(i.attributes[s]))}),["END-ON-NEXT"].forEach(function(s){i.attributes.hasOwnProperty(s)&&(i.attributes[s]=/YES/i.test(i.attributes[s]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(s){i.attributes.hasOwnProperty(s)&&(i.attributes[s]=i.attributes[s].toString(16))});let a=/^X-([A-Z]+-)+[A-Z]+$/;for(let s in i.attributes){if(!a.test(s))continue;let u=/[0-9A-Fa-f]{6}/g.test(i.attributes[s]),l=/^\d+(\.\d+)?$/.test(i.attributes[s]);i.attributes[s]=u?i.attributes[s].toString(16):l?parseFloat(i.attributes[s]):String(i.attributes[s])}this.trigger("data",i);return}if(r=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(o),r){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(r=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(o),r){i={type:"tag",tagType:"content-steering"},i.attributes=xe(r[1]),this.trigger("data",i);return}this.trigger("data",{type:"tag",data:o.slice(4)})})}addParser({expression:t,customType:r,dataParser:i,segment:n}){typeof i!="function"&&(i=o=>o),this.customParsers.push(o=>{if(t.exec(o))return this.trigger("data",{type:"custom",data:i(o),customType:r,segment:n}),!0})}addTagMapper({expression:t,map:r}){let i=n=>t.test(n)?r(n):n;this.tagMappers.push(i)}},CE=e=>e.toLowerCase().replace(/-(\w)/g,t=>t[1].toUpperCase()),Ut=function(e){let t={};return Object.keys(e).forEach(function(r){t[CE(r)]=e[r]}),t},tl=function(e){let{serverControl:t,targetDuration:r,partTargetDuration:i}=e;if(!t)return;let n="#EXT-X-SERVER-CONTROL",o="holdBack",a="partHoldBack",s=r&&r*3,u=i&&i*2;r&&!t.hasOwnProperty(o)&&(t[o]=s,this.trigger("info",{message:`${n} defaulting HOLD-BACK to targetDuration * 3 (${s}).`})),s&&t[o]<s&&(this.trigger("warn",{message:`${n} clamping HOLD-BACK (${t[o]}) to targetDuration * 3 (${s})`}),t[o]=s),i&&!t.hasOwnProperty(a)&&(t[a]=i*3,this.trigger("info",{message:`${n} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[a]}).`})),i&&t[a]<u&&(this.trigger("warn",{message:`${n} clamping PART-HOLD-BACK (${t[a]}) to partTargetDuration * 2 (${u}).`}),t[a]=u)},Kr=class extends $o{constructor(){super(),this.lineStream=new rl,this.parseStream=new il,this.lineStream.pipe(this.parseStream),this.lastProgramDateTime=null;let t=this,r=[],i={},n,o,a=!1,s=function(){},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},l="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",p=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],segments:[]};let c=0,g=0,b={};this.on("end",()=>{i.uri||!i.parts&&!i.preloadHints||(!i.map&&n&&(i.map=n),!i.key&&o&&(i.key=o),!i.timeline&&typeof p=="number"&&(i.timeline=p),this.manifest.preloadSegment=i)}),this.parseStream.on("data",function(d){let A,f;({tag(){({version(){d.version&&(this.manifest.version=d.version)},"allow-cache"(){this.manifest.allowCache=d.allowed,"allowed"in d||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){let h={};"length"in d&&(i.byterange=h,h.length=d.length,"offset"in d||(d.offset=c)),"offset"in d&&(i.byterange=h,h.offset=d.offset),c=h.offset+h.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),d.title&&(i.title=d.title),d.duration>0&&(i.duration=d.duration),d.duration===0&&(i.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=r},key(){if(!d.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(d.attributes.METHOD==="NONE"){o=null;return}if(!d.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(d.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:d.attributes};return}if(d.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:d.attributes.URI};return}if(d.attributes.KEYFORMAT===l){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(d.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(d.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),d.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(d.attributes.KEYID&&d.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:d.attributes.KEYFORMAT,keyId:d.attributes.KEYID.substring(2)},pssh:Zu(d.attributes.URI.split(",")[1])};return}d.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),o={method:d.attributes.METHOD||"AES-128",uri:d.attributes.URI},typeof d.attributes.IV<"u"&&(o.iv=d.attributes.IV)},"media-sequence"(){if(!isFinite(d.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+d.number});return}this.manifest.mediaSequence=d.number},"discontinuity-sequence"(){if(!isFinite(d.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+d.number});return}this.manifest.discontinuitySequence=d.number,p=d.number},"playlist-type"(){if(!/VOD|EVENT/.test(d.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+d.playlist});return}this.manifest.playlistType=d.playlistType},map(){n={},d.uri&&(n.uri=d.uri),d.byterange&&(n.byterange=d.byterange),o&&(n.key=o)},"stream-inf"(){if(this.manifest.playlists=r,this.manifest.mediaGroups=this.manifest.mediaGroups||u,!d.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}i.attributes||(i.attributes={}),Lt(i.attributes,d.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,!(d.attributes&&d.attributes.TYPE&&d.attributes["GROUP-ID"]&&d.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}let h=this.manifest.mediaGroups[d.attributes.TYPE];h[d.attributes["GROUP-ID"]]=h[d.attributes["GROUP-ID"]]||{},A=h[d.attributes["GROUP-ID"]],f={default:/yes/i.test(d.attributes.DEFAULT)},f.default?f.autoselect=!0:f.autoselect=/yes/i.test(d.attributes.AUTOSELECT),d.attributes.LANGUAGE&&(f.language=d.attributes.LANGUAGE),d.attributes.URI&&(f.uri=d.attributes.URI),d.attributes["INSTREAM-ID"]&&(f.instreamId=d.attributes["INSTREAM-ID"]),d.attributes.CHARACTERISTICS&&(f.characteristics=d.attributes.CHARACTERISTICS),d.attributes.FORCED&&(f.forced=/yes/i.test(d.attributes.FORCED)),A[d.attributes.NAME]=f},discontinuity(){p+=1,i.discontinuity=!0,this.manifest.discontinuityStarts.push(r.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=d.dateTimeString,this.manifest.dateTimeObject=d.dateTimeObject),i.dateTimeString=d.dateTimeString,i.dateTimeObject=d.dateTimeObject;let{lastProgramDateTime:h}=this;this.lastProgramDateTime=new Date(d.dateTimeString).getTime(),h===null&&this.manifest.segments.reduceRight((y,T)=>(T.programDateTime=y-T.duration*1e3,T.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(d.duration)||d.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+d.duration});return}this.manifest.targetDuration=d.duration,tl.call(this,this.manifest)},start(){if(!d.attributes||isNaN(d.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:d.attributes["TIME-OFFSET"],precise:d.attributes.PRECISE}},"cue-out"(){i.cueOut=d.data},"cue-out-cont"(){i.cueOutCont=d.data},"cue-in"(){i.cueIn=d.data},skip(){this.manifest.skip=Ut(d.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",d.attributes,["SKIPPED-SEGMENTS"])},part(){a=!0;let h=this.manifest.segments.length,y=Ut(d.attributes);i.parts=i.parts||[],i.parts.push(y),y.byterange&&(y.byterange.hasOwnProperty("offset")||(y.byterange.offset=g),g=y.byterange.offset+y.byterange.length);let T=i.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${T} for segment #${h}`,d.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((w,S)=>{w.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${S} lacks required attribute(s): LAST-PART`})})},"server-control"(){let h=this.manifest.serverControl=Ut(d.attributes);h.hasOwnProperty("canBlockReload")||(h.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),tl.call(this,this.manifest),h.canSkipDateranges&&!h.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){let h=this.manifest.segments.length,y=Ut(d.attributes),T=y.type&&y.type==="PART";i.preloadHints=i.preloadHints||[],i.preloadHints.push(y),y.byterange&&(y.byterange.hasOwnProperty("offset")||(y.byterange.offset=T?g:0,T&&(g=y.byterange.offset+y.byterange.length)));let w=i.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${w} for segment #${h}`,d.attributes,["TYPE","URI"]),!!y.type)for(let S=0;S<i.preloadHints.length-1;S++){let x=i.preloadHints[S];x.type&&x.type===y.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${w} for segment #${h} has the same TYPE ${y.type} as preload hint #${S}`})}},"rendition-report"(){let h=Ut(d.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(h);let y=this.manifest.renditionReports.length-1,T=["LAST-MSN","URI"];a&&T.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${y}`,d.attributes,T)},"part-inf"(){this.manifest.partInf=Ut(d.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",d.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),tl.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(Ut(d.attributes));let h=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${h}`,d.attributes,["ID","START-DATE"]);let y=this.manifest.dateRanges[h];y.endDate&&y.startDate&&new Date(y.endDate)<new Date(y.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),y.duration&&y.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),y.plannedDuration&&y.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});let T=!!y.endOnNext;if(T&&!y.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),T&&(y.duration||y.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),y.duration&&y.endDate){let S=y.startDate.getTime()+y.duration*1e3;this.manifest.dateRanges[h].endDate=new Date(S)}if(!b[y.id])b[y.id]=y;else{for(let S in b[y.id])if(y[S]&&JSON.stringify(b[y.id][S])!==JSON.stringify(y[S])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}let w=this.manifest.dateRanges.findIndex(S=>S.id===y.id);this.manifest.dateRanges[w]=Lt(this.manifest.dateRanges[w],y),b[y.id]=Lt(b[y.id],y),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"content-steering"(){this.manifest.contentSteering=Ut(d.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",d.attributes,["SERVER-URI"])}}[d.tagType]||s).call(t)},uri(){i.uri=d.uri,r.push(i),this.manifest.targetDuration&&!("duration"in i)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),i.duration=this.manifest.targetDuration),o&&(i.key=o),i.timeline=p,n&&(i.map=n),g=0,this.lastProgramDateTime!==null&&(i.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=i.duration*1e3),i={}},comment(){},custom(){d.segment?(i.custom=i.custom||{},i.custom[d.customType]=d.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[d.customType]=d.data)}})[d.type].call(t)})}warnOnMissingAttributes_(t,r,i){let n=[];i.forEach(function(o){r.hasOwnProperty(o)||n.push(o)}),n.length&&this.trigger("warn",{message:`${t} lacks required attribute(s): ${n.join(", ")}`})}push(t){this.lineStream.push(t)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(t){this.parseStream.addParser(t)}addTagMapper(t){this.parseStream.addTagMapper(t)}}});function nl(e){let t=null;try{let i=new Kr;i.push(e),i.end(),t=i.manifest}catch{}if(!t&&Array.isArray(t.segments))return K("Parsing error");if(t.segments.some(i=>typeof i.duration!="number"))return K("Missing duration");let r=t.segments.reduce((i,n)=>(typeof n.duration=="number"&&(i+=n.duration),i),0);return $(r)}function ih(e){let t=null;try{let i=new Kr;i.push(e),i.end(),t=i.manifest}catch{}if(!t&&Array.isArray(t.segments))return K("Parsing error");let r=nl(e).unwrapOr("unknown");return $({builder:"NakedHls",protocol:"hls",duration:r,container:le("Mp4"),av:{audio:!1,video:{codec:je("H264"),fps:M,dimensions:M,quality:M,bitrate:M}}})}function nh(e,t){let r=null;try{let o=new Kr;o.push(e),o.end(),r=o.manifest}catch{}if(!r||!r.playlists)return K("Parsing error");let i=r.playlists,n=r.mediaGroups.AUDIO;return $(i.map(({uri:o,attributes:a})=>{let s=new URL(o,t).href,u=M;if(a.AUDIO&&n){let A=n[a.AUDIO]?.Default?.uri;if(!A){for(let f of Object.keys(n[a.AUDIO]??{}))if(A=n[a.AUDIO]?.[f]?.uri,A)break}A&&(u=C(new URL(A,t).href))}let l={audio:!1,video:"unknown"};a.CODECS&&(l=Fu(a.CODECS,M,M));let p=gt(l,A=>({codec:dt(A),bitrate:M}),A=>{let f=M,h=M,y=M,T=M;return a.BANDWIDTH&&(T=C(a.BANDWIDTH)),a["FRAME-RATE"]&&(f=C(a["FRAME-RATE"])),a.RESOLUTION&&(h=C(a.RESOLUTION),y=C(Nr(a.RESOLUTION.height))),{codec:je(A),bitrate:T,fps:f,dimensions:h,quality:y}}),g=u.isSome()?{audio:u.unwrap(),video:s}:p.video?{audio:!1,video:s}:{video:!1,audio:s},b=[le("Mp4"),le("WebM"),le("Mkv")];b=b.filter(A=>{if(p.video&&p.audio){let f=p.audio.codec.name,h=p.video.codec.name,y=!!A.supported_video_codecs.find(w=>w==h),T=!!A.supported_audio_codecs.find(w=>w==f);return y&&T}else if(p.video){let f=p.video.codec.name;return!!A.supported_video_codecs.find(h=>h==f)}else if(p.audio){let f=p.audio.codec.name;return!!A.supported_audio_codecs.find(h=>h==f)}return!1});let d=b[0]??le("Mkv");return[{builder:"Hls",protocol:"hls",duration:"unknown",av:p,container:d},g]}))}var oh=I(()=>{"use strict";me();Fi();ft();Cr();Ir();mt();rh();He()});var sl={};Z(sl,{MasterHLSProbe:()=>Wi,MaybeCreateProbeFromNetworkRequest:()=>kE});function qE(e){let t=null,r=!1;for(let[n,o]of e)if(n.av.video===!1){let a=n.av.audio.bitrate.unwrapOr(0);t?t.bitrate<a&&(t={id:o,bitrate:a,audio:n.av.audio}):t={id:o,bitrate:a,audio:n.av.audio}}else r=!0;return!r||!t?e.map(([n,o])=>[n,o,M]):e.filter(([n,o])=>!!n.av.video).map(([n,o])=>{let a=M;return n.av.audio===!1&&(n.av.audio={...t.audio},a=C(t.id)),[n,o,a]})}function al(e,t){let r={bulk:e.bulk,originalId:e.originalId,isPrivate:e.isPrivate,tabId:e.tabId,title:e.title,topUrl:e.topUrl,pageUrl:e.pageUrl,thumbnailUrl:e.thumbnailUrl,headers:e.headers,extension:t.av.video?t.container.extension:t.container.audio_only_extension,core_media:t};if(t.av.video&&(t.av.video.bitrate.isSome()&&(r.bitrate=t.av.video.bitrate.unwrap()),t.av.video.dimensions.isSome())){let i=t.av.video.dimensions.unwrap();r.size=`${i.width}x${i.height}`}return t.duration!="unknown"&&typeof t.duration=="number"&&(r.duration=t.duration),r}function ah(e,t){let r=t.find(i=>i.name=="Origin");return(r?.value?.includes("vimeo.com")||r?.value?.includes("vhx.tv"))&&e.includes("master.json")?e.replace("master.json","master.mpd"):e}function kE(e,t,r){return e.method!="GET"?null:(Array.isArray(r)||(r=[]),t=t?.toLowerCase()??"",Wi.canHandle(e.url,t,r)?new Wi(e.url,r):Ko.canHandle(e.url,t,r)?new Ko(e.url,r):null)}var ol,Qo,xt,Ko,Wi,ul=I(()=>{"use strict";me();zg();oh();ol=J(),Qo=(Ce(),P(Ne)),xt=(fe(),P(de));Ko=class{constructor(t,r){t=ah(t,r),this.mpd_url=t,this.headers=r}static canHandle(t,r,i){if(r.includes("application/dash+xml"))return!0;t=ah(t,i);try{if(new URL(t).pathname.endsWith(".mpd"))return!0}catch{}return!1}async onHitDataAvailable(t){let r=await xt.request({url:this.mpd_url,headers:this.headers});r.ok||console.warn("Failed to fetch MPD content");let i=await r.text(),n=Kg(i);if(n.isErr()){console.error("Failed to parse MPD",n.unwrapErr());return}let o=qE(n.unwrap());for(let[a,s,u]of o){let p={...al(t,a),id:"dash:"+xt.hashHex(s),descrPrefix:ol._("dash_streaming"),chunked:"dash-adp",group:"grp-"+xt.hashHex(this.mpd_url),mpd_url:this.mpd_url};if(a.av.video!==!1){if(p.mpd_video_id=s,a.av.video.bitrate.isSome()&&(p.bitrate=a.av.video.bitrate.unwrap()),u.isSome()&&(p.mpd_audio_id=u.unwrap()),a.av.video.dimensions.isSome()){let c=a.av.video.dimensions.unwrap();p.size=`${c.width}x${c.height}`}a.duration!="unknown"&&typeof a.duration=="number"&&(p.duration=a.duration),Qo.dispatch("hit.new",p)}else p.mpd_audio_id=s,a.av.audio.bitrate.isSome()&&(p.bitrate=a.av.audio.bitrate.unwrap()),a.duration!="unknown"&&typeof a.duration=="number"&&(p.duration=a.duration),Qo.dispatch("hit.new",p)}}},Wi=class{constructor(t,r){this.m3u8_url=t,this.headers=r}static canHandle(t,r,i){return!!(t.includes(".m3u8")||r.includes("mpegurl"))}async onHitDataAvailable(t){let r=await xt.request({url:this.m3u8_url,headers:this.headers});if(!r.ok){console.warn("Failed to fetch M3U8 content");return}let i=await r.text(),n=nh(i,this.m3u8_url);if(n.isErr()){let a=ih(i);if(a.isErr()){console.warn("can't parse M3U8");return}let s=a.unwrap(),l={...al(t,s),id:"nakedhls:"+xt.hashHex(this.m3u8_url),descrPrefix:ol._("hls_streaming"),chunked:"hls",group:"grp-"+xt.hashHex(this.m3u8_url),mediaManifest:this.m3u8_url};Qo.dispatch("hit.new",l);return}let o=n.unwrap();{let a=o.as_iter().find(([,s])=>!!s.video).map(([,s])=>s.video);if(a.isSome()){let s=a.unwrap(),u=await xt.request({url:s,headers:this.headers});if(!u.ok){console.warn("Failed to fetch M3U8 content");return}let l=await u.text(),p=nl(l);if(p.isOk())for(let[c]of o)c.duration=p.unwrap()}}for(let[a,s]of o){let u=al(t,a),l="";s.audio&&(l+=s.audio),s.video&&(l+=s.video);let p={...u,id:"hls:"+xt.hashHex(l),descrPrefix:ol._("hls_streaming"),chunked:"hls",group:"grp-"+xt.hashHex(this.m3u8_url+a.container.name),masterManifest:this.m3u8_url};!s.audio&&s.video?p.mediaManifest=s.video:!s.video&&s.audio?p.mediaManifest=s.audio:s.video&&s.audio&&(p.audioMediaManifest=s.audio,p.videoMediaManifest=s.video),Qo.dispatch("hit.new",p)}}}});var dh={};Z(dh,{default:()=>XE,forbidden:()=>ph,matchHit:()=>ch});async function WE(e){let t={id:"tbvws:"+e.videoId,group:"tbvws:"+e.videoId,isPrivate:e.isPrivate,tabId:e.tabId,title:e.title,from:"tbvws",videoId:e.videoId,topUrl:e.topUrl,pageUrl:e.pageUrl,thumbnailUrl:e.thumbnailUrl&&e.videoDetails.thumbnail?.thumbnails[0]?.url,duration:parseInt(e.videoDetails.lengthSeconds)||void 0,headers:[],baseJs:e.baseJs,bulk:e.bulk};e.hlsManifestUrl&&new HE(e.hlsManifestUrl,{}).onHitDataAvailable(t);let r=e.adaptiveFormats,i=e.formats,n=r.as_iter().filter(b=>typeof b.url=="string").map(b=>({result:Vu(b,"dash"),json:b})).toArray(),o=i.as_iter().filter(b=>typeof b.url=="string").map(b=>({result:Vu(b,"non-adaptative"),json:b})).toArray(),a=[...n,...o];a.forEach(({result:b,json:d})=>{b.isErr()&&console.warn("tbvws JSON parsing error",b.unwrapErr(),d)});let s=a.as_iter().filterMap(({result:b,json:d})=>b.toOption().map(A=>({core_media:A,url:d.url}))).toArray(),u=s.as_iter().filter(({core_media:b})=>!!b.av.audio&&!!b.av.video).map(b=>b).toArray(),l=s.as_iter().filter(({core_media:b})=>!b.av.audio).map(b=>b).toArray(),p=s.as_iter().filter(({core_media:b})=>!b.av.video).map(b=>b).sort((b,d)=>{if(b.core_media.av.audio&&d.core_media.av.audio){let A=b.core_media.av.audio.bitrate.unwrapOr(0),f=d.core_media.av.audio.bitrate.unwrapOr(0);return A-f}else throw"unreachable"}),c=[];for(let b of l){let d=p.as_iter().filter(A=>A.core_media.container.name==b.core_media.container.name).toArray();if(d.length>0){let A=d[0],f={...b,core_media:{...b.core_media,av:{video:b.core_media.av.video,audio:A.core_media.av.audio}},videoUrl:b.url,audioUrl:A.url};delete f.url,c.push(f)}}[...u,...c].as_iter().map(({core_media:b,...d})=>{let A=b.av.video,f={...t,...d,extension:b.container.extension,videoCodec:A.codec.name,audioCodec:b.av.audio.codec.name,core_media:b};if(A.quality.isSome()&&(f.quality=A.quality.unwrap()+"p"),A.fps.isSome()&&(f.fps=A.fps.unwrap()),A.dimensions.isSome()){let h=A.dimensions.unwrap();f.size=`${h.width}x${h.height}`}return f}).toArray().forEach(b=>{BE.dispatch("hit.new",b)})}function GE(){return uh.isProbablyAvailable()&&uh.isAtLeastVersion("2.0.0")}function ch(e){return![e.url,e.audioUrl,e.videoUrl,e.pageUrl,e.topUrl].every(t=>t?!lh.test(t)&&!UE.test(t):!0)}async function ph(){let e=Et._("chrome_noyt_text"),t=zo.hash(e),r=Et._("chrome_noyt_text3"),i=zo.hash(r),n=r;i==-1960581238&&t!=-1126813505&&(n=e);try{switch((await VE.alert({title:Et._("chrome_warning_yt"),text:[n,Et._("chrome_noyt_text2")],height:400,buttons:[{text:Et._("chrome_install_firefox"),className:"btn-outline-secondary",close:!0,trigger:{what:"installFirefox"}},{text:Et._("chrome_install_fx_vdh"),className:"btn-outline-primary",close:!0,trigger:{what:"vdhForFirefox"}}]})).what){case"installFirefox":return sh.gotoOrOpenTab("https://getfirefox.com/");case"vdhForFirefox":return sh.gotoOrOpenTab("https://addons.mozilla.org/firefox/addon/video-downloadhelper/")}}catch(o){console.error("tbvws error",o)}}var Et,ll,BE,FE,zo,sh,VE,uh,HE,jE,LE,UE,lh,XE,fh=I(()=>{"use strict";pg();Et=J(),ll=Et.browser,BE=(Ce(),P(Ne)),FE=($r(),P(Xr)),zo=(fe(),P(de)),sh=(Ft(),P(Bt)),VE=(Hi(),P(Vi)),uh=(Ht(),P(Vt)),{MasterHLSProbe:HE}=(ul(),P(sl)),jE="youtube",LE=new RegExp("^https?://([^/]*\\.)?youtube(?:\\-nocookie)?(\\.co)?.([^./]+)/"),UE=new RegExp("^https?://([^/]*.)?googlevideo\\."),lh=new RegExp("^https?://([^/]*\\.)?youtube(\\.co)?.([^./]+)/.*");Et.rpc.listen({tbvwsDetectedVideo:async e=>{try{await WE(e)}catch(t){console.error("VDH error: detectedVideo",t)}}});ll.webNavigation.onCompleted.addListener(async function(e){let t=await Et.prefs,r={tabId:e.tabId,frameIds:[e.frameId]};if(LE.test(e.url))try{let i=await ll.tabs.get(e.tabId);zo.executeScriptWithGlobal(r,{_$vdhData:{...r,isPrivate:!1},_$vdhSmartNameSpecs:await FE.getSpecs(e.url),_$vdhTopUrl:i.url,_$vdhExtractMethod:t.tbvwsExtractionMethod,_$vdhSupportChallenge:GE()},"/injected/tbvws.js")}catch(i){console.error("Cannot find tab",i)}if(t.bulkEnabled&&lh.test(e.url))try{let i=await ll.tabs.get(e.tabId);zo.executeScriptWithGlobal(r,{_$vdhTopUrl:i.url},"/injected/tbvws-bulk.js")}catch(i){console.error("VDH error: could not inject bulk script",i)}},{url:[{hostContains:jE}]});XE={matchHit:ch,forbidden:ph}});var mh={};Z(mh,{BulkDownload:()=>KE});async function KE(e,t){let r=new Set;for(let i of e.bulk_ids){let n=`https://www.${QE}.com/watch?v=${i}&vdh-bulk=1`,o=await Yo.tabs.create({url:n,active:!1});await Yo.tabs.update(o.id,{muted:!0}),r.add(o.id)}for(let i=0;i<60;i++){let n=await Zo.getSerializedHits();for(let o of n){let a=o[0];for(let s of r){let u=a.tabId==s,l=!!a.masterManifest,p=a.extension=="mp4";if(u&&l&&p){r.delete(a.tabId),$E.execute(t,a.id),Yo.tabs.remove(a.tabId);break}}}if(r.size==0){console.log("All hits were found and downloaded");break}await new Promise(o=>setTimeout(o,1e3))}}var Jo,Yo,Zo,$E,QE,gh=I(()=>{"use strict";mt();Oi();Jo=J(),Yo=Jo.browser,Zo=(Ce(),P(Ne)),$E=(Xi(),P(Gi)),QE="youtube";Jo.rpc.listen({tbvwsSelectedIds:e=>{let t=[],{flat:r}=Zo.getHits();for(let i of r.values())i.from=="tbvws-bulk"&&i.topUrl==e.topUrl&&!i.running&&t.push(i.id);if(t.length>0&&Zo.dispatch("hit.delete",t),e.ids.length>0){let i="tbvws-bulk:"+Math.floor(Math.random()*1e9),n={id:i,group:i,title:Jo._("selected_media"),descrPrefix:Jo._("bulk_n_videos",""+e.ids.length),from:"tbvws-bulk",bulk_ids:e.ids,pageUrl:e.pageUrl,topUrl:e.topUrl,thumbnailUrl:Yo.runtime.getURL("/content/images/tbvws.png"),core_media:{builder:"YoutubeBulk",protocol:"unknown",duration:"unknown",container:le("Mp4"),av:Hn()}};Zo.dispatch("hit.new",n)}}})});var Jr={};Z(Jr,{alertAudioNeedsReg:()=>eT,checkLicense:()=>vh,setLicense:()=>bh,validateLicense:()=>fl});function YE(e){return e&&e.substring(0,1).toUpperCase()+e.substring(1)||""}function yh(e,t){let r=new TextEncoder("utf-8").encode(t+e.key+e.email);return crypto.subtle.digest("SHA-256",r).then(i=>pl.bufferToHex(i))}async function fl(e){let t=await hh.check();if(!t.status)return{key:e,last:Date.now(),status:"nocoapp"};let r=t.info.home,i;try{i=await pl.request({url:"https://www.downloadhelper.net/license-check.json",content:"key="+encodeURIComponent(e)+"&product=converthelper",headers:{"Content-type":"application/x-www-form-urlencoded"},method:"POST"})}catch{throw new Error(vr._("network_error_no_response"))}if(!i.ok)throw new Error(vr._("network_error_status",i.status+" "+i.statusText));let n=await i.json(),o={key:e,last:Date.now(),remoteStatus:n.status,status:n.status,name:n.name,email:n.email},a=YE(zr);if((n.target=="fx"||n.target=="firefox")&&zr!="firefox"?(o.status="mismatch",o.brExt=a,o.brLicense="Firefox"):n.target=="edge"&&zr!="edge"?(o.status="mismatch",o.brExt=a,o.brLicense="Edge"):(n.target=="crx"||n.target=="chrome")&&zr!="chrome"&&(o.status="mismatch",o.brExt=a,o.brLicense="Chrome"),o.status=="accepted"){let s=await yh(o,r);o.sign=s}return await dl.set(o),o}function vh(){return new Promise((e,t)=>{cl.runtime.getPlatformInfo().then(r=>{if(r.os=="linux"&&!JE)return e({status:"unneeded"});ZE().then(i=>{if(i===null)return e({status:"unset"});let n={status:"unset"};if(i.email&&(n.email=i.email),i.key&&(n.key=i.key),i.name&&(n.name=i.name),i.status=="mismatch")return n.status="mismatch",n.brLicense=i.brLicense,n.brExt=i.brExt,e(n);hh.check().then(o=>o.status?yh(i,o.info.home):(n.status="nocoapp",e(n),null)).then(o=>{if(o)return!i.remoteStatus&&n.key?new Promise((a,s)=>{fl(n.key).then(u=>{i=u,a(o)}).catch(u=>{s(u)})}):o}).then(o=>{o&&(i.remoteStatus=="accepted"&&o===i.sign?n.status="accepted":i.remoteStatus=="blocked"?n.status="blocked":i.remoteStatus=="locked"&&(n.status="locked"),e(n))}).catch(t)}).catch(t)}).catch(t)})}function bh(e){return dl.set(e)}function eT(){zE.alert({title:vr._("converter_needs_reg"),text:vr._("converter_reg_audio"),buttons:[{text:vr._("get_conversion_license"),className:"btn-success",rpcMethod:"goto",rpcArgs:["https://www.downloadhelper.net/convert"+(zr?"?browser="+encodeURIComponent(zr):"")]}]})}var vr,cl,hh,pl,zE,zr,JE,dl,ZE,Yr=I(()=>{"use strict";vr=J(),cl=vr.browser,hh=(Ht(),P(Vt)),pl=(fe(),P(de)),zE=(Hi(),P(Vi)),{browser:zr,linuxlic:JE}=er().buildOptions;dl=new pl.Cache(()=>cl.storage.local.get("license").then(e=>e.license||null),e=>cl.storage.local.set({license:e}));ZE=dl.get();vr.rpc.listen({checkLicense:vh,validateLicense:fl,setLicense:bh})});var Ah,_h=I(()=>{"use strict";Ah="R0lGODlhNgE2AaEAAAAAAP///wAAAAAAACH5BAEKAAIALAAAAAA2ATYBAAL+jI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMpvMJjUqn1KrVAshqt9yu9wsOi8dZCDncO4PN6rb7Td7A5/Q5m56u3+v8/lfuFygIsAeXh/cwqMgHuOjoVvh2aJf4aHnWeKn5V4m4w9i5KbqVOToaCckD6mDaSqjhaoraNmkYGntZivs4q1YrebvrqCus2IupqhdcPEjMHHgcl+zZ8MwLa70YPfabypptjL3WTXr1IuaDLs45zW7Oot7u5ayVjvbeEv95n6Gv448PBUAcAykUtHEw4IiENBhGszdOYQqHMih+i7gPo0T+ExZhdGTw0UXIjRhGwuNXEuU/lSQXsiT40mBMhDNbejC5AucBnRNr2uTAU6DPh+Tq/SQR9ERQh7mWlbvo7oImp76olrHah2i/oU2hzsNKD5pXYGO5bFNW9mlKjQu6VuM6FGvWtFXpXrU7F2/YV3hXvWWrYKnbtmj/RiV8Te+6r30Lg4QLWKYluUwhDwO7uMtZao8jIxA8ubFlxoa1Yd7qeWdoxazXJu5MqTVs07KxjA5XO3Bc0Zx19/Z9GDjt0pozm6X8O0Hl1BGm8g6u/Haz065Jz8ZN/Hhuya8Rx86u9vr07ROWXyavmvnm5Om/iw/vffh7o6ihf14Nnn5+ZPv+71bHPp9/AebV317r2YKeAX7FZ51t3TGoXX8LQghfBebJR6F+A3LT114TClfcc2QVaFyF0T0IYoQbMsRhfRimaOJ9KJ5onwQXApihgDlKI6GHju144IgDGoice0AWWWMALf43HokieuMkkzG29yKNDcJY14Y+skdliBL+iKWOFkoniFZf+rSkVPgNiaSQR7ro5YpcKkhmljvyJaVYCSq55pt5imkljmHiKSdzaTp4XpSFIqgoolcG2iSbT6o4KKGOCgrplHTOKGOSZi7q5qBBxlnplkaK2iaUkv5paaVgZqrhnYNdGqmfoKpqK62a8slpl5S62ueYvW7q6ayowvn+K6x+fCprsNxV2emj0WI6bbLl1bksdbfWKmyiq25rZ67dSutrmdo2O+yotJwL7KnKtvosqe0y+i263uqqZ6PzhvoukZOGe+yZ6aa67p7G9ltirPviGjC4+aqZ7o3cIozsrgdXa7EwptIr7rsfUsyqugCD7HC2FT/cMcYoN4wvoCqbrK/HF9vo7Mvw2vyxzf5m5KlcO9fLctA3gNZzDEQXHbPO7JKcw9HyDr1bjwm7XK7CTAtNk3pLZ420llPfXDXVxJI79tNck80sTFp3+HXaV799ttk0r+1R1F6fLDavxWILdkN2p1yD03I3x7fbSsszuOGB/11q21uH3bfeaFf+xDjci9N9d8iPl20t5BB1DbjfmN/5c+iSJ54UR5UfzvPkbOMducQZj57P6p4XlbfPjhtcOO6REwxO77yrJ7vVOAdfMKvIJw+05ZzPvjfxy8MM8fSvst489qYXb/3I13Y/5+mdP2/87cNHDz7H46bP/PbCJ22+wOyPLzL7ipOfN/ex8z0/6Av3fz/xQQ9t+qtf+jbWv/y9L3vxYyD+Eug6+UEwgAXcnADL90AI0g949rNgBc9HQA3yR3kiVKD0Toi+EKKwhLQ7CuHQlDqpuXCGqoOh7V7YQhrqEIdJOhQIfLjDIMKub0C8SQyFGMQiZrCGOUSiE5f4Opfc8IlCVOL+BTHoISpqMV6Ds2IWtwhG3clQik0MIw2t6MWv/c6MT0TjEUnHxjhCjohvbJwc/7UyLg4wcZQr4xVzh0cewY+Hrigd1i7nP48hkGHOMyCBqqfCROZkimkMpBcFJ4vdDXIGmNwVBwXpQEfmbG4p5KPRKNlJ6pnuk49s2f78qBRUyvJehyRkKwzZyD5Kco6LbF8tRXk9UkYygueY5S4zGMwH9tJcsAugLokJxyEm84/LzOP3SrnBU/qxkhJkpPbWd0tNhvKZphwjJKnVQFe6sWbInCYToSVMaIIzmyS04bCcU7eBRVEE3DynN9s5J3wWU5/mDEE/1cmimf2xlSchaOb++FlHmdmTlsdzZwkUuo13ylOP3gOou+Y4SqE4NJpkPKYjWbnOkRqUnbakpz9ditCJwnOhIY2lShV50YhW1FAKFahIWJrRnE6RlShNKFA1OrFrmlSMJeUXSJPp09rdFGdIhek8O0pTqGK0qtaMZzlf6snWOTWdQzjoL2taxWnqVAVmbSRak6jWoWpzm/xbqxVqaleR0nWFY3UiXuWaz71i05da/Css52pS/bX1KIZdKmI3+k2JHlYijYUsIhNbV8AqpLJfbVoqX/nRNsZ1sgMV7DD7ikTOWhVqxkSdRaOwWLJyFItqLAZRi0paiLZ2tVQV6vRua8m8frGZauSqNYD+203CXtayyiyub5eH3JLFVq+YNS1zgclS1TJzJbsNa0F/2L3o2gu1j+3sL5mq299aEruORcpnh9vU4In3f1glp3lzuc+VWm++klVf3O4bWaVeF7f3HC1Flwtg2Qo4wS3NBn936l8E81bBXp1wg4+7XgIPWJzpnWlWearZn/KVflvdUzVBOd4uCte4oD1tUitM29qGL6TT5eQCU6xcGANSmjPWaoilOlgslniTJ76kj3MLZBfv8cUXXiOPQ+tRstXYvkuuclebbNMDPxXESG5okE2oZSyzWLtYnXJ5rQxmD1uwyIo1apcnOWI0M3S2Tq4nlD/cwxU/17VxvrIzZXz+Zxrr2b19TjM6bSxTBuN5pmR+RpY3TGguVxcXD95yLB6t6DGjN6YF7rF692xhTKu4u6fIcHCPymHWSvq6tjV1cksNau+KeNWKbvWrhbxfFvuOjqQWRaWjHM5Yx7i0ee71Jn696GBHGtLxHV+NbS1d9qo51f919mej2l8lY1jYO551sa2rbBzLGdrNHra3pXztnhoYeaKWNaeh3OgW8/nLdRY3rguNYjh3OtA3PquxjYxvM9sZ3uuet7YNHep4nzSwYVa4B/tNZ4DTW+BgvbLDQWjwWhecxK/tMKM3LmcK/vuDt+62fvcdYQo3F+MJB/m978xtVWY74xzH959LLu/+msN82R/3NL1FDu4crxznZ96uvREe8ocHvb5t/nHEBe3zg+c86U/+ObKpDeGeU/rqJs4vTokLdpxDfeuurni97fhQV+Iy64cm99HPjt/v9jbsZpd2X91OX3Ov0utz1xzd3z72S3OdyHznJdZ1PHVYSzfez/73pq9qcn/vQsOofSvh5W74v0M+8b4+ddTJ23XMQ1HzdLb7P5PNZNS7+7yFH73fX7/4Iwu+7Gp3rujFTHq2MxnvM2/50jHY+N9z/tie53f41tz6ha69J28OsMqDynMWFrLokd/8zdMOXulPnvpwLz3yb89m7R8/5u1+OavzKv7tMzzTSp90e2OfftD+R3/11v8+9j8Q/9kTm/0sp3/fPZ5/2KZvzBZK1zZmAZh6uqaAoXd/RoSAnbd+oQZ07keAefeAp1d+1ed9DEhSAHiB0wZXEdNxe5d7Dvh+mwVUljdOh9cBgwZbKTiCrFeCLeh074BRKkiCsOeBendGMDh+l6eDJ1eB+HCDMRh3QZh9JxgQRfiDKziDQFGD5sCEOweEdbeAbDSFKYd788eD9RdHWSh/ToiE+BeFVwCGGGh/Vkh+cnSGQnd9asiFGmhpE3SATQiHBZhrVUeHMYeDtdd/2zZwexiHc0aGNkd5CVh87FaHVDiGzxdegKZBGUiIJih1pmd07yaI5SZzSVj+iYd4iZsnfZLYh164SY+ohwkkika4gaWYh4GIiouohVBoiIl4aJYIiJo4iTQ4i2KHarz4aYM4iquIh794h57VfJTIf1Xoh8pzhdylhEKYjGJYjKDYjMb4jJwYjTk4jRFXjWpzjYX4jc+3fE3WfYj3OUOIjRKYhstoduW4hc6IjuAYj+LIgtCHi+eYjdCojhzIjurUjao2j7oYjkN3j7ZXkIizj4MoiQtpkDsoh8w3kLIYkcJlgGuIkP7HVmVIkA7pjspnkWKVkAepkP+4YCEpeWFGTdyXi7a4iSWJke8IeBCXkb0Ifyj5ePJIc594hBy5kp7oZzeJjDrnYS4YkyP+p37M+JE12YkRiIi+aJPJN46qN0LSqI9NqZS1CJQCKXUXt39YSYtW2YFVaX61SJQWmG9Pd5TtSJJziIFl2Xtu6JMtiXgd2X5DqZEs+ZBSSXxDtJbA5oZuqXtw+ZU66ZJdWJjDx5VUCYrq9nlC6ZWsKIK7iIsCyJaOaZmEaY5xOXxviIlt53JI95N/KJcbKYOuuHufiZiq6Ig+aHV8yJjGN3GqSZpvOZXuc4x+iZl6uZmaGZVtOJYmaZaBV3mZxYi2iZIkN5mvGYtNV5wnaZeSyZPKOZwBJ5spOZi/SXXAKJ1tSZyxWJdkKZNBmUlE951g6ZzgCZ1iCYHRVp65OYH+zxmbrViUF9iXuomc86l/+ImA9emboNlBTvmA/MmaW2mKVxmAAhqZ8UmMwfmBdCmaK8mc0HWd6Yegx9mdigig+5mU+nmZ2Dk/mql9FQqfBCqfDPqBIoqeCiqhGXqgG2qircmi42mg+VefVOah/umgTPmS1qmM6bijDPmgSRB8MHpuwOmjN7qbRzCkS9mVP4qiHZqXNmqYq3mbnOllTKqY1baj93ml+XikOGqlWjqls+l81OWlOAmlSWoES5qTYyqRAfmmbQqmSMCmaSqlOTqSQUqn77WOX4qnIjmMEalp9QiY9Kijc8qPAHl+6TmAZyqeSBqmEral4WmmNNqnwqimjWjHoTLajiwUqZmZqP/3ovnZmQB0qYf5qR4Zo4rXqSWUqu+pcYlmqqc4qz2KqaUZlrTpaJCYiZlKilmaeTPKqqX6oacKqrYarJs6rIvpqsYKk7iqqaM6fbRarKGKqs6aUpHIq69orccKrK6nrOvZqiL0qu3pptnaq3ekruvKru3qru8Kr/Eqr/NKr/Vqr/eKr/mqr/vKr/3qr/8KsAErsANLsPZaAAA7"});var $i={};Z($i,{convert2:()=>aT,getCodecs:()=>Sh,getFormats:()=>Th,getOutputConfigs:()=>bl,info:()=>rT,makeUniqueFileName:()=>oT,open:()=>nT,play:()=>iT,resetOutputConfigs:()=>Eh,setOutputConfigs:()=>xh,sideDownload:()=>cT,sideDownloadAbort:()=>uT,sideDownloadMPD:()=>lT,updateHit:()=>tT});function tT(e){console.warn("TODO converter.updateHit")}function gl(e){(e||[]).forEach(t=>{t.name=="Accept-Encoding"&&(t.value=t.value.split(",").map(r=>r.trim()).filter(r=>r!="br").join(", "))})}function rT(e,t=!1,r=[]){gl(r);let i=pe.call("probe",e,t,r);return t?i.then(n=>JSON.parse(n)):i}function iT(e){return pe.call("play",e)}function nT(e){return pe.call("open",e)}function oT(e){return pe.call("makeUniqueFileName",e)}async function aT(e,t,r,i){let n=[];n.push("-i",e);let o=ta[t];for(let p in o.params){let c=o.params[p];c!==null&&(typeof c!="string"||c.length>0)&&(n.push("-"+p),n.push(""+c))}if(o.extra){let p=/^\s*(.*?)\s*$/.exec(o.extra)[1].split(/\s+/);for(let c of p)n.push(c)}o.audioonly&&n.push("-vn");let a=e.split(".");a[a.length-1]=o.ext;let s=a.join(".");n.push("-y",s);let u=++hl;ra[u]=r;let l=++yl;br[l]=i;try{let p=await pe.call("convert",n,{progressTime:""+u,startHandler:""+l});if(p.exitCode!=0)throw new ea.DetailsError("Convert2 error: ",p.stderr);return s}finally{delete u[u],delete br[l]}}function xh(e){return vl.set(Object.assign({},ta,e))}function Eh(){return bl().then(e=>{let t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r].readonly||delete t[r]}),vl.set(t)})}function Th(){return pe.call("formats")}function Sh(){return pe.call("codecs")}function sT(e,t,r){let i=ra[e];i&&i(t,r)}function uT(e){return pe.call("abortConvert",e)}async function lT(e,t,r,i){let n=[],o=["ffmpeg"];gl(i.headers),i.headers&&i.headers.length&&(n.push("-headers"),n.push(i.headers.map(u=>u.name+": "+u.value).join(`\r
`)+`\r
`),o.push("-headers"),o.push("$'"+i.headers.map(u=>`${u.name}: ${u.value}\\r\\n`).join("")+"'")),n.push("-i",e),o.push("-i",`'${e}'`),t&&(n.push("-map",`0:${t}`),o.push("-map",`0:${t}`)),r&&(n.push("-map",`0:${r}`),o.push("-map",`0:${r}`)),t&&(n.push("-codec","copy"),o.push("-codec","copy")),n.push("-y"),n.push(i.filePath),o.push("-y"),o.push(i.filePath);let a=++hl;ra[a]=i.on_progress;let s=++yl;br[s]=i.on_start;try{let u=await pe.call("convert",n,{progressTime:""+a,startHandler:""+s});if(u.exitCode!=0)throw new ea.DetailsError("SideDownload error: ",u.stderr)}finally{delete a[a],delete br[s]}}async function cT(e,t,r){let i=[],n;if(r.qr_code_needed){let{path:s,fd:u}=await pe.call("tmp.file",{prefix:"vdh-wm-",postfix:".gif"});await pe.call("fs.write2",u,Ah),await pe.call("fs.close",u),n=s}if(r.qr_code_needed&&i.push("-i",n),r.headers&&r.headers.length>0){gl(r.headers);let s=r.headers.map(u=>`${u.name}: ${u.value}\r
`).join("")+`\r
`;i.push("-headers"),i.push(s)}if(e&&i.push("-i",e),t&&i.push("-i",t),r.qr_code_needed&&e){i.push("-filter_complex","[0][1]scale2ref=w=oh*mdar:h=ih*0.4[logo][video];[video][logo]overlay=5:H-h-5");let s="h264";r.filePath.endsWith("webm")&&(s="libvpx-vp9"),i.push(...`-c:v ${s} -preset superfast`.split(" "))}else r.merge&&i.push("-map","0:v:0","-map","1:a:0"),e&&i.push("-c","copy");i.push("-y",r.filePath);let o=++hl;ra[o]=r.on_progress;let a=++yl;br[a]=r.on_start;try{let s=await pe.call("convert",i,{progressTime:""+o,startHandler:""+a});if(s.exitCode!=0)throw new ea.DetailsError("SideDownload error: ",s.stderr)}finally{if(n)try{await pe.call("fs.unlink",n)}catch{}delete o[o],delete br[a]}}function pT(e,t){let r=br[e];if(r)try{r(t)}catch(i){console.error("start handler error",i)}}var ml,wh,pe,ea,ta,hl,ra,yl,br,vl,bl,Qi=I(()=>{"use strict";_h();ml=J(),wh=ml.browser,pe=(Ht(),P(Vt)),ea=(fe(),P(de));hl=0,ra={},yl=0,br={};vl=new ea.Cache(()=>wh.storage.local.get("outputConfigs").then(e=>e.outputConfigs||ta),e=>wh.storage.local.set({outputConfigs:e})),bl=vl.get();ml.rpc.listen({getOutputConfigs:bl,setOutputConfigs:xh,resetOutputConfigs:Eh,editConverterConfigs:e=>{ml.ui.open("convoutput"+(e?"#"+e:""),{type:"tab",url:"content/convoutput.html"})},getFormats:Th,getCodecs:Sh,convertStartNotification:pT});pe.listen({convertOutput:sT});ta={"e6587753-4ca5-4d2e-b7ba-beaf1e7f191c":{title:"Re-encoded MP4 (h264/aac)",ext:"mp4",params:{"c:a":"aac",f:"mp4","c:v":"h264"},audioonly:!1,readonly:!0},"249a7d34-3640-4ac3-8300-13827811d2cf":{title:"MPEG (mpeg1+mp2)",ext:"mpg",params:{"c:a":"mp2",f:"mpeg",r:24,"c:v":"mpeg1video"},extra:"-mbd rd -trellis 2 -cmp 2 -subcmp 2 -g 100",audioonly:!1,readonly:!0},"6de4f5ce-8cfe-4f0f-8246-bacb7b0d7624":{title:"WMV 500Kb (Windows Media Player)",ext:"wmv",params:{"c:a":"wmav2",f:"asf","c:v":"wmv2","b:v":"500k"},extra:null,audioonly:!1,readonly:!0},"21a19146-e116-4460-8356-a8eab9cf61ce":{title:"WMV 1Mb (Windows Media Player)",ext:"wmv",params:{"c:a":"wmav2",f:"asf","c:v":"wmv2","b:v":"1000k"},extra:null,audioonly:!1,readonly:!0},"933b1b41-6862-4ce0-9605-10fa5e4b310c":{title:"WMV 2Mb (Windows Media Player)",ext:"wmv",params:{"c:a":"wmav2",f:"asf","c:v":"wmv2","b:v":"2000k"},extra:null,audioonly:!1,readonly:!0},"90195ab2-d891-443c-a164-8f0953ec8975":{title:"WMV 4Mb (Windows Media Player)",ext:"wmv",params:{"c:a":"wmav2",f:"asf","c:v":"wmv2","b:v":"4000k"},extra:null,audioonly:!1,readonly:!0},"3a4cc0a6-6eb0-4cff-90fb-fdf8eb6a9571":{title:"AVI 500Kb (mpeg4/mp3)",ext:"avi",params:{"c:a":"mp3",f:"avi","c:v":"mpeg4","b:v":"500k","b:a":"128k"},extra:null,audioonly:!1,readonly:!0},"ebdbb895-7a1e-43e2-bef4-be6e62cb8507":{title:"AVI 1Mb (mpeg4/mp3)",ext:"avi",params:{"c:a":"mp3",f:"avi","c:v":"mpeg4","b:v":"1000k","b:a":"128k"},extra:null,audioonly:!1,readonly:!0},"0b6280d3-f8f2-4cb6-8235-a5a4b91488f7":{title:"AVI 2Mb (mpeg4/mp3)",ext:"avi",params:{"c:a":"mp3",f:"avi","c:v":"mpeg4","b:v":"2000k","b:a":"128k"},extra:null,audioonly:!1,readonly:!0},"9ea8a22b-5738-4d0f-8494-3037ec568191":{title:"AVI 4Mb (mpeg4/mp3)",ext:"avi",params:{"c:a":"mp3",f:"avi","c:v":"mpeg4","b:v":"4000k","b:a":"128k"},extra:null,audioonly:!1,readonly:!0},"4174b9dd-c2a0-409d-801d-c84f96be0b76":{title:"MP3",ext:"mp3",params:{"b:a":"128k","c:a":"mp3",f:"mp3"},extra:null,audioonly:!0,readonly:!0},"05cb6b27-9167-4d83-833d-218a107d0376":{title:"MP3 HQ",ext:"mp3",params:{"b:a":"256k","c:a":"mp3",f:"mp3"},extra:null,audioonly:!0,readonly:!0},"69397f64-54f2-4ee4-b47a-b4fc42ee2ec1":{title:"MP4 500Kb",ext:"mp4",params:{"c:v":"mpeg4","c:a":"aac",f:"mp4","b:v":"500k","b:a":"128k",ac:2},extra:"-mbd rd -flags +mv4+aic -trellis 2 -cmp 2 -subcmp 2 -g 300",audioonly:!1,readonly:!0},"16044db3-3b75-4155-b549-c0ba19c18887":{title:"MP4 1Mb",ext:"mp4",params:{"c:v":"mpeg4","c:a":"aac",f:"mp4","b:v":"1000k","b:a":"128k",ac:2},extra:"-mbd rd -flags +mv4+aic -trellis 2 -cmp 2 -subcmp 2 -g 300",audioonly:!1,readonly:!0},"b5535083-bf16-4ae0-a21f-7c637ce0617f":{title:"MP4 2Mb",ext:"mp4",params:{"c:v":"mpeg4","c:a":"aac",f:"mp4","b:v":"2000k","b:a":"128k",ac:2},extra:"-mbd rd -flags +mv4+aic -trellis 2 -cmp 2 -subcmp 2 -g 300",audioonly:!1,readonly:!0},"dfbed97f-46c9-4db8-b5d1-4d19901bc236":{title:"MP4 4Mb",ext:"mp4",params:{"c:v":"mpeg4","c:a":"aac",f:"mp4","b:v":"4000k","b:a":"128k",ac:2},extra:"-mbd rd -flags +mv4+aic -trellis 2 -cmp 2 -subcmp 2 -g 300",audioonly:!1,readonly:!0},"912806c1-6c43-44ad-ac6e-05f105bade55":{title:"iPhone",ext:"m4v",params:{"c:v":"mpeg4","c:a":"aac",s:"480x320","b:v":"800k",f:"mp4",r:"24","b:a":"128k"},extra:null,audioonly:!1,readonly:!0},"2416dcbf-146d-4ca4-b948-f6f702fb043c":{title:"iPod",ext:"m4v",params:{"c:v":"mpeg4","c:a":"aac",s:"320x240","b:v":"500k",f:"mp4",r:"24","b:a":"128k"},extra:null,audioonly:!1,readonly:!0},"42fb9cf9-94f9-45c1-954f-1c5879f3d372":{title:"Galaxy Tab",ext:"mp4",params:{"c:a":"aac","b:a":"160k",ac:"2","c:v":"h264",f:"mp4"},extra:"-crf 22",audioonly:!1,readonly:!0},"edf545c2-88fc-4354-b91d-83e2f31d3c14":{title:"MOV (QuickTime player)",ext:"mov",params:{f:"mov","c:v":"h264",preset:"fast","profile:v":"baseline","c:a":"aac","b:a":"128k"},extra:null,audioonly:!1,readonly:!0},"f31ac68e-db3b-4b17-95d7-04456cbc3c26":{title:"Mobile 3GP (Qcif)",ext:"3gp",params:{f:"3gp","c:v":"h263","c:a":"aac","b:a":"12k",s:"176x144","b:v":"64k",ar:"8000",r:"24"},extra:null,audioonly:!1,readonly:!0},"85cd71a0-fb61-45a4-9fed-6f2e6e405bc3":{title:"MPEG-2 DVD (PAL)",ext:"mpeg",params:{f:"mpeg2video",target:"pal-dvd"},extra:null,audioonly:!1,readonly:!0},"47b9b2eb-8fd4-4e10-8993-f7d467ed1928":{title:"MPEG-2 DVD (NTSC)",ext:"mpeg",params:{f:"mpeg2video",target:"ntsc-dvd"},extra:null,audioonly:!1,readonly:!0}}});var Ph=m((C5,Oh)=>{"use strict";var Ki=J(),dT=(Yr(),P(Jr));async function fT(e){let t=await Ki.prefs;Math.round(Date.now()/1e3)<t.donateNotAgainExpire||dT.checkLicense().then(r=>{r&&r.status=="accepted"||Ki.ui.open("funding",{type:t.alertDialogType,url:"content/funding.html",height:550})})}Oh.exports.newDownload=async function(){let e=await Ki.prefs,t=e.downloadCount;t++,e.downloadCount=t,t>0&&t%100==0&&fT(t)};Ki.rpc.listen({fundingLater:async()=>{let e=await Ki.prefs;e.donateNotAgainExpire=Math.round(Date.now()/1e3)+60*60*24*30}})});async function _T(e,t,r,i,n){let o=await G.prefs,a=!!r,s=Date.now(),u=!1;if(u=Mh.matchHit(e),ia.noyt&&u){Mh.forbidden();return}ne.update(e.id,{operation:"queued"});let l,p;{let{status:x,info:O}=await Ee.check();l=x,l&&(p=O.version)}let c;{if(e.gallery_urls)c="gallery";else if(e.core_media.builder=="YoutubeBulk")c="youtube_bulk";else if(e.core_media.builder=="Hls")c="hls";else if(e.core_media.builder=="NakedHls")c="hls";else if(e.core_media.builder=="MPDParser")c="mpd";else if(e.core_media.builder=="HTTPMedia"){let x=o.coappDownloads;if(l&&x=="ask"){let D=await AT();x=D.mode,D.notAgain&&(o.coappDownloads=x)}x=="browser"||!l&&!a?c="file_inbrowser":c="file_coapp"}else e.core_media.builder=="YoutubeFormat"&&(c="youtube_format");if(!c)throw new Error("No download strategy for builder: "+e.core_media.builder)}if(i&&c!="hls"&&c!="mpd"&&c!="file_coapp"&&c!="youtube_bulk"){Wt.alert({title:G._("dialog_audio_impossible_title"),text:G._("dialog_audio_impossible")});return}if(c!="file_inbrowser"&&c!="gallery"){if(!l){Wt.alert({title:G._("coapp_required"),text:G._("coapp_required_text"),buttons:[{text:G._("coapp_install"),className:"btn-success",rpcMethod:"installCoApp"}]});return}let x=vT;if(c=="mpd"&&(x=bT),!Rh.isMinimumVersion(p,x)){try{await Ee.call("quit")}catch{}await new Promise(N=>setTimeout(N,2e3));let{status:O,info:D}=await Ee.check();if(!O||!Rh.isMinimumVersion(D.version,x)){Ee.call("quit"),Wt.alert({title:G._("coapp_outofdate"),text:G._("coapp_outofdate_text",[D.version,x]),buttons:[{text:G._("coapp_update"),className:"btn-success",rpcMethod:"installCoApp"}]});return}p=D.version}}let g=!1;{let x=!1;{let{status:O}=await gT.checkLicense();x=O=="accepted"||O=="unneeded"}if(!x){let O=ia.target=="google",D=ia.target=="mozilla",N=ia.target=="microsoft",B=120,q=B*60*1e3,W=await Mn("last_advanced_download",0),V=s-W,ee="https://www.downloadhelper.net/convert";if(i&&(c=="mpd"||c=="hls"||u)){Wt.alert({title:G._("chrome_premium_required"),text:G._("converter_reg_audio"),buttons:[{text:G._("continue"),className:"btn-success",rpcMethod:"goto",rpcArgs:[ee]}]});return}if(a){Wt.alert({title:G._("chrome_premium_required"),text:G._("converter_needs_reg"),buttons:[{text:G._("continue"),className:"btn-success",rpcMethod:"goto",rpcArgs:[ee]}]});return}if((O||N||a)&&(c=="mpd"||c=="hls"||u)&&V<q){Wt.alert({title:G._("chrome_premium_required"),text:G._("chrome_premium_hls",[B]),buttons:[{text:G._("continue"),className:"btn-success",rpcMethod:"goto",rpcArgs:[ee]}]});return}D&&u&&!i&&(g=!0)}}let b,d;{d=e.core_media.container.extension,(i||!e.core_media.av.video)&&(d=e.core_media.container.audio_only_extension);let x=e.title??"video";b=await hT.getFilenameFromTitle(x,d)}if(c=="gallery"){for(let x of e.gallery_urls){let D={url:new URL(x,e.topUrl).href};zi.downloads.download(D)}return}if(c=="youtube_bulk"){mT.BulkDownload(e,i?"quickdownloadaudio":"quickdownload");return}if(c=="file_inbrowser"){ne.updateRunning(e.id,1),ne.update(e.id,{operation:"downloading",opStartDate:Date.now()}),ne.updateProgress(e.id,0);let x={url:e.url,saveAs:!t,filename:b},O=await zi.downloads.download(x);n.set(e.id,{inbrowser:O});let D=0;for(;;){let N=await zi.downloads.search({id:O});if(N.length>0){let B=N[0],q=B.bytesReceived-D;D=B.bytesReceived;let W=B.bytesReceived/B.totalBytes;if(ne.update(e.id,{raw_bitrate:q}),ne.updateProgress(e.id,100*W),B.error){Dh("No download item found");break}if(B.state=="complete")break}else break;await new Promise(B=>setTimeout(B,1e3))}return"inbrowser"}let A,f=o.lastDownloadDirectory;{try{await Ee.call("fs.stat",f)}catch{f=await Ee.call("path.homeJoin",f),await Ee.call("fs.mkdirp",f)}if(t)A=(await Ee.call("makeUniqueFileName",f,b)).filePath;else{let x=await Wt.saveAs(b,f);if(x)A=x.filePath,A.endsWith(`.${d}`)||(A+=`.${d}`),f=x.directory;else return}try{await Ee.call("fs.stat",f)}catch{f=await Ee.call("path.homeJoin",f),await Ee.call("fs.mkdirp",f)}o.rememberLastDir&&(o.lastDownloadDirectory=f)}for(ne.updateRunning(e.id,1);n.size>=o.downloadControlledMax;)await new Promise(x=>setTimeout(x,2e3));n.set(e.id,{}),ne.update(e.id,{operation:"downloading",opStartDate:Date.now()}),ne.updateProgress(e.id,1);let h=0,y=0,T=Date.now(),w=(x,O)=>{let D=parseFloat(O.total_size),N=Date.now(),B=(N-T)/1e3,W=~~((D-y)/B);if(W>0&&(ne.update(e.id,{raw_bitrate:W}),T=N,y=D),x<0&&(x=0),h>0){let V=Math.floor(100*x/h);V>100&&(V=1/0),ne.updateProgress(e.id,V)}},S=x=>n.set(e.id,{ffmpeg_pid:x});if(c=="hls"){let x=e,O=x.mediaManifest??x.videoMediaManifest??x.audioMediaManifest,D=await be.info(O,!0,e.headers);h=parseFloat(D.format?.duration);let N={filePath:A,qr_code_needed:g,headers:e.headers,on_progress:w,on_start:S};i?await be.sideDownload(null,x.audioMediaManifest??x.mediaManifest,N):x.mediaManifest?await be.sideDownload(x.mediaManifest,null,N):await be.sideDownload(x.videoMediaManifest,x.audioMediaManifest,N)}if(c=="mpd"){let x=e,O=await be.info(x.mpd_url,!0,e.headers);h=parseFloat(O.format?.duration);let D={filePath:A,qr_code_needed:g,headers:x.headers,on_progress:w,on_start:S};i?await be.sideDownloadMPD(x.mpd_url,null,x.mpd_audio_id,D):await be.sideDownloadMPD(x.mpd_url,x.mpd_video_id,x.mpd_audio_id,D)}if(c=="file_coapp"){if(h==0){let O=await be.info(e.url,!0,e.headers);h=parseFloat(O.format?.duration)}let x={filePath:A,qr_code_needed:g,headers:e.headers,on_progress:w,on_start:S};i?await be.sideDownload(null,e.url,x):await be.sideDownload(e.url,null,x)}if(c=="youtube_format"){if(!e.baseJs)throw new Error("baseJs expected");let x,O;if(e.videoUrl||e.url){let W=e.videoUrl??e.url;O=new URL(W)}else{console.warn("unconsistent hit");return}e.audioUrl&&(x=new URL(e.audioUrl));let D=O.searchParams.get("n"),N;D&&(N=await Ee.call("vm.run",`((a) => {${e.baseJs}})('${D}')`),O.searchParams.set("n",N)),x&&x.searchParams.set("n",N);let B=await be.info(O.href,!0,e.headers);h=parseFloat(B.format?.duration);let q={filePath:A,qr_code_needed:g,headers:e.headers,on_progress:w,on_start:S};x?await be.sideDownload(O.href,x.href,q):await be.sideDownload(O.href,null,q)}if(a){let x=(N,B)=>{N<0&&(N=0),ne.update(e.id,{raw_bitrate:1024*(parseFloat(B.bitrate)??0)}),h>0&&ne.updateProgress(e.id,Math.floor(100*N/h))},O=N=>n.set(e.id,{ffmpeg_pid:N});ne.update(e.id,{operation:"converting",opStartDate:Date.now()});let D=await be.convert2(A,r,x,O);if(!o.converterKeepTmpFiles)try{await Ee.call("fs.unlink",A),A=D}catch{}}return g&&!o.qrMessageNotAgain&&!e.bulk&&G.ui.open("explainqr#"+encodeURIComponent(e.id),{type:o.alertDialogType,url:"content/explain-qr.html"}),ne.update(e.id,{localFilePath:A}),ne.update(e.id,{localDirectory:f}),await Rn("last_advanced_download",s),A}async function Zr(e,t,r,i,n){let o=await G.prefs,a;try{if(a=await _T(e,t,r,i,n),a&&(await yT.newDownload(),o.notifyReady)){let s=G._("file_ready",a=="inbrowser"?e.title:a);e.isPrivate&&o.noPrivateNotification||zi.notifications.create(e.id,{type:"basic",title:G._("vdh_notification"),iconUrl:zi.runtime.getURL("content/images/icon-36.png"),message:s})}}catch(s){console.error(s),Dh(s)}finally{n.delete(e.id),ne.updateRunning(e.id,-1),ne.updateProgress(e.id,null),ne.update(e.id,{operation:null})}return a}var Dh,G,Mh,mT,ia,ne,Ee,Wt,Rh,gT,zi,hT,be,yT,vT,bT,AT,Ih=I(()=>{"use strict";Dn();({error:Dh}=(Gn(),P(Wn))),G=J(),Mh=(fh(),P(dh)),mT=(gh(),P(mh)),ia=er().buildOptions,ne=(Yi(),P(Ji)),Ee=(Ht(),P(Vt)),Wt=(Hi(),P(Vi)),Rh=(fe(),P(de)),gT=(Yr(),P(Jr)),zi=G.browser,hT=($r(),P(Xr)),be=(Qi(),P($i)),yT=Ph(),vT="2.0.9",bT="2.0.13",AT=()=>Wt.alert({title:G._("download_method"),text:[G._("download_modes1"),G._("download_modes2")],height:350,buttons:[{text:G._("download_with_browser"),className:"btn-primary",close:!0,trigger:{mode:"browser"}},{text:G._("download_with_coapp"),className:"btn-success",close:!0,trigger:{mode:"coapp"}}],notAgain:G._("download_method_not_again")})});var Gi={};Z(Gi,{availableActions:()=>kh,describeAll:()=>NT,execute:()=>Bh,execute_default:()=>IT});async function kh(e){let t=en.getHit(e);if(!t)return[];let r=["details","copyurl"],i=t.operation=="downloading",n=t.operation=="converting",o=!!t.localFilePath,a=!!t.core_media?.av.audio,s=t.core_media?.builder=="YoutubeBulk",u=[],l="";return Xe.has(t.id)?(l="abort",u=["abort",...r]):o?(l=(await k.prefs)["default-action-1"],Ge.isDegradedVersion()?u=["deletehit",...r]:u=["openlocalfile","openlocalcontainer","deletehit",...r]):!n&&!i?(l=(await k.prefs)["default-action-0"],u=["quickdownload","download"],(a||s)&&(u=[...u,"quickdownloadaudio","downloadaudio"]),u=[...u,"downloadconvert","blacklist","deletehit",...r]):(l="copyurl",u=r),u.sort((p,c)=>p==c?0:p==l?-1:c==l?1:0)}function wT(e){k.ui.open("details#"+encodeURIComponent(e.id),{type:"tab",url:"content/details.html"})}async function xT(e){let t;if(e.core_media?.builder=="Hls"||e.core_media?.builder=="NakedHls"){let r=e;t=r.videoMediaManifest??r.audioMediaManifest??r.mediaManifest??r.masterManifest}else e.core_media?.builder=="MPDParser"?t=e.mpd_url:e.core_media?.builder=="HTTPMedia"&&(t=e.url);if(t){try{_l.call("main","copyToClipboard",t)}catch{}try{await navigator.clipboard.writeText(t)}catch{}try{await na.scripting.executeScript({target:{tabId:e.tabId},func:r=>navigator.clipboard.writeText(r),args:[t]})}catch{}}}async function ET(e){en.dispatch("hit.delete",e.id)}async function TT(e){"localFilePath"in e&&await Zi.open(e.localFilePath)}async function ST(e){"localDirectory"in e&&await Zi.open(e.localDirectory)}async function OT(e){let t=Xe.get(e.id);if(!t)throw new Error("Attempt to abord non-downloading hit");t.inbrowser&&na.downloads.cancel(e.id),t.ffmpeg_pid&&await Ge.call("abortConvert",t.ffmpeg_pid)}async function PT(e){let t=await k.prefs,r="dlconv#"+e.id;await k.rpc.call("main","embed",na.runtime.getURL("content/dlconv-embed.html?panel="+r));let{outputConfigId:i}=await k.wait(r);return t.dlconvLastOutput=i,await Zr(e,!0,i,!1,Xe)}async function MT(e){let t="content/blacklist-embed.html?panel=blacklist#"+encodeURIComponent(e.id);await _l.call("main","embed",na.runtime.getURL(t))}async function RT(){{let{status:s,info:u}=await Ge.check();if(!s){ei.alert({title:k._("coapp_required"),text:k._("coapp_required_text"),buttons:[{text:k._("coapp_install"),className:"btn-success",rpcMethod:"installCoApp"}]});return}let l=u.version;if(!Nh.isMinimumVersion(l,Al)){try{await Ge.call("quit")}catch{}await new Promise(g=>setTimeout(g,2e3));let{status:p,info:c}=await Ge.check();if(!p||!Nh.isMinimumVersion(c.version,Al)){Ge.call("quit"),ei.alert({title:k._("coapp_outofdate"),text:k._("coapp_outofdate_text",[c.version,Al]),buttons:[{text:k._("coapp_update"),className:"btn-success",rpcMethod:"installCoApp"}]});return}}}{let{status:s}=await qh.checkLicense();if(!(s=="accepted"||s=="unneeded")){ei.alert({title:k._("converter_needs_reg"),buttons:[{text:k._("get_conversion_license"),className:"btn-success",rpcMethod:"goto",rpcArgs:["https://www.downloadhelper.net/convert"]}]});return}}k.ui.close("main");let e,t,r,i;{let s=await Ge.call("filepicker","pick_file","~/dwhelper","Video file"),u=s.split(`
`);e=u[0];let l=u[2];if(!e)return;let p=l.split("."),c=p.pop(),g=p.join(".")+"-combined."+c;if(s=await Ge.call("filepicker","pick_file","~/dwhelper","Audio file"),u=s.split(`
`),t=u[0],!t||(s=await Ge.call("filepicker","save_file","~/dwhelper","Save as\u2026",g),u=s.split(`
`),r=u[0],i=u[1],!r||!i))return}let n={id:r,group:r,operation:"converting",status:"inactive",opStartDate:Date.now(),descrPrefix:"merge",title:r};en.dispatch("hit.new",n);let o=(s,u)=>{s<0&&(s=0);try{Te.update(n.id,{raw_bitrate:1024*parseFloat(u.bitrate)})}catch{}},a=s=>Xe.set(n.id,{ffmpeg_pid:s});try{Te.updateRunning(n.id,1),Te.update(n.id,{localFilePath:r}),Te.update(n.id,{localDirectory:i}),await Zi.sideDownload(e,t,{filePath:r,merge:!0,on_progress:o,on_start:a})}catch(s){console.error(s),Ch(s)}finally{Xe.delete(n.id),Te.updateRunning(n.id,-1),Te.update(n.id,{operation:null})}}async function DT(){{let{status:o}=await Ge.check();if(!o){ei.alert({title:k._("coapp_required"),text:k._("coapp_required_text"),buttons:[{text:k._("coapp_install"),className:"btn-success",rpcMethod:"installCoApp"}]});return}}{let{status:o}=await qh.checkLicense();if(!(o=="accepted"||o=="unneeded")){ei.alert({title:k._("converter_needs_reg"),buttons:[{text:k._("get_conversion_license"),className:"btn-success",rpcMethod:"goto",rpcArgs:["https://www.downloadhelper.net/convert"]}]});return}}k.ui.close("main");let e=await k.prefs,t=await ei.selectConvertFiles(e.lastDownloadDirectory||"dwhelper");if(!t)return;let r=t.selected,i=t.outputConfig,n=t.directory;e.dlconvLastOutput=i;for(let o of r){o=await Ge.call("path.homeJoin",n,o);let a=await Zi.info(o,!0),s=parseFloat(a.format?.duration),u={id:o,group:o,operation:"converting",status:"inactive",opStartDate:Date.now(),descrPrefix:"local convert",title:o};en.dispatch("hit.new",u);let l=(c,g)=>{c<0&&(c=0);try{Te.update(u.id,{raw_bitrate:1024*parseFloat(g.bitrate)})}catch{}s>0&&Te.updateProgress(u.id,Math.floor(100*c/s))},p=c=>Xe.set(u.id,{ffmpeg_pid:c});try{Te.updateRunning(u.id,1),Te.update(u.id,{localFilePath:o}),Te.update(u.id,{localDirectory:n}),o=await Zi.convert2(o,i,l,p)}finally{Xe.delete(u.id),Te.updateRunning(u.id,-1),Te.update(u.id,{operation:null})}}}function Bh(e,t){let r=en.getHit(t),i=!!r.running,n=!!r.localFilePath,o=!i&&!n,a=!0;try{if(e=="details"&&wT(r),e=="copyurl")xT(r);else{if(!i&&e=="deletehit")return ET(r),a;if(o){if(e=="download"&&Zr(r,!1,null,!1,Xe),e=="quickdownload"&&Zr(r,!0,null,!1,Xe),e=="downloadaudio"&&Zr(r,!1,null,!0,Xe),e=="quickdownloadaudio"&&Zr(r,!0,null,!0,Xe),e=="downloadconvert")return PT(r),a;if(e=="blacklist")return MT(r),a}else{if(i&&e=="abort")return OT(r),a;n&&(e=="openlocalfile"&&TT(r),e=="openlocalcontainer"&&ST(r))}}}catch(s){return Ch(s),a}return!a}async function IT(e){let t=await kh(e);return t.length>0?Bh(t[0],e):!1}function NT(){return{abort:{name:"abort",title:k._("action_abort_title"),description:k._("action_abort_description"),icon:"images/icon-action-abort-64.png",icon18:"images/icon-action-abort-64.png",catPriority:2},download:{name:"download",title:k._("action_download_title"),description:k._("action_download_description"),icon:"images/icon-action-download-64.png",icon18:"images/icon-action-download-64.png",catPriority:0},quickdownload:{name:"quickdownload",title:k._("action_quickdownload_title"),description:k._("action_quickdownload_description"),icon:"images/icon-action-quick-download2-64.png",icon18:"images/icon-action-quick-download2-64.png",catPriority:0},downloadaudio:{name:"downloadaudio",title:k._("action_downloadaudio_title"),description:k._("action_downloadaudio_description"),icon:"images/icon-action-download-only-sound-64.png",icon18:"images/icon-action-download-only-sound-64.png",catPriority:0},quickdownloadaudio:{name:"quickdownloadaudio",title:k._("action_quickdownloadaudio_title"),description:k._("action_quickdownloadaudio_description"),icon:"images/icon-action-quick-download-only-sound-64.png",icon18:"images/icon-action-quick-download-only-sound-64.png",catPriority:0},downloadconvert:{name:"downloadconvert",title:k._("action_downloadconvert_title"),description:k._("action_downloadconvert_description"),icon:"images/icon-action-download-convert-64.png",icon18:"images/icon-action-download-convert-64.png",catPriority:0},details:{name:"details",title:k._("action_details_title"),description:k._("action_details_description"),icon:"images/icon-action-details-64.png",icon18:"images/icon-action-details-64.png",catPriority:0},copyurl:{name:"copyurl",title:k._("action_copyurl_title"),description:k._("action_copyurl_description"),icon:"images/icon-action-copy-link-64.png",icon18:"images/icon-action-copy-link-64.png",catPriority:0},deletehit:{name:"deletehit",title:k._("action_deletehit_title"),description:k._("action_deletehit_description"),icon:"images/icon-action-delete-64.png",icon18:"images/icon-action-delete-64.png",catPriority:0},pin:{name:"pin",title:k._("action_pin_title"),description:k._("action_pin_description"),icon:"images/icon-action-pin-64.png",icon18:"images/icon-action-pin-64.png",catPriority:0},blacklist:{name:"blacklist",title:k._("action_blacklist_title"),description:k._("action_blacklist_description"),icon:"images/icon-action-blacklist-64.png",icon18:"images/icon-action-blacklist-64.png",catPriority:0},openlocalfile:{name:"openlocalfile",title:k._("action_openlocalfile_title"),description:k._("action_openlocalfile_description"),icon:"images/icon-action-play-64.png",icon18:"images/icon-action-play-64.png",catPriority:1},openlocalcontainer:{name:"openlocalcontainer",title:k._("action_openlocalcontainer_title"),description:k._("action_openlocalcontainer_description"),icon:"images/icon-action-open-dir-64.png",icon18:"images/icon-action-open-dir-64.png",catPriority:1}}}var Ch,Ge,k,_l,en,Zi,ei,qh,na,Te,Nh,Xe,Al,Xi=I(()=>{"use strict";Ih();({error:Ch}=(Gn(),P(Wn))),Ge=(Ht(),P(Vt)),k=J(),_l=Mt(),en=(Ce(),P(Ne)),Zi=(Qi(),P($i)),ei=(Hi(),P(Vi)),qh=(Yr(),P(Jr)),na=k.browser,Te=(Yi(),P(Ji)),Nh=(fe(),P(de)),Xe=new Map;Al="2.0.17";_l.listen({convertLocal:DT,mergeLocal:RT})});var Ji={};Z(Ji,{clearHits:()=>Vh,create:()=>jT,progressReducer:()=>VT,reducer:()=>XT,setHitOperation:()=>GT,update:()=>Fh,updateOriginal:()=>UT,updateProgress:()=>WT,updateRunning:()=>LT});function VT(e={},t){let r;switch(t.type){case"hit.progress":r=e[t.payload.id],r!==t.payload.progress&&(e=Object.assign({},e,{[t.payload.id]:t.payload.progress}));break;case"hit.clear-progress":r=e[t.payload],typeof r<"u"&&(e=Object.assign({},e),delete e[t.payload]);break}return e}function HT(e){let t=e.status,{url:r,urls:i}=BT.current();return e.status=="running"?"running":(e.status=="active"&&e.topUrl!=r?e.topUrl in i?t="inactive":t="orphan":e.status=="inactive"&&!(e.topUrl in i)?t="orphan":(e.status=="inactive"||e.status=="orphan")&&e.topUrl==r&&(t="active"),t=="orphan"&&e.pinned&&(t="pinned"),t)}function jT(e){it.dispatch("hit.new",e)}function Fh(e,t={}){it.dispatch("hit.update",{id:e,changes:t})}function LT(e,t){it.dispatch("hit.updateRunning",{id:e,runningDelta:t})}function UT(e,t={}){it.dispatch("hit.updateOriginal",{id:e,changes:t})}function WT(e,t){t===null?it.dispatch("hit.clear-progress",e):it.dispatch("hit.progress",{id:e,progress:t})}function GT(e,t){let r=it.getHit(e);r&&r.operation!==t&&Fh(e,{operation:t})}function Vh(e){let t=[],{flat:r}=it.getHits();for(let i of r.values())(e=="all"&&i.status!="running"&&i.status!="pinned"||e=="pinned"&&i.status=="pinned"||e=="inactive"&&i.status=="inactive"||e=="orphans"&&i.status=="orphan")&&t.push(i.id);it.dispatch("hit.delete",t)}function XT(e,t){FT&&console.log("bg:hits:reducer",t.type),e||(e={flat:new Map});let r=e.flat;function i(n,o={}){!n.referrer&&o.pageUrl&&(o.referrer=o.pageUrl);let a=o.core_media??n.core_media;n.core_media&&o.core_media&&(a=ld(n.core_media,o.core_media));let s=n.status!="orphan";if(n={...n,...o,core_media:a},n={...n,status:HT(n)},n.status=="orphan"&&s){let u=Date.now(),l=CT.unsafe_prefs.orphanExpiration*1e3;n.orphanT0=u,n.orphanT=u+l,setTimeout(()=>it.dispatch("hit.orphanTimeout",n.id),l+100)}return n}switch(t.type){case"hit.new":{if(r.size>1e4)return console.error("Hit DB is reaching limit. Something is wrong. Abording."),{flat:r};let n=t.payload;n.created=new Date().getTime();let o=r.get(n.id)??{};if(o.status=="running")return{flat:r};o.status="active";let a=i(o,n);a.core_media||console.trace("Missing core_media"),r.set(a.id,a)}break;case"hits.urlUpdated":for(let n of r.keys())r.set(n,i(r.get(n)));break;case"hit.update":{let{id:n,changes:o}=t.payload;Array.isArray(n)||(n=[n]);for(let a of n){let s=r.get(a);if(s){let u=i(s,o);r.set(u.id,u)}else console.trace("unknown hit")}}break;case"hit.updateRunning":{let{id:n,runningDelta:o}=t.payload,a=r.get(n);if(a){let s=a.running??0,u={running:s+o};s==0&&(u.status="running"),u.running<=0&&(u.running=0,u.status="active"),r.set(n,i(a,u))}else console.trace("unknown hit")}break;case"hit.updateOriginal":{let{id:n,changes:o}=t.payload;for(let a of r.values())(n===a.id||n===a.originalId)&&r.set(a.id,i(a,o))}break;case"hit.delete":{let n=t.payload;Array.isArray(n)||(n=[n]);for(let o of n)r.delete(o)}break;case"hit.orphanTimeout":{let n=t.payload,o=r.get(n);if(o&&o.status=="orphan"&&!isNaN(o.orphanT)&&Date.now()>o.orphanT){let a=t.payload;Array.isArray(a)||(a=[a]);for(let s of a)r.delete(s)}}break;case"blacklist-changed":break;default:return!t.type.startsWith("@@redux")&&t.type!="hit.clear-progress"&&t.type!="log.new"&&t.type!="log.clear"&&t.type!="hit.progress"&&console.trace("Unexpected action:",t.type),e}return{flat:r}}var CT,qT,kT,it,BT,FT,Yi=I(()=>{"use strict";Oi();CT=J(),qT=Mt(),kT=(Xi(),P(Gi)),it=(Ce(),P(Ne)),BT=(Ft(),P(Bt)),FT=er().channel=="dev";qT.listen({actionCommand:(e,t)=>kT.execute(e,t),clearHits:Vh})});var wl=m((V5,jh)=>{"use strict";var Hh=Object.prototype.toString;jh.exports=function(t){var r=Hh.call(t),i=r==="[object Arguments]";return i||(i=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Hh.call(t.callee)==="[object Function]"),i}});var zh=m((H5,Kh)=>{"use strict";var Qh;Object.keys||(tn=Object.prototype.hasOwnProperty,xl=Object.prototype.toString,Lh=wl(),El=Object.prototype.propertyIsEnumerable,Uh=!El.call({toString:null},"toString"),Wh=El.call(function(){},"prototype"),rn=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],oa=function(e){var t=e.constructor;return t&&t.prototype===e},Gh={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Xh=function(){if(typeof window>"u")return!1;for(var e in window)try{if(!Gh["$"+e]&&tn.call(window,e)&&window[e]!==null&&typeof window[e]=="object")try{oa(window[e])}catch{return!0}}catch{return!0}return!1}(),$h=function(e){if(typeof window>"u"||!Xh)return oa(e);try{return oa(e)}catch{return!1}},Qh=function(t){var r=t!==null&&typeof t=="object",i=xl.call(t)==="[object Function]",n=Lh(t),o=r&&xl.call(t)==="[object String]",a=[];if(!r&&!i&&!n)throw new TypeError("Object.keys called on a non-object");var s=Wh&&i;if(o&&t.length>0&&!tn.call(t,0))for(var u=0;u<t.length;++u)a.push(String(u));if(n&&t.length>0)for(var l=0;l<t.length;++l)a.push(String(l));else for(var p in t)!(s&&p==="prototype")&&tn.call(t,p)&&a.push(String(p));if(Uh)for(var c=$h(t),g=0;g<rn.length;++g)!(c&&rn[g]==="constructor")&&tn.call(t,rn[g])&&a.push(rn[g]);return a});var tn,xl,Lh,El,Uh,Wh,rn,oa,Gh,Xh,$h;Kh.exports=Qh});var sa=m((j5,Zh)=>{"use strict";var $T=Array.prototype.slice,QT=wl(),Jh=Object.keys,aa=Jh?function(t){return Jh(t)}:zh(),Yh=Object.keys;aa.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(i){return QT(i)?Yh($T.call(i)):Yh(i)})}else Object.keys=aa;return Object.keys||aa};Zh.exports=aa});var nn=m((L5,ey)=>{"use strict";ey.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),i=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;t[r]=n;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==n||a.enumerable!==!0)return!1}return!0}});var ua=m((U5,ry)=>{"use strict";var ty=typeof Symbol<"u"&&Symbol,KT=nn();ry.exports=function(){return typeof ty!="function"||typeof Symbol!="function"||typeof ty("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:KT()}});var oy=m((W5,ny)=>{"use strict";var iy={foo:{}},zT=Object;ny.exports=function(){return{__proto__:iy}.foo===iy.foo&&!({__proto__:null}instanceof zT)}});var uy=m((G5,sy)=>{"use strict";var JT="Function.prototype.bind called on incompatible ",YT=Object.prototype.toString,ZT=Math.max,e2="[object Function]",ay=function(t,r){for(var i=[],n=0;n<t.length;n+=1)i[n]=t[n];for(var o=0;o<r.length;o+=1)i[o+t.length]=r[o];return i},t2=function(t,r){for(var i=[],n=r||0,o=0;n<t.length;n+=1,o+=1)i[o]=t[n];return i},r2=function(e,t){for(var r="",i=0;i<e.length;i+=1)r+=e[i],i+1<e.length&&(r+=t);return r};sy.exports=function(t){var r=this;if(typeof r!="function"||YT.apply(r)!==e2)throw new TypeError(JT+r);for(var i=t2(arguments,1),n,o=function(){if(this instanceof n){var p=r.apply(this,ay(i,arguments));return Object(p)===p?p:this}return r.apply(t,ay(i,arguments))},a=ZT(0,r.length-i.length),s=[],u=0;u<a;u++)s[u]="$"+u;if(n=Function("binder","return function ("+r2(s,",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var l=function(){};l.prototype=r.prototype,n.prototype=new l,l.prototype=null}return n}});var la=m((X5,ly)=>{"use strict";var i2=uy();ly.exports=Function.prototype.bind||i2});var Tl=m(($5,cy)=>{"use strict";var n2=Function.prototype.call,o2=Object.prototype.hasOwnProperty,a2=la();cy.exports=a2.call(n2,o2)});var Se=m((Q5,gy)=>{"use strict";var L,ni=SyntaxError,my=Function,ii=TypeError,Sl=function(e){try{return my('"use strict"; return ('+e+").constructor;")()}catch{}},Ar=Object.getOwnPropertyDescriptor;if(Ar)try{Ar({},"")}catch{Ar=null}var Ol=function(){throw new ii},s2=Ar?function(){try{return arguments.callee,Ol}catch{try{return Ar(arguments,"callee").get}catch{return Ol}}}():Ol,ti=ua()(),u2=oy()(),oe=Object.getPrototypeOf||(u2?function(e){return e.__proto__}:null),ri={},l2=typeof Uint8Array>"u"||!oe?L:oe(Uint8Array),_r={"%AggregateError%":typeof AggregateError>"u"?L:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?L:ArrayBuffer,"%ArrayIteratorPrototype%":ti&&oe?oe([][Symbol.iterator]()):L,"%AsyncFromSyncIteratorPrototype%":L,"%AsyncFunction%":ri,"%AsyncGenerator%":ri,"%AsyncGeneratorFunction%":ri,"%AsyncIteratorPrototype%":ri,"%Atomics%":typeof Atomics>"u"?L:Atomics,"%BigInt%":typeof BigInt>"u"?L:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?L:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?L:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?L:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?L:Float32Array,"%Float64Array%":typeof Float64Array>"u"?L:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?L:FinalizationRegistry,"%Function%":my,"%GeneratorFunction%":ri,"%Int8Array%":typeof Int8Array>"u"?L:Int8Array,"%Int16Array%":typeof Int16Array>"u"?L:Int16Array,"%Int32Array%":typeof Int32Array>"u"?L:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ti&&oe?oe(oe([][Symbol.iterator]())):L,"%JSON%":typeof JSON=="object"?JSON:L,"%Map%":typeof Map>"u"?L:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ti||!oe?L:oe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?L:Promise,"%Proxy%":typeof Proxy>"u"?L:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?L:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?L:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ti||!oe?L:oe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?L:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ti&&oe?oe(""[Symbol.iterator]()):L,"%Symbol%":ti?Symbol:L,"%SyntaxError%":ni,"%ThrowTypeError%":s2,"%TypedArray%":l2,"%TypeError%":ii,"%Uint8Array%":typeof Uint8Array>"u"?L:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?L:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?L:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?L:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?L:WeakMap,"%WeakRef%":typeof WeakRef>"u"?L:WeakRef,"%WeakSet%":typeof WeakSet>"u"?L:WeakSet};if(oe)try{null.error}catch(e){py=oe(oe(e)),_r["%Error.prototype%"]=py}var py,c2=function e(t){var r;if(t==="%AsyncFunction%")r=Sl("async function () {}");else if(t==="%GeneratorFunction%")r=Sl("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=Sl("async function* () {}");else if(t==="%AsyncGenerator%"){var i=e("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=e("%AsyncGenerator%");n&&oe&&(r=oe(n.prototype))}return _r[t]=r,r},dy={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},on=la(),ca=Tl(),p2=on.call(Function.call,Array.prototype.concat),d2=on.call(Function.apply,Array.prototype.splice),fy=on.call(Function.call,String.prototype.replace),pa=on.call(Function.call,String.prototype.slice),f2=on.call(Function.call,RegExp.prototype.exec),m2=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,g2=/\\(\\)?/g,h2=function(t){var r=pa(t,0,1),i=pa(t,-1);if(r==="%"&&i!=="%")throw new ni("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&r!=="%")throw new ni("invalid intrinsic syntax, expected opening `%`");var n=[];return fy(t,m2,function(o,a,s,u){n[n.length]=s?fy(u,g2,"$1"):a||o}),n},y2=function(t,r){var i=t,n;if(ca(dy,i)&&(n=dy[i],i="%"+n[0]+"%"),ca(_r,i)){var o=_r[i];if(o===ri&&(o=c2(i)),typeof o>"u"&&!r)throw new ii("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:o}}throw new ni("intrinsic "+t+" does not exist!")};gy.exports=function(t,r){if(typeof t!="string"||t.length===0)throw new ii("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new ii('"allowMissing" argument must be a boolean');if(f2(/^%?[^%]*%?$/,t)===null)throw new ni("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=h2(t),n=i.length>0?i[0]:"",o=y2("%"+n+"%",r),a=o.name,s=o.value,u=!1,l=o.alias;l&&(n=l[0],d2(i,p2([0,1],l)));for(var p=1,c=!0;p<i.length;p+=1){var g=i[p],b=pa(g,0,1),d=pa(g,-1);if((b==='"'||b==="'"||b==="`"||d==='"'||d==="'"||d==="`")&&b!==d)throw new ni("property names with quotes must have matching quotes");if((g==="constructor"||!c)&&(u=!0),n+="."+g,a="%"+n+"%",ca(_r,a))s=_r[a];else if(s!=null){if(!(g in s)){if(!r)throw new ii("base intrinsic for "+t+" exists, but the property is not available.");return}if(Ar&&p+1>=i.length){var A=Ar(s,g);c=!!A,c&&"get"in A&&!("originalValue"in A.get)?s=A.get:s=s[g]}else c=ca(s,g),s=s[g];c&&!u&&(_r[a]=s)}}return s}});var an=m((K5,hy)=>{"use strict";var v2=Se(),Pl=v2("%Object.defineProperty%",!0),Ml=function(){if(Pl)try{return Pl({},"a",{value:1}),!0}catch{return!1}return!1};Ml.hasArrayLengthDefineBug=function(){if(!Ml())return null;try{return Pl([],"length",{value:1}).length!==1}catch{return!0}};hy.exports=Ml});var fa=m((z5,yy)=>{"use strict";var b2=Se(),da=b2("%Object.getOwnPropertyDescriptor%",!0);if(da)try{da([],"length")}catch{da=null}yy.exports=da});var ma=m((J5,by)=>{"use strict";var A2=an()(),Rl=Se(),sn=A2&&Rl("%Object.defineProperty%",!0);if(sn)try{sn({},"a",{value:1})}catch{sn=!1}var _2=Rl("%SyntaxError%"),oi=Rl("%TypeError%"),vy=fa();by.exports=function(t,r,i){if(!t||typeof t!="object"&&typeof t!="function")throw new oi("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new oi("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new oi("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new oi("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new oi("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new oi("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,u=!!vy&&vy(t,r);if(sn)sn(t,r,{configurable:a===null&&u?u.configurable:!a,enumerable:n===null&&u?u.enumerable:!n,value:i,writable:o===null&&u?u.writable:!o});else if(s||!n&&!o&&!a)t[r]=i;else throw new _2("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var Gt=m((Y5,xy)=>{"use strict";var w2=sa(),x2=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",E2=Object.prototype.toString,T2=Array.prototype.concat,Ay=ma(),S2=function(e){return typeof e=="function"&&E2.call(e)==="[object Function]"},_y=an()(),O2=function(e,t,r,i){if(t in e){if(i===!0){if(e[t]===r)return}else if(!S2(i)||!i())return}_y?Ay(e,t,r,!0):Ay(e,t,r)},wy=function(e,t){var r=arguments.length>2?arguments[2]:{},i=w2(t);x2&&(i=T2.call(i,Object.getOwnPropertySymbols(t)));for(var n=0;n<i.length;n+=1)O2(e,i[n],t[i[n]],r[i[n]])};wy.supportsDescriptors=!!_y;xy.exports=wy});var My=m((Z5,Py)=>{"use strict";var Oy=Se(),Ey=ma(),P2=an()(),Ty=fa(),Sy=Oy("%TypeError%"),M2=Oy("%Math.floor%");Py.exports=function(t,r){if(typeof t!="function")throw new Sy("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||M2(r)!==r)throw new Sy("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],n=!0,o=!0;if("length"in t&&Ty){var a=Ty(t,"length");a&&!a.configurable&&(n=!1),a&&!a.writable&&(o=!1)}return(n||o||!i)&&(P2?Ey(t,"length",r,!0,!0):Ey(t,"length",r)),t}});var wr=m((eC,ga)=>{"use strict";var Dl=la(),ai=Se(),R2=My(),D2=ai("%TypeError%"),Dy=ai("%Function.prototype.apply%"),Iy=ai("%Function.prototype.call%"),Ny=ai("%Reflect.apply%",!0)||Dl.call(Iy,Dy),un=ai("%Object.defineProperty%",!0),I2=ai("%Math.max%");if(un)try{un({},"a",{value:1})}catch{un=null}ga.exports=function(t){if(typeof t!="function")throw new D2("a function is required");var r=Ny(Dl,Iy,arguments);return R2(r,1+I2(0,t.length-(arguments.length-1)),!0)};var Ry=function(){return Ny(Dl,Dy,arguments)};un?un(ga.exports,"apply",{value:Ry}):ga.exports.apply=Ry});var Oe=m((tC,ky)=>{"use strict";var Cy=Se(),qy=wr(),N2=qy(Cy("String.prototype.indexOf"));ky.exports=function(t,r){var i=Cy(t,!!r);return typeof i=="function"&&N2(t,".prototype.")>-1?qy(i):i}});var Il=m((rC,jy)=>{"use strict";var C2=sa(),Vy=nn()(),Hy=Oe(),By=Object,q2=Hy("Array.prototype.push"),Fy=Hy("Object.prototype.propertyIsEnumerable"),k2=Vy?Object.getOwnPropertySymbols:null;jy.exports=function(t,r){if(t==null)throw new TypeError("target must be an object");var i=By(t);if(arguments.length===1)return i;for(var n=1;n<arguments.length;++n){var o=By(arguments[n]),a=C2(o),s=Vy&&(Object.getOwnPropertySymbols||k2);if(s)for(var u=s(o),l=0;l<u.length;++l){var p=u[l];Fy(o,p)&&q2(a,p)}for(var c=0;c<a.length;++c){var g=a[c];if(Fy(o,g)){var b=o[g];i[g]=b}}}return i}});var Cl=m((iC,Ly)=>{"use strict";var Nl=Il(),B2=function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),r={},i=0;i<t.length;++i)r[t[i]]=t[i];var n=Object.assign({},r),o="";for(var a in n)o+=a;return e!==o},F2=function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch{return e[1]==="y"}return!1};Ly.exports=function(){return!Object.assign||B2()||F2()?Nl:Object.assign}});var Wy=m((nC,Uy)=>{"use strict";var V2=Gt(),H2=Cl();Uy.exports=function(){var t=H2();return V2(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t}});var Qy=m((oC,$y)=>{"use strict";var j2=Gt(),L2=wr(),U2=Il(),Gy=Cl(),W2=Wy(),G2=L2.apply(Gy()),Xy=function(t,r){return G2(Object,arguments)};j2(Xy,{getPolyfill:Gy,implementation:U2,shim:W2});$y.exports=Xy});var zy=m((aC,Ky)=>{"use strict";var cn=function(){return typeof function(){}.name=="string"},ln=Object.getOwnPropertyDescriptor;if(ln)try{ln([],"length")}catch{ln=null}cn.functionsHaveConfigurableNames=function(){if(!cn()||!ln)return!1;var t=ln(function(){},"name");return!!t&&!!t.configurable};var X2=Function.prototype.bind;cn.boundFunctionsHaveNames=function(){return cn()&&typeof X2=="function"&&function(){}.bind().name!==""};Ky.exports=cn});var Zy=m((sC,Yy)=>{"use strict";var Jy=ma(),$2=an()(),Q2=zy().functionsHaveConfigurableNames(),K2=TypeError;Yy.exports=function(t,r){if(typeof t!="function")throw new K2("`fn` is not a function");var i=arguments.length>2&&!!arguments[2];return(!i||Q2)&&($2?Jy(t,"name",r,!0,!0):Jy(t,"name",r)),t}});var ql=m((uC,ev)=>{"use strict";var z2=Zy(),J2=Object,Y2=TypeError;ev.exports=z2(function(){if(this!=null&&this!==J2(this))throw new Y2("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t},"get flags",!0)});var kl=m((lC,tv)=>{"use strict";var Z2=ql(),e4=Gt().supportsDescriptors,t4=Object.getOwnPropertyDescriptor;tv.exports=function(){if(e4&&/a/mig.flags==="gim"){var t=t4(RegExp.prototype,"flags");if(t&&typeof t.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var r="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){r+="d"}}),Object.defineProperty(i,"sticky",{get:function(){r+="y"}}),r==="dy")return t.get}}return Z2}});var nv=m((cC,iv)=>{"use strict";var r4=Gt().supportsDescriptors,i4=kl(),n4=Object.getOwnPropertyDescriptor,o4=Object.defineProperty,a4=TypeError,rv=Object.getPrototypeOf,s4=/a/;iv.exports=function(){if(!r4||!rv)throw new a4("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=i4(),r=rv(s4),i=n4(r,"flags");return(!i||i.get!==t)&&o4(r,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var uv=m((pC,sv)=>{"use strict";var u4=Gt(),l4=wr(),c4=ql(),ov=kl(),p4=nv(),av=l4(ov());u4(av,{getPolyfill:ov,implementation:c4,shim:p4});sv.exports=av});var Xt=m((dC,lv)=>{"use strict";var d4=nn();lv.exports=function(){return d4()&&!!Symbol.toStringTag}});var Fl=m((fC,pv)=>{"use strict";var f4=Xt()(),m4=Oe(),Bl=m4("Object.prototype.toString"),ha=function(t){return f4&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:Bl(t)==="[object Arguments]"},cv=function(t){return ha(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Bl(t)!=="[object Array]"&&Bl(t.callee)==="[object Function]"},g4=function(){return ha(arguments)}();ha.isLegacyArguments=cv;pv.exports=g4?ha:cv});var dv=m(()=>{});var Iv=m((hC,Dv)=>{var Ql=typeof Map=="function"&&Map.prototype,Vl=Object.getOwnPropertyDescriptor&&Ql?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,va=Ql&&Vl&&typeof Vl.get=="function"?Vl.get:null,fv=Ql&&Map.prototype.forEach,Kl=typeof Set=="function"&&Set.prototype,Hl=Object.getOwnPropertyDescriptor&&Kl?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ba=Kl&&Hl&&typeof Hl.get=="function"?Hl.get:null,mv=Kl&&Set.prototype.forEach,h4=typeof WeakMap=="function"&&WeakMap.prototype,dn=h4?WeakMap.prototype.has:null,y4=typeof WeakSet=="function"&&WeakSet.prototype,fn=y4?WeakSet.prototype.has:null,v4=typeof WeakRef=="function"&&WeakRef.prototype,gv=v4?WeakRef.prototype.deref:null,b4=Boolean.prototype.valueOf,A4=Object.prototype.toString,_4=Function.prototype.toString,w4=String.prototype.match,zl=String.prototype.slice,Qt=String.prototype.replace,x4=String.prototype.toUpperCase,hv=String.prototype.toLowerCase,Tv=RegExp.prototype.test,yv=Array.prototype.concat,nt=Array.prototype.join,E4=Array.prototype.slice,vv=Math.floor,Ul=typeof BigInt=="function"?BigInt.prototype.valueOf:null,jl=Object.getOwnPropertySymbols,Wl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,si=typeof Symbol=="function"&&typeof Symbol.iterator=="object",se=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===si||!0)?Symbol.toStringTag:null,Sv=Object.prototype.propertyIsEnumerable,bv=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Av(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||Tv.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var i=e<0?-vv(-e):vv(e);if(i!==e){var n=String(i),o=zl.call(t,n.length+1);return Qt.call(n,r,"$&_")+"."+Qt.call(Qt.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Qt.call(t,r,"$&_")}var Gl=dv(),_v=Gl.custom,wv=Pv(_v)?_v:null;Dv.exports=function e(t,r,i,n){var o=r||{};if($t(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if($t(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=$t(o,"customInspect")?o.customInspect:!0;if(typeof a!="boolean"&&a!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if($t(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if($t(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var s=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Rv(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var u=String(t);return s?Av(t,u):u}if(typeof t=="bigint"){var l=String(t)+"n";return s?Av(t,l):l}var p=typeof o.depth>"u"?5:o.depth;if(typeof i>"u"&&(i=0),i>=p&&p>0&&typeof t=="object")return Xl(t)?"[Array]":"[Object]";var c=L4(o,i);if(typeof n>"u")n=[];else if(Mv(n,t)>=0)return"[Circular]";function g(V,ee,Pe){if(ee&&(n=E4.call(n),n.push(ee)),Pe){var ae={depth:o.depth};return $t(o,"quoteStyle")&&(ae.quoteStyle=o.quoteStyle),e(V,ae,i+1,n)}return e(V,o,i+1,n)}if(typeof t=="function"&&!xv(t)){var b=N4(t),d=ya(t,g);return"[Function"+(b?": "+b:" (anonymous)")+"]"+(d.length>0?" { "+nt.call(d,", ")+" }":"")}if(Pv(t)){var A=si?Qt.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Wl.call(t);return typeof t=="object"&&!si?pn(A):A}if(V4(t)){for(var f="<"+hv.call(String(t.nodeName)),h=t.attributes||[],y=0;y<h.length;y++)f+=" "+h[y].name+"="+Ov(T4(h[y].value),"double",o);return f+=">",t.childNodes&&t.childNodes.length&&(f+="..."),f+="</"+hv.call(String(t.nodeName))+">",f}if(Xl(t)){if(t.length===0)return"[]";var T=ya(t,g);return c&&!j4(T)?"["+$l(T,c)+"]":"[ "+nt.call(T,", ")+" ]"}if(O4(t)){var w=ya(t,g);return!("cause"in Error.prototype)&&"cause"in t&&!Sv.call(t,"cause")?"{ ["+String(t)+"] "+nt.call(yv.call("[cause]: "+g(t.cause),w),", ")+" }":w.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+nt.call(w,", ")+" }"}if(typeof t=="object"&&a){if(wv&&typeof t[wv]=="function"&&Gl)return Gl(t,{depth:p-i});if(a!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(C4(t)){var S=[];return fv&&fv.call(t,function(V,ee){S.push(g(ee,t,!0)+" => "+g(V,t))}),Ev("Map",va.call(t),S,c)}if(B4(t)){var x=[];return mv&&mv.call(t,function(V){x.push(g(V,t))}),Ev("Set",ba.call(t),x,c)}if(q4(t))return Ll("WeakMap");if(F4(t))return Ll("WeakSet");if(k4(t))return Ll("WeakRef");if(M4(t))return pn(g(Number(t)));if(D4(t))return pn(g(Ul.call(t)));if(R4(t))return pn(b4.call(t));if(P4(t))return pn(g(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===global)return"{ [object globalThis] }";if(!S4(t)&&!xv(t)){var O=ya(t,g),D=bv?bv(t)===Object.prototype:t instanceof Object||t.constructor===Object,N=t instanceof Object?"":"null prototype",B=!D&&se&&Object(t)===t&&se in t?zl.call(Kt(t),8,-1):N?"Object":"",q=D||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",W=q+(B||N?"["+nt.call(yv.call([],B||[],N||[]),": ")+"] ":"");return O.length===0?W+"{}":c?W+"{"+$l(O,c)+"}":W+"{ "+nt.call(O,", ")+" }"}return String(t)};function Ov(e,t,r){var i=(r.quoteStyle||t)==="double"?'"':"'";return i+e+i}function T4(e){return Qt.call(String(e),/"/g,"&quot;")}function Xl(e){return Kt(e)==="[object Array]"&&(!se||!(typeof e=="object"&&se in e))}function S4(e){return Kt(e)==="[object Date]"&&(!se||!(typeof e=="object"&&se in e))}function xv(e){return Kt(e)==="[object RegExp]"&&(!se||!(typeof e=="object"&&se in e))}function O4(e){return Kt(e)==="[object Error]"&&(!se||!(typeof e=="object"&&se in e))}function P4(e){return Kt(e)==="[object String]"&&(!se||!(typeof e=="object"&&se in e))}function M4(e){return Kt(e)==="[object Number]"&&(!se||!(typeof e=="object"&&se in e))}function R4(e){return Kt(e)==="[object Boolean]"&&(!se||!(typeof e=="object"&&se in e))}function Pv(e){if(si)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!Wl)return!1;try{return Wl.call(e),!0}catch{}return!1}function D4(e){if(!e||typeof e!="object"||!Ul)return!1;try{return Ul.call(e),!0}catch{}return!1}var I4=Object.prototype.hasOwnProperty||function(e){return e in this};function $t(e,t){return I4.call(e,t)}function Kt(e){return A4.call(e)}function N4(e){if(e.name)return e.name;var t=w4.call(_4.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function Mv(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}function C4(e){if(!va||!e||typeof e!="object")return!1;try{va.call(e);try{ba.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function q4(e){if(!dn||!e||typeof e!="object")return!1;try{dn.call(e,dn);try{fn.call(e,fn)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function k4(e){if(!gv||!e||typeof e!="object")return!1;try{return gv.call(e),!0}catch{}return!1}function B4(e){if(!ba||!e||typeof e!="object")return!1;try{ba.call(e);try{va.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function F4(e){if(!fn||!e||typeof e!="object")return!1;try{fn.call(e,fn);try{dn.call(e,dn)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function V4(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function Rv(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,i="... "+r+" more character"+(r>1?"s":"");return Rv(zl.call(e,0,t.maxStringLength),t)+i}var n=Qt.call(Qt.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,H4);return Ov(n,"single",t)}function H4(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+x4.call(t.toString(16))}function pn(e){return"Object("+e+")"}function Ll(e){return e+" { ? }"}function Ev(e,t,r,i){var n=i?$l(r,i):nt.call(r,", ");return e+" ("+t+") {"+n+"}"}function j4(e){for(var t=0;t<e.length;t++)if(Mv(e[t],`
`)>=0)return!1;return!0}function L4(e,t){var r;if(e.indent==="	")r="	";else if(typeof e.indent=="number"&&e.indent>0)r=nt.call(Array(e.indent+1)," ");else return null;return{base:r,prev:nt.call(Array(t+1),r)}}function $l(e,t){if(e.length===0)return"";var r=`
`+t.prev+t.base;return r+nt.call(e,","+r)+`
`+t.prev}function ya(e,t){var r=Xl(e),i=[];if(r){i.length=e.length;for(var n=0;n<e.length;n++)i[n]=$t(e,n)?t(e[n],e):""}var o=typeof jl=="function"?jl(e):[],a;if(si){a={};for(var s=0;s<o.length;s++)a["$"+o[s]]=o[s]}for(var u in e)$t(e,u)&&(r&&String(Number(u))===u&&u<e.length||si&&a["$"+u]instanceof Symbol||(Tv.call(/[^\w$]/,u)?i.push(t(u,e)+": "+t(e[u],e)):i.push(u+": "+t(e[u],e))));if(typeof jl=="function")for(var l=0;l<o.length;l++)Sv.call(e,o[l])&&i.push("["+t(o[l])+"]: "+t(e[o[l]],e));return i}});var Zl=m((yC,Nv)=>{"use strict";var Jl=Se(),ui=Oe(),U4=Iv(),W4=Jl("%TypeError%"),Aa=Jl("%WeakMap%",!0),_a=Jl("%Map%",!0),G4=ui("WeakMap.prototype.get",!0),X4=ui("WeakMap.prototype.set",!0),$4=ui("WeakMap.prototype.has",!0),Q4=ui("Map.prototype.get",!0),K4=ui("Map.prototype.set",!0),z4=ui("Map.prototype.has",!0),Yl=function(e,t){for(var r=e,i;(i=r.next)!==null;r=i)if(i.key===t)return r.next=i.next,i.next=e.next,e.next=i,i},J4=function(e,t){var r=Yl(e,t);return r&&r.value},Y4=function(e,t,r){var i=Yl(e,t);i?i.value=r:e.next={key:t,next:e.next,value:r}},Z4=function(e,t){return!!Yl(e,t)};Nv.exports=function(){var t,r,i,n={assert:function(o){if(!n.has(o))throw new W4("Side channel does not contain "+U4(o))},get:function(o){if(Aa&&o&&(typeof o=="object"||typeof o=="function")){if(t)return G4(t,o)}else if(_a){if(r)return Q4(r,o)}else if(i)return J4(i,o)},has:function(o){if(Aa&&o&&(typeof o=="object"||typeof o=="function")){if(t)return $4(t,o)}else if(_a){if(r)return z4(r,o)}else if(i)return Z4(i,o);return!1},set:function(o,a){Aa&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new Aa),X4(t,o,a)):_a?(r||(r=new _a),K4(r,o,a)):(i||(i={key:{},next:null}),Y4(i,o,a))}};return n}});var qv=m((vC,Cv)=>{"use strict";var eS=Se(),tS=Tl(),mn=Zl()(),Tt=eS("%TypeError%"),ec={assert:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new Tt("`O` is not an object");if(typeof t!="string")throw new Tt("`slot` must be a string");if(mn.assert(e),!ec.has(e,t))throw new Tt("`"+t+"` is not present on `O`")},get:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new Tt("`O` is not an object");if(typeof t!="string")throw new Tt("`slot` must be a string");var r=mn.get(e);return r&&r["$"+t]},has:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new Tt("`O` is not an object");if(typeof t!="string")throw new Tt("`slot` must be a string");var r=mn.get(e);return!!r&&tS(r,"$"+t)},set:function(e,t,r){if(!e||typeof e!="object"&&typeof e!="function")throw new Tt("`O` is not an object");if(typeof t!="string")throw new Tt("`slot` must be a string");var i=mn.get(e);i||(i={},mn.set(e,i)),i["$"+t]=r}};Object.freeze&&Object.freeze(ec);Cv.exports=ec});var Fv=m((bC,Bv)=>{"use strict";var gn=qv(),rS=SyntaxError,kv=typeof StopIteration=="object"?StopIteration:null;Bv.exports=function(t){if(!kv)throw new rS("this environment lacks StopIteration");gn.set(t,"[[Done]]",!1);var r={next:function(){var n=gn.get(this,"[[Iterator]]"),o=gn.get(n,"[[Done]]");try{return{done:o,value:o?void 0:n.next()}}catch(a){if(gn.set(n,"[[Done]]",!0),a!==kv)throw a;return{done:!0,value:void 0}}}};return gn.set(r,"[[Iterator]]",t),r}});var tc=m((AC,Vv)=>{var iS={}.toString;Vv.exports=Array.isArray||function(e){return iS.call(e)=="[object Array]"}});var rc=m((_C,Hv)=>{"use strict";var nS=String.prototype.valueOf,oS=function(t){try{return nS.call(t),!0}catch{return!1}},aS=Object.prototype.toString,sS="[object String]",uS=Xt()();Hv.exports=function(t){return typeof t=="string"?!0:typeof t!="object"?!1:uS?oS(t):aS.call(t)===sS}});var nc=m((wC,Uv)=>{"use strict";var ic=typeof Map=="function"&&Map.prototype?Map:null,lS=typeof Set=="function"&&Set.prototype?Set:null,wa;ic||(wa=function(t){return!1});var Lv=ic?Map.prototype.has:null,jv=lS?Set.prototype.has:null;!wa&&!Lv&&(wa=function(t){return!1});Uv.exports=wa||function(t){if(!t||typeof t!="object")return!1;try{if(Lv.call(t),jv)try{jv.call(t)}catch{return!0}return t instanceof ic}catch{}return!1}});var ac=m((xC,Xv)=>{"use strict";var cS=typeof Map=="function"&&Map.prototype?Map:null,oc=typeof Set=="function"&&Set.prototype?Set:null,xa;oc||(xa=function(t){return!1});var Wv=cS?Map.prototype.has:null,Gv=oc?Set.prototype.has:null;!xa&&!Gv&&(xa=function(t){return!1});Xv.exports=xa||function(t){if(!t||typeof t!="object")return!1;try{if(Gv.call(t),Wv)try{Wv.call(t)}catch{return!0}return t instanceof oc}catch{}return!1}});var nb=m((EC,Sa)=>{"use strict";var $v=Fl(),Qv=Fv();ua()()||nn()()?(Ea=Symbol.iterator,Sa.exports=function(t){if(t!=null&&typeof t[Ea]<"u")return t[Ea]();if($v(t))return Array.prototype[Ea].call(t)}):(Kv=tc(),zv=rc(),sc=Se(),Jv=sc("%Map%",!0),Yv=sc("%Set%",!0),ke=Oe(),uc=ke("Array.prototype.push"),lc=ke("String.prototype.charCodeAt"),Zv=ke("String.prototype.slice"),eb=function(t,r){var i=t.length;if(r+1>=i)return r+1;var n=lc(t,r);if(n<55296||n>56319)return r+1;var o=lc(t,r+1);return o<56320||o>57343?r+1:r+2},Ta=function(t){var r=0;return{next:function(){var n=r>=t.length,o;return n||(o=t[r],r+=1),{done:n,value:o}}}},cc=function(t,r){if(Kv(t)||$v(t))return Ta(t);if(zv(t)){var i=0;return{next:function(){var o=eb(t,i),a=Zv(t,i,o);return i=o,{done:o>t.length,value:a}}}}if(r&&typeof t["_es6-shim iterator_"]<"u")return t["_es6-shim iterator_"]()},!Jv&&!Yv?Sa.exports=function(t){if(t!=null)return cc(t,!0)}:(tb=nc(),rb=ac(),pc=ke("Map.prototype.forEach",!0),dc=ke("Set.prototype.forEach",!0),(typeof process>"u"||!process.versions||!process.versions.node)&&(fc=ke("Map.prototype.iterator",!0),mc=ke("Set.prototype.iterator",!0)),gc=ke("Map.prototype.@@iterator",!0)||ke("Map.prototype._es6-shim iterator_",!0),hc=ke("Set.prototype.@@iterator",!0)||ke("Set.prototype._es6-shim iterator_",!0),ib=function(t){if(tb(t)){if(fc)return Qv(fc(t));if(gc)return gc(t);if(pc){var r=[];return pc(t,function(n,o){uc(r,[o,n])}),Ta(r)}}if(rb(t)){if(mc)return Qv(mc(t));if(hc)return hc(t);if(dc){var i=[];return dc(t,function(n){uc(i,n)}),Ta(i)}}},Sa.exports=function(t){return ib(t)||cc(t)}));var Ea,Kv,zv,sc,Jv,Yv,ke,uc,lc,Zv,eb,Ta,cc,tb,rb,pc,dc,fc,mc,gc,hc,ib});var yc=m((TC,ab)=>{"use strict";var ob=function(e){return e!==e};ab.exports=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||ob(t)&&ob(r))}});var vc=m((SC,sb)=>{"use strict";var pS=yc();sb.exports=function(){return typeof Object.is=="function"?Object.is:pS}});var lb=m((OC,ub)=>{"use strict";var dS=vc(),fS=Gt();ub.exports=function(){var t=dS();return fS(Object,{is:t},{is:function(){return Object.is!==t}}),t}});var fb=m((PC,db)=>{"use strict";var mS=Gt(),gS=wr(),hS=yc(),cb=vc(),yS=lb(),pb=gS(cb(),Object);mS(pb,{getPolyfill:cb,implementation:hS,shim:yS});db.exports=pb});var yb=m((MC,hb)=>{"use strict";var gb=Function.prototype.toString,li=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Ac,Oa;if(typeof li=="function"&&typeof Object.defineProperty=="function")try{Ac=Object.defineProperty({},"length",{get:function(){throw Oa}}),Oa={},li(function(){throw 42},null,Ac)}catch(e){e!==Oa&&(li=null)}else li=null;var vS=/^\s*class\b/,_c=function(t){try{var r=gb.call(t);return vS.test(r)}catch{return!1}},bc=function(t){try{return _c(t)?!1:(gb.call(t),!0)}catch{return!1}},Pa=Object.prototype.toString,bS="[object Object]",AS="[object Function]",_S="[object GeneratorFunction]",wS="[object HTMLAllCollection]",xS="[object HTML document.all class]",ES="[object HTMLCollection]",TS=typeof Symbol=="function"&&!!Symbol.toStringTag,SS=!(0 in[,]),wc=function(){return!1};typeof document=="object"&&(mb=document.all,Pa.call(mb)===Pa.call(document.all)&&(wc=function(t){if((SS||!t)&&(typeof t>"u"||typeof t=="object"))try{var r=Pa.call(t);return(r===wS||r===xS||r===ES||r===bS)&&t("")==null}catch{}return!1}));var mb;hb.exports=li?function(t){if(wc(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{li(t,null,Ac)}catch(r){if(r!==Oa)return!1}return!_c(t)&&bc(t)}:function(t){if(wc(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(TS)return bc(t);if(_c(t))return!1;var r=Pa.call(t);return r!==AS&&r!==_S&&!/^\[object HTML/.test(r)?!1:bc(t)}});var Ab=m((RC,bb)=>{"use strict";var OS=yb(),PS=Object.prototype.toString,vb=Object.prototype.hasOwnProperty,MS=function(t,r,i){for(var n=0,o=t.length;n<o;n++)vb.call(t,n)&&(i==null?r(t[n],n,t):r.call(i,t[n],n,t))},RS=function(t,r,i){for(var n=0,o=t.length;n<o;n++)i==null?r(t.charAt(n),n,t):r.call(i,t.charAt(n),n,t)},DS=function(t,r,i){for(var n in t)vb.call(t,n)&&(i==null?r(t[n],n,t):r.call(i,t[n],n,t))},IS=function(t,r,i){if(!OS(r))throw new TypeError("iterator must be a function");var n;arguments.length>=3&&(n=i),PS.call(t)==="[object Array]"?MS(t,r,n):typeof t=="string"?RS(t,r,n):DS(t,r,n)};bb.exports=IS});var wb=m((DC,_b)=>{"use strict";var xc=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],NS=typeof globalThis>"u"?global:globalThis;_b.exports=function(){for(var t=[],r=0;r<xc.length;r++)typeof NS[xc[r]]=="function"&&(t[t.length]=xc[r]);return t}});var Pc=m((IC,Sb)=>{"use strict";var Ra=Ab(),CS=wb(),xb=wr(),Sc=Oe(),Ma=fa(),qS=Sc("Object.prototype.toString"),Tb=Xt()(),Eb=typeof globalThis>"u"?global:globalThis,Tc=CS(),Oc=Sc("String.prototype.slice"),Ec=Object.getPrototypeOf,kS=Sc("Array.prototype.indexOf",!0)||function(t,r){for(var i=0;i<t.length;i+=1)if(t[i]===r)return i;return-1},Da={__proto__:null};Tb&&Ma&&Ec?Ra(Tc,function(e){var t=new Eb[e];if(Symbol.toStringTag in t){var r=Ec(t),i=Ma(r,Symbol.toStringTag);if(!i){var n=Ec(r);i=Ma(n,Symbol.toStringTag)}Da["$"+e]=xb(i.get)}}):Ra(Tc,function(e){var t=new Eb[e],r=t.slice||t.set;r&&(Da["$"+e]=xb(r))});var BS=function(t){var r=!1;return Ra(Da,function(i,n){if(!r)try{"$"+i(t)===n&&(r=Oc(n,1))}catch{}}),r},FS=function(t){var r=!1;return Ra(Da,function(i,n){if(!r)try{i(t),r=Oc(n,1)}catch{}}),r};Sb.exports=function(t){if(!t||typeof t!="object")return!1;if(!Tb){var r=Oc(qS(t),8,-1);return kS(Tc,r)>-1?r:r!=="Object"?!1:FS(t)}return Ma?BS(t):null}});var Pb=m((NC,Ob)=>{"use strict";var VS=Pc();Ob.exports=function(t){return!!VS(t)}});var Mc=m((CC,Cb)=>{"use strict";var HS=wr(),jS=Oe(),Nb=Se(),LS=Pb(),Mb=Nb("ArrayBuffer",!0),Rb=Nb("Float32Array",!0),Ia=jS("ArrayBuffer.prototype.byteLength",!0),Db=Mb&&!Ia&&new Mb().slice,Ib=Db&&HS(Db);Cb.exports=Ia||Ib?function(t){if(!t||typeof t!="object")return!1;try{return Ia?Ia(t):Ib(t,0),!0}catch{return!1}}:Rb?function(t){try{return new Rb(t).buffer===t&&!LS(t)}catch(r){return typeof t=="object"&&r.name==="RangeError"}}:function(t){return!1}});var kb=m((qC,qb)=>{"use strict";var US=Date.prototype.getDay,WS=function(t){try{return US.call(t),!0}catch{return!1}},GS=Object.prototype.toString,XS="[object Date]",$S=Xt()();qb.exports=function(t){return typeof t!="object"||t===null?!1:$S?WS(t):GS.call(t)===XS}});var jb=m((kC,Hb)=>{"use strict";var Rc=Oe(),Bb=Xt()(),Fb,Vb,Dc,Ic;Bb&&(Fb=Rc("Object.prototype.hasOwnProperty"),Vb=Rc("RegExp.prototype.exec"),Dc={},Na=function(){throw Dc},Ic={toString:Na,valueOf:Na},typeof Symbol.toPrimitive=="symbol"&&(Ic[Symbol.toPrimitive]=Na));var Na,QS=Rc("Object.prototype.toString"),KS=Object.getOwnPropertyDescriptor,zS="[object RegExp]";Hb.exports=Bb?function(t){if(!t||typeof t!="object")return!1;var r=KS(t,"lastIndex"),i=r&&Fb(r,"value");if(!i)return!1;try{Vb(t,Ic)}catch(n){return n===Dc}}:function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:QS(t)===zS}});var Wb=m((BC,Ub)=>{"use strict";var JS=Oe(),Lb=JS("SharedArrayBuffer.prototype.byteLength",!0);Ub.exports=Lb?function(t){if(!t||typeof t!="object")return!1;try{return Lb(t),!0}catch{return!1}}:function(t){return!1}});var Xb=m((FC,Gb)=>{"use strict";var YS=Number.prototype.toString,ZS=function(t){try{return YS.call(t),!0}catch{return!1}},eO=Object.prototype.toString,tO="[object Number]",rO=Xt()();Gb.exports=function(t){return typeof t=="number"?!0:typeof t!="object"?!1:rO?ZS(t):eO.call(t)===tO}});var Kb=m((VC,Qb)=>{"use strict";var $b=Oe(),iO=$b("Boolean.prototype.toString"),nO=$b("Object.prototype.toString"),oO=function(t){try{return iO(t),!0}catch{return!1}},aO="[object Boolean]",sO=Xt()();Qb.exports=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:sO&&Symbol.toStringTag in t?oO(t):nO(t)===aO}});var Zb=m((HC,Nc)=>{"use strict";var uO=Object.prototype.toString,lO=ua()();lO?(zb=Symbol.prototype.toString,Jb=/^Symbol\(.*\)$/,Yb=function(t){return typeof t.valueOf()!="symbol"?!1:Jb.test(zb.call(t))},Nc.exports=function(t){if(typeof t=="symbol")return!0;if(uO.call(t)!=="[object Symbol]")return!1;try{return Yb(t)}catch{return!1}}):Nc.exports=function(t){return!1};var zb,Jb,Yb});var rA=m((jC,tA)=>{"use strict";var eA=typeof BigInt<"u"&&BigInt;tA.exports=function(){return typeof eA=="function"&&typeof BigInt=="function"&&typeof eA(42)=="bigint"&&typeof BigInt(42)=="bigint"}});var oA=m((LC,Cc)=>{"use strict";var cO=rA()();cO?(iA=BigInt.prototype.valueOf,nA=function(t){try{return iA.call(t),!0}catch{}return!1},Cc.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:nA(t)}):Cc.exports=function(t){return!1};var iA,nA});var sA=m((UC,aA)=>{"use strict";var pO=rc(),dO=Xb(),fO=Kb(),mO=Zb(),gO=oA();aA.exports=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(pO(t))return"String";if(dO(t))return"Number";if(fO(t))return"Boolean";if(mO(t))return"Symbol";if(gO(t))return"BigInt"}});var cA=m((WC,lA)=>{"use strict";var Ca=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,uA=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,qa;Ca||(qa=function(t){return!1});var kc=Ca?Ca.prototype.has:null,qc=uA?uA.prototype.has:null;!qa&&!kc&&(qa=function(t){return!1});lA.exports=qa||function(t){if(!t||typeof t!="object")return!1;try{if(kc.call(t,kc),qc)try{qc.call(t,qc)}catch{return!0}return t instanceof Ca}catch{}return!1}});var dA=m((GC,Fc)=>{"use strict";var hO=Se(),pA=Oe(),yO=hO("%WeakSet%",!0),Bc=pA("WeakSet.prototype.has",!0);Bc?(ka=pA("WeakMap.prototype.has",!0),Fc.exports=function(t){if(!t||typeof t!="object")return!1;try{if(Bc(t,Bc),ka)try{ka(t,ka)}catch{return!0}return t instanceof yO}catch{}return!1}):Fc.exports=function(t){return!1};var ka});var mA=m((XC,fA)=>{"use strict";var vO=nc(),bO=ac(),AO=cA(),_O=dA();fA.exports=function(t){if(t&&typeof t=="object"){if(vO(t))return"Map";if(bO(t))return"Set";if(AO(t))return"WeakMap";if(_O(t))return"WeakSet"}return!1}});var yA=m(($C,hA)=>{"use strict";var wO=Oe(),gA=wO("ArrayBuffer.prototype.byteLength",!0),xO=Mc();hA.exports=function(t){return xO(t)?gA?gA(t):t.byteLength:NaN}});var LA=m((QC,jA)=>{"use strict";var FA=Qy(),ot=Oe(),vA=uv(),EO=Se(),ci=nb(),TO=Zl(),bA=fb(),AA=Fl(),_A=tc(),wA=Mc(),xA=kb(),EA=jb(),TA=Wb(),SA=sa(),OA=sA(),PA=mA(),MA=Pc(),RA=yA(),DA=ot("SharedArrayBuffer.prototype.byteLength",!0),IA=ot("Date.prototype.getTime"),Vc=Object.getPrototypeOf,NA=ot("Object.prototype.toString"),Fa=EO("%Set%",!0),Hc=ot("Map.prototype.has",!0),Va=ot("Map.prototype.get",!0),CA=ot("Map.prototype.size",!0),Ha=ot("Set.prototype.add",!0),VA=ot("Set.prototype.delete",!0),ja=ot("Set.prototype.has",!0),Ba=ot("Set.prototype.size",!0);function qA(e,t,r,i){for(var n=ci(e),o;(o=n.next())&&!o.done;)if($e(t,o.value,r,i))return VA(e,o.value),!0;return!1}function HA(e){if(typeof e>"u")return null;if(typeof e!="object")return typeof e=="symbol"?!1:typeof e=="string"||typeof e=="number"?+e==+e:!0}function SO(e,t,r,i,n,o){var a=HA(r);if(a!=null)return a;var s=Va(t,a),u=FA({},n,{strict:!1});return typeof s>"u"&&!Hc(t,a)||!$e(i,s,u,o)?!1:!Hc(e,a)&&$e(i,s,u,o)}function OO(e,t,r){var i=HA(r);return i??(ja(t,i)&&!ja(e,i))}function kA(e,t,r,i,n,o){for(var a=ci(e),s,u;(s=a.next())&&!s.done;)if(u=s.value,$e(r,u,n,o)&&$e(i,Va(t,u),n,o))return VA(e,u),!0;return!1}function $e(e,t,r,i){var n=r||{};if(n.strict?bA(e,t):e===t)return!0;var o=OA(e),a=OA(t);if(o!==a)return!1;if(!e||!t||typeof e!="object"&&typeof t!="object")return n.strict?bA(e,t):e==t;var s=i.has(e),u=i.has(t),l;if(s&&u){if(i.get(e)===i.get(t))return!0}else l={};return s||i.set(e,l),u||i.set(t,l),RO(e,t,n,i)}function BA(e){return!e||typeof e!="object"||typeof e.length!="number"||typeof e.copy!="function"||typeof e.slice!="function"||e.length>0&&typeof e[0]!="number"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function PO(e,t,r,i){if(Ba(e)!==Ba(t))return!1;for(var n=ci(e),o=ci(t),a,s,u;(a=n.next())&&!a.done;)if(a.value&&typeof a.value=="object")u||(u=new Fa),Ha(u,a.value);else if(!ja(t,a.value)){if(r.strict||!OO(e,t,a.value))return!1;u||(u=new Fa),Ha(u,a.value)}if(u){for(;(s=o.next())&&!s.done;)if(s.value&&typeof s.value=="object"){if(!qA(u,s.value,r.strict,i))return!1}else if(!r.strict&&!ja(e,s.value)&&!qA(u,s.value,r.strict,i))return!1;return Ba(u)===0}return!0}function MO(e,t,r,i){if(CA(e)!==CA(t))return!1;for(var n=ci(e),o=ci(t),a,s,u,l,p,c;(a=n.next())&&!a.done;)if(l=a.value[0],p=a.value[1],l&&typeof l=="object")u||(u=new Fa),Ha(u,l);else if(c=Va(t,l),typeof c>"u"&&!Hc(t,l)||!$e(p,c,r,i)){if(r.strict||!SO(e,t,l,p,r,i))return!1;u||(u=new Fa),Ha(u,l)}if(u){for(;(s=o.next())&&!s.done;)if(l=s.value[0],c=s.value[1],l&&typeof l=="object"){if(!kA(u,e,l,c,r,i))return!1}else if(!r.strict&&(!e.has(l)||!$e(Va(e,l),c,r,i))&&!kA(u,e,l,c,FA({},r,{strict:!1}),i))return!1;return Ba(u)===0}return!0}function RO(e,t,r,i){var n,o;if(typeof e!=typeof t||e==null||t==null||NA(e)!==NA(t)||AA(e)!==AA(t))return!1;var a=_A(e),s=_A(t);if(a!==s)return!1;var u=e instanceof Error,l=t instanceof Error;if(u!==l||(u||l)&&(e.name!==t.name||e.message!==t.message))return!1;var p=EA(e),c=EA(t);if(p!==c||(p||c)&&(e.source!==t.source||vA(e)!==vA(t)))return!1;var g=xA(e),b=xA(t);if(g!==b||(g||b)&&IA(e)!==IA(t)||r.strict&&Vc&&Vc(e)!==Vc(t))return!1;var d=MA(e),A=MA(t);if(d!==A)return!1;if(d||A){if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var f=BA(e),h=BA(t);if(f!==h)return!1;if(f||h){if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var y=wA(e),T=wA(t);if(y!==T)return!1;if(y||T)return RA(e)!==RA(t)?!1:typeof Uint8Array=="function"&&$e(new Uint8Array(e),new Uint8Array(t),r,i);var w=TA(e),S=TA(t);if(w!==S)return!1;if(w||S)return DA(e)!==DA(t)?!1:typeof Uint8Array=="function"&&$e(new Uint8Array(e),new Uint8Array(t),r,i);if(typeof e!=typeof t)return!1;var x=SA(e),O=SA(t);if(x.length!==O.length)return!1;for(x.sort(),O.sort(),n=x.length-1;n>=0;n--)if(x[n]!=O[n])return!1;for(n=x.length-1;n>=0;n--)if(o=x[n],!$e(e[o],t[o],r,i))return!1;var D=PA(e),N=PA(t);return D!==N?!1:D==="Set"||N==="Set"?PO(e,t,r,i):D==="Map"?MO(e,t,r,i):!0}jA.exports=function(t,r,i){return $e(t,r,i,TO())}});var jc={};Z(jc,{getProxyHeaders:()=>QO});async function $A(){let e=await at.prefs,t={};return e.mediaExtensions.split("|").forEach(function(r){t[r]=1}),t}async function QA(){let e=(await at.prefs).networkFilterOut;if(e)try{return new RegExp(e,"i")}catch{console.warn("networkFilterOut preference is not a valid regex");return}}function WA(){Ot.webRequest.onHeadersReceived.addListener(JA,{urls:["<all_urls>"]},["responseHeaders"])}function XO(){Ot.webRequest.onHeadersReceived.removeListener(JA)}function GA(){St={},Ot.webRequest.onSendHeaders.addListener(YA,{urls:["<all_urls>"]},e_),Ot.webRequest.onErrorOccurred.addListener(ZA,{urls:["<all_urls>"]})}function $O(){Ot.webRequest.onSendHeaders.removeListener(YA),Ot.webRequest.onErrorOccurred.removeListener(ZA),St=null}function t_(e){let t=pi[e.url];if(t){clearTimeout(t.timer),delete pi[e.url];let r=e.requestHeaders.filter(i=>typeof XA[i.name.toLowerCase()]>"u");t.handlers.forEach(i=>{i.resolve({proxy:e.proxyInfo,headers:r})})}}function QO(e){function t(){let i=pi[e];i&&(i.handlers.forEach(n=>{n.reject(new Error("timeout monitoring proxyHeaders"))}),delete pi[e])}let r=pi[e];return r?clearTimeout(r.timer):r=pi[e]={handlers:[]},new Promise((i,n)=>{r.handlers.push({resolve:i,reject:n}),r.timer=setTimeout(t,3e4),fetch(e,{method:"HEAD",credentials:"include"})})}var at,DO,IO,UA,NO,CO,Ot,qO,kO,BO,FO,VO,HO,jO,LO,UO,WO,XA,KA,zA,JA,GO,St,YA,ZA,e_,pi,Lc=I(()=>{"use strict";Fi();me();Ir();mt();ft();Oi();at=J(),DO=(Ce(),P(Ne)),IO=(Yi(),P(Ji)),UA=(fe(),P(de)),NO=($r(),P(Xr)),{MaybeCreateProbeFromNetworkRequest:CO}=(ul(),P(sl)),Ot=at.browser,qO=new RegExp("^bytes [0-9]+-[0-9]+/([0-9]+)$"),kO=new RegExp("^(audio|video)/(?:x-)?([^; ]+)"),BO=new RegExp('filename\\s*=\\s*"\\s*([^"]+?)\\s*"'),FO=new RegExp("/([^/]+?)(?:\\.([a-z0-9]{1,5}))?(?:\\?|#|$)","i"),VO=new RegExp("\\.([a-z0-9]{1,5})(?:\\?|#|$)","i"),HO=new RegExp("\\bsource=yt_otf\\b"),jO=new RegExp("/ptracking\\b"),LO=new RegExp("^https://www.gstatic.com/youtube/doodle\\b"),UO=new RegExp("^(https?)://v[^\\/]*\\.tumblr\\.com/(tumblr_[0-9a-zA-Z_]+)\\.(?:mp4|mov)"),WO=new RegExp("^https://soundcloud.com/"),XA={host:!0,range:!0,"content-length":!0};KA=$A();at.prefs.then(e=>e.on("mediaExtensions",()=>{KA=$A()}));zA=QA();at.prefs.then(e=>e.on("networkFilterOut",()=>{zA=QA()}));JA=async e=>{let t=await at.prefs,r;if(St&&(r=St[e.requestId],r&&delete St[e.requestId]),e.tabId<0)return;let i=await zA;if(HO.test(e.url)||jO.test(e.url)||LO.test(e.url)||i&&i.test(e.url))return;function n(d,A){if(!A&&(!s&&isNaN(u)&&!l||!s&&!l&&(isNaN(u)||t.mediaweightThreshold===0||u<t.mediaweightThreshold)||s&&s[2].toLowerCase()=="ms-asf"))return;let f={id:"network-probe:"+UA.hashHex(e.url),status:"active",url:e.url,tabId:e.tabId,frameId:e.frameId,fromCache:!0,referrer:g};!isNaN(u)&&!d&&(f.length=u),e.proxyInfo&&e.proxyInfo.type.substr(0,4)=="http"&&(f.proxy=e.proxyInfo);let h=o["content-disposition"];if(h){let w=BO.exec(h);w&&w[1]&&(f.headerFilename=w[1])}let y=FO.exec(e.url);y&&(f.urlFilename=y[1]),f.title=f.headerFilename||f.urlFilename||at._("media");let T=UO.exec(e.url);T&&(f.thumbnailUrl=T[1]+"://media.tumblr.com/"+T[2]+"_frame1.jpg"),l?(f.type="video",f.extension=l[1]):s?(f.type=s[1],f.extension=s[2]):f.extension=p,f.headers=r&&r.filter(w=>typeof XA[w.name.toLowerCase()]>"u")||[],Ot.tabs.get(e.tabId).then(async w=>{if(w){f.topUrl=w.url,f.isPrivate=w.incognito,f.title=f.headerFilename||w.title||f.urlFilename||at._("media");let S=await NO.getSpecs(w.url);S&&(S.headerFilename=f.headerFilename,S.urlFilename=f.urlFilename),d&&(f.originalId=f.id,await d.onHitDataAvailable(f)),UA.executeScriptWithGlobal({tabId:w.id},{_$vdhHitId:f.id,_$vdhSmartNameSpecs:S},"/injected/pagedata.js").catch(x=>{Ot.webNavigation.getFrame({tabId:w.id,frameId:f.frameId}).then(O=>{O&&(console.warn("pagedata execution error",x.message),IO.updateOriginal(f.id,{title:w.title||f.title,pageUrl:O.url,topUrl:w.url}))})})}if(!d){f.group=f.id;let S=M,x={builder:"HTTPMedia",protocol:"non-adaptative",duration:"unknown"};{if(a){let O=Gr(a);if(O.isErr())console.warn("Couldn't not parse mimetype",a);else{let{container:D,av_codecs:N}=O.unwrap();S=C({...x,container:le(D),av:gt(N,B=>({codec:dt(B),bitrate:M}),B=>({codec:je(B),fps:M,dimensions:M,quality:M,bitrate:M}))})}}S.isNone()&&l?.[1]&&(S=id(l[1]).map(O=>({...x,container:O,av:{audio:!1,video:Hn()}})))}S.isSome()&&(f.core_media=S.unwrap(),DO.dispatch("hit.new",f))}})}let o={};(e.responseHeaders||[]).forEach(d=>{o[d.name.toLowerCase()]=d.value});let a=o["content-type"],s=kO.exec(a),u=parseInt(o["content-length"]);if(isNaN(u)){let d=o["content-range"];if(d){let A=qO.exec(d);A&&(u=parseInt(A[1]))}}let l=VO.exec(e.url),p=null,c=await KA;if(l){if(p=l[1].toLowerCase(),p=="m4s"&&t.dashHideM4s||p=="ts"&&t.mpegtsHideTs)return;c[l[1]]||(l=null)}let g=e.originUrl||e.documentUrl||void 0;if(WO.test(g)&&u<1e6&&a=="audio/mpeg")return;let b=CO(e,a,r);if(b)try{n(b,!0,g,r,e)}catch(d){console.error("Uncaught PostHook error:",d)}else{let d=s&&(s[1]=="audio"||s[1]=="video"),A=!isNaN(u)&&t.mediaweightThreshold>0&&u>=t.mediaweightThreshold;n(null,d||A)}},GO=["main_frame","sub_frame","xmlhttprequest","object","media"];at.browserType=="firefox"&&GO.push("object_subrequest");at.prefs.then(e=>{e.networkProbe&&WA(),e.monitorNetworkRequests&&GA(),e.on("networkProbe",(t,r)=>{r?WA():XO()}),e.on("monitorNetworkRequests",(t,r)=>{r?GA():$O()})});St=null,YA=e=>{t_(e),St&&(St[e.requestId]=e.requestHeaders)},ZA=e=>{t_(e),St&&delete St[e.requestId]},e_=["requestHeaders"];Ot.runtime.getManifest().manifest_version>=3&&e_.push("extraHeaders");pi={}});var Gc={};Z(Gc,{analyzePage:()=>Wc});async function Uc(){let e=await hn.tabs.query({active:!0,currentWindow:!0});if(e.length===0)throw new Error("Can't find current tab");return{tabId:e[0].id}}async function Wc(e){let t;e?t={tabId:e}:t=await Uc(),await hn.scripting.insertCSS({target:t,css:zO});let r=await zt.prefs;await n_.executeScriptWithGlobal(t,{_$vdhParams:{extensions:r.medialinkExtensions,maxHits:r.medialinkMaxHits,minFilesPerGroup:r.medialinkMinFilesPerGroup,minImgSize:r.medialinkMinImgSize,scanImages:r.medialinkScanImages,scanLinks:r.medialinkScanLinks}},"/injected/gallery.js")}function i_(e){return".vdh-mask."+e+" { display: block; }"}var zt,hn,r_,n_,KO,zO,Xc=I(()=>{"use strict";zt=J(),hn=zt.browser,r_=(Ce(),P(Ne)),n_=(fe(),P(de)),KO=(Lc(),P(jc)),zO=".vdh-mask { position: absolute; display: none; background-color: rgba(255,0,0,0.5); z-index: 2147483647; }";zt.rpc.listen({analyzePage:()=>{Wc()},galleryGroups:e=>{Object.keys(e.groups).forEach(t=>{let r=e.groups[t],i="??",n="??";try{n=new URL(r.baseUrl).hostname}catch(s){console.warn("Uncaught URL error",s)}switch(r.type){case"image":i=zt._("gallery_from_domain",n);break;case"link":i=zt._("gallery_links_from_domain",n);break}let o;if(r.extensions){let s=Object.keys(r.extensions);s.sort((l,p)=>r.extensions[l]-r.extensions[p]);let u=[];s.forEach(l=>{let p=zt._("number_type",[""+r.extensions[l],l.toUpperCase()]);u.push(p)}),o=zt._("gallery_files_types",u.length>0&&u.join(", ")||""+r.urls.length)}let a="gallery:"+n_.hashHex(e.pageUrl)+":"+t;r_.dispatch("hit.new",Object.assign({},r,{gallery_urls:r.urls,id:a,topUrl:e.pageUrl,title:i,description:o,mouseTrack:!0})),KO.getProxyHeaders(e.pageUrl).then(s=>{r_.dispatch("hit.update",{id:a,changes:s})})})},galleryHighlight:async e=>{hn.scripting.insertCSS({target:await Uc(),css:i_(e)})},galleryUnhighlight:async e=>{hn.scripting.removeCSS({target:await Uc(),css:i_(e)})}});hn.tabs.onUpdated.addListener(async(e,t,r)=>{let i=await zt.prefs;t.status==="complete"&&i.medialinkAutoDetect&&Wc(e)})});var o_={};Z(o_,{updateHits:()=>Qc});function nP(e){let t=Math.floor(e/3600),r=Math.floor(e%3600/60),i=e%60;return t>0?t+":"+("00"+r).substr(-2)+":"+("00"+i).substr(-2):r+":"+("00"+i).substr(-2)}function oP(e){return e.length?e.length>1024*1024?z._("MB",[Math.round(e.length*10/(1024*1024))/10]):e.length>1024?z._("KB",[Math.round(e.length*10/1024)/10]):z._("Bytes",[e.length]):null}function aP(e){if(e.description)return e.description;let t=[];if(e.descrPrefix&&t.push(e.descrPrefix),e.size&&t.push(e.size),e.duration&&t.push(nP(e.duration)),e.quality){let i=z._("quality_"+e.quality);i==""&&(i=e.quality.toUpperCase()),t.push(i)}if(e.bitrate){let i=e.bitrate,n="bps";e.bitrate>1e7?(n="Mbps",i=Math.round(e.bitrate/1e6)):e.bitrate>1e6?(n="Mbps",i=Math.round(e.bitrate/1e5)/10):e.bitrate>1e4?(n="Kbps",i=Math.round(e.bitrate/1e3)):e.bitrate>1e3&&(n="Kbps",i=Math.round(e.bitrate/100)/10),t.push(i+n)}let r=oP(e);return r&&t.push(r),e.mediaDomain&&t.push(z._("from_domain",[e.mediaDomain])),e.type=="audio"&&t.push(z._("audio_only")),e.extension&&(e.originalExt&&e.originalExt!=e.extension&&t.push(e.originalExt.toUpperCase()+">"+e.extension.toUpperCase()),t.push(e.extension.toUpperCase())),t.join(" - ")}async function Qc(e){let t=await z.prefs,r=[],i=di.describeAll();e:for(let o of e){o[0].group||console.warn("Trying to construct a menu item, but hit is missing group",o[0]),r.push({id:"group-"+o[0].group,title:o[0].title,enabled:!1});for(let a of o){let s=(await di.availableActions(a.id))[0];if(r.push({id:a.id,title:aP(a),icons:{18:"content/"+i[s].icon18}}),r.length>=iP)break e}}if(r.length==0&&r.push({id:"vdh-no-media",title:z._("no_media_current_tab"),enabled:!1}),r.push({id:"separator",type:"separator"}),r.push({id:"vdh-smartnaming",title:z._("smartnaming_rule")}),r.push({id:"separator2",type:"separator"}),r.push({id:"vdh-settings",title:z._("settings"),icons:{64:"content/images/icon-settings-64.png"}}),r.push({id:"vdh-about",title:z._("about"),icons:{64:"content/images/icon-about-64.png"}}),YO.buildOptions.browser=="firefox"&&r.push({id:"vdh-sites",title:z._("supported_sites"),icons:{64:"content/images/icon-sites-list-64.png"}}),r.push({id:"vdh-convert",title:z._("convert_local_files"),icons:{64:"content/images/icon-action-convert-b-64.png"}}),r.push({id:"vdh-merge",title:z._("merge_local_files"),icons:{64:"content/images/icon-merger-64.png"}}),r.push({id:"vdh-analyze",title:z._("analyze_page"),icons:{64:"content/images/icon-photo-64.png"}}),!t.contextMenuEnabled&&(!z.isBrowser("firefox")||!t.toolsMenuEnabled)){La.length&&(Ua.removeAll(),La=[]);return}if(JO(r,La))return;La=r;function n(o){return new Promise((a,s)=>{Ua.create(o,()=>{a()})})}sP(async()=>{let o=await z.prefs;return Ua.removeAll().then(()=>{let a=[];return o.contextMenuEnabled&&a.push(n({id:"vdh-main",title:z._("title"),contexts:["all"]}).then(()=>Promise.all(r.map(s=>{let u=Object.assign({parentId:"vdh-main"},s);return Wa.menus||(delete u.icons,(u.contexts||[]).indexOf("selection")<0&&(u.contexts=(u.contexts||[]).concat(["all"]))),n(u)})))),z.isBrowser("firefox")&&o.toolsMenuEnabled&&a.push(n({id:"vdh-main-tools",title:z._("title"),contexts:["tools_menu"]}).then(()=>Promise.all(r.map(s=>n(Object.assign({parentId:"vdh-main-tools"},s,{id:s.id+"-tools"})))))),Promise.all(a)})})}var JO,YO,z,Wa,di,$c,ZO,eP,tP,rP,iP,Ua,La,sP,a_=I(()=>{"use strict";JO=LA(),YO=er(),z=J(),Wa=z.browser,di=(Xi(),P(Gi)),$c=(Ce(),P(Ne)),ZO=(fe(),P(de)),eP=(Xc(),P(Gc)),tP=($r(),P(Xr)),rP=(Ft(),P(Bt)),iP=12,Ua=Wa.menus||Wa.contextMenus;La=[],sP=ZO.Concurrent();z.unsafe_prefs.on("contextMenuEnabled",async()=>Qc(await $c.getSerializedHits()));z.unsafe_prefs.on("toolsMenuEnabled",async()=>Qc(await $c.getSerializedHits()));Ua.onClicked.addListener(function(e,t){switch(e.menuItemId){case"vdh-settings":case"vdh-settings-tools":z.ui.open("settings",{type:"tab",url:"content/settings.html"});break;case"vdh-about":case"vdh-about-tools":z.ui.open("about",{type:"panel",url:"content/about.html"});break;case"vdh-sites":case"vdh-sites-tools":rP.gotoOrOpenTab("https://www.downloadhelper.net/sites");break;case"vdh-convert":case"vdh-convert-tools":di.convertLocal();break;case"vdh-merge":di.mergeLocal();break;case"vdh-analyze":case"vdh-analyze-tools":eP.analyzePage();break;case"vdh-smartnaming":case"vdh-smartnaming-tools":tP.defineInPage();break;default:{let r=/^(.*)\-tools$/.exec(e.menuItemId),i=r&&r[1]||e.menuItemId;di.execute_default(i)}}});Wa.commands.onCommand.addListener(async function(e){if(e=="default-action"){for(let t of await $c.getSerializedHits())if(t[0].status=="active"){di.execute_default(t[0].id);return}}})});var d_={};Z(d_,{checkHitBlacklisted:()=>pP,set:()=>p_});async function Kc(){try{await s_.storage.local.set({blacklist:await vn})}catch{console.error("Cannot write blacklist storage")}}function yn(e){let t=[],r=/^https?:\/\/([^\/:]+)/.exec(e);if(r)if(uP.test(r[1]))t.push(r[1]);else{let i=r[1].split(".");for(;i.length>1&&(i[0]!="co"||i.length>2);)t.push(i.join(".")),i.shift()}return t}function c_(e){let t=[];e.url&&(t=t.concat(yn(e.url))),e.audioUrl&&(t=t.concat(yn(e.audioUrl))),e.videoUrl&&(t=t.concat(yn(e.videoUrl))),e.topUrl&&(t=t.concat(yn(e.topUrl))),e.pageUrl&&(t=t.concat(yn(e.pageUrl)));let r={};return t.forEach(function(i){r[i]=1}),r}function lP(e){let t=Object.keys(e);return t.sort(function(r,i){let n=r.split(".").reverse(),o=i.split(".").reverse();for(;;){if(n.length&&!o.length)return-1;if(!n.length&&o.length)return 1;if(!n.length&&!o.length)return 0;let a=n.shift(),s=o.shift();if(a!=s)return a<s?-1:1}}),t}function cP(e){let t=c_(e);return lP(t)}function pP(e){if(!Ga.unsafe_prefs.blacklistEnabled)return!1;let t=c_(e);for(let r in t)if(l_[r])return!0;return!1}async function dP(e){let t=await vn;e.forEach(r=>{t[r]=!0}),await Kc(),u_.dispatch("blacklist-changed")}async function fP(e){let t=await vn;e.forEach(r=>{delete t[r]}),await Kc()}async function p_(e){vn=Promise.resolve(e||{}),await Kc()}var Ga,s_,u_,uP,l_,vn,f_=I(()=>{"use strict";Ga=J(),s_=Ga.browser,u_=(Ce(),P(Ne)),uP=new RegExp("^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"),vn=(async()=>{try{let t=(await s_.storage.local.get({blacklist:{}})).blacklist;return l_=t,t}catch{console.error("Cannot read blacklist storage");return}})();Ga.rpc.listen({domainsFromHitId:e=>{let t=u_.getHit(e);return t&&cP(t)||[]},addToBlacklist:dP,removeFromBlacklist:fP,setBlacklist:async e=>{await p_(e)},getBlacklist:async()=>{let e=await vn;return Object.keys(e).filter(t=>!!e[t])},editBlacklist:()=>{Ga.ui.open("blacklist-edit",{type:"tab",url:"content/blacklist-edit.html"})}})});var Yc={};Z(Yc,{outputConfigForHit:()=>gP,set:()=>g_});async function g_(e){Jc=Promise.resolve(e),await m_.storage.local.set({convrules:e})}async function gP(e){let t=await Jc,r=(e.url||e.videoUrl||e.audioUrl)&&e.topUrl;if(!r)return null;let i=new URL(r).hostname,n=[],o=i.split(".");for(let u=0;u<o.length-1;u++)n.push(o.slice(u).join("."));let a=null;return t.every(u=>{let l=!0;return u.extension&&e.extension!==u.extension&&(l=!1),l&&u.domain&&(l=!n.every(p=>p!==u.domain)),l&&(a=u),!l})||!a.convert?null:(await mP.getOutputConfigs())[a.format]||null}var zc,m_,mP,Jc,Zc=I(()=>{"use strict";zc=J(),m_=zc.browser,mP=(Qi(),P($i)),Jc=m_.storage.local.get({convrules:[]}).then(e=>e.convrules);zc.rpc.listen({editConversionRules:()=>{zc.ui.open("convrules-edit",{type:"tab",url:"content/convrules-edit.html"})},getConversionRules:()=>Jc,setConversionRules:e=>g_(e)})});var Ne={};Z(Ne,{closePopup:()=>__,dispatch:()=>DP,getHit:()=>v_,getHits:()=>ip,getLogs:()=>OP,getMainData:()=>A_,getSerializedHits:()=>np});function ip(){return Ae.getState().hits}function v_(e){return ip().flat.get(e)}function OP(){return Ae.getState().logs}async function b_(){let{flat:e}=ip(),t=(await st.prefs).mediaweightMinSize,r=await xr.storage.local.get({blacklist:{}}),i=Object.keys(r.blacklist).map(n=>n.split(".").reverse());return gd(e,i,t)}async function np(){let e=bd(await Mn(kr,{})),t=await b_(),r=hd(t,e);for(let i of r)for(let n of i)n.actions=await h_.availableActions(n.id);return r}async function op(){let e=0,t=0,r=0,i=0,n=await b_();for(let p of n.values())switch(p.status){case"running":i++;break;case"active":e++,t++;break;case"inactive":t++;break;case"pinned":r++;break}let o=await st.prefs,a=!1;(t==0||o.iconActivation=="currenttab"&&e==0)&&(a=!0),xr.action.setIcon({path:{32:"/content/images/icon-32"+(a?"-off":"")+".png",40:"/content/images/icon-40"+(a?"-off":"")+".png",48:"/content/images/icon-48"+(a?"-off":"")+".png",128:"/content/images/icon-128"+(a?"-off":"")+".png"}});let s="",u="#000";switch(o.iconBadge){case"tasks":u="#00f",s=i||"";break;case"activetab":u="#080",s=e||"";break;case"anytab":u="#b59e32",s=t||"";break;case"pinned":u="#000",s=r||"";break;case"mixed":r>0?(u="#000",s=r):i>0?(u="#00f",s=i):e>0?(u="#080",s=e):t>0&&(u="#b59e32",s=t)}let l=Ae.getState().logs.filter(p=>p.type==="error");l.length>0&&(s=l.length,u="#f44"),xr.action.setBadgeText({text:""+s}),xr.action.setBadgeBackgroundColor({color:u})}function DP(e,t){Ae.dispatch({type:e,payload:t})}async function A_(){return{hits:await np(),actions:h_.describeAll(),logs:Ae.getState().logs,progress:Ae.getState().progress}}async function __(){return bn.call("main","close")}async function IP(){let e=["blacklist","license",kr,"convrules","outputConfigs","smartname"],t=await st.prefs;return xr.storage.local.get(e).then(r=>{let i=Object.assign({blacklist:{},license:null,conversionRules:[],outputConfigs:{}},r,{"weh-prefs":t.getAll()}),n=JSON.stringify(i,null,4),o;if(st.isBrowser("firefox")){let a=new Blob([n],{type:"text/json;charset=utf-8"});o=URL.createObjectURL(a)}else o="data:,"+n;xr.downloads.download({url:o,filename:"vdh-settings.json",saveAs:!0,conflictAction:"uniquify"})})}async function NP(e){return e.convrules&&await SP.set(e.convrules),e.outputConfigs&&_P.setOutputConfigs(e.outputConfigs),e.license&&wP.setLicense(e.license),e.blacklist&&await EP.set(e.blacklist),kr in e&&await Rn(kr,e[kr]),e.smartname&&await TP.set(e.smartname),e["weh-prefs"]||{}}function CP(){xr.runtime.reload()}var hP,yP,vP,bP,rp,st,bn,tp,h_,AP,_P,wP,xP,EP,TP,SP,y_,xr,Ae,PP,MP,RP,ep,Ce=I(()=>{"use strict";Dn();yd();Ad();Dn();({createStore:hP,combineReducers:yP,applyMiddleware:vP}=rf()),{createLogger:bP}=of(),rp=cf(),st=J(),bn=Mt(),tp=(Yi(),P(Ji)),h_=(Xi(),P(Gi)),AP=(Gn(),P(Wn)),_P=(Qi(),P($i)),wP=(Yr(),P(Jr)),xP=(a_(),P(o_)),EP=(f_(),P(d_)),TP=($r(),P(Xr)),SP=(Zc(),P(Yc));Ft();y_=[];st.prefs.then(e=>{e.backgroundReduxLogger&&y_.push(bP({collapsed:(t,r,i)=>!0}))});xr=st.browser,Ae=hP(yP({hits:tp.reducer,progress:tp.progressReducer,logs:AP.reducer}),vP(...y_));PP=rp(Ae.getState,"hits"),MP=rp(Ae.getState,"progress"),RP=rp(Ae.getState,"logs");ep=null;Ae.subscribe(PP(async()=>{if(ep)return;let e=(await st.prefs).hitUpdateFloodProtect;ep=setTimeout(async()=>{ep=null;let t=await np();try{st.openedContents().indexOf("main")>=0&&bn.call("main","hits",t),xP.updateHits(t),op()}catch(r){console.error(r)}},e)}));Ae.subscribe(MP(()=>{try{bn.call("main","progress",Ae.getState().progress)}catch{}}));Ae.subscribe(RP(()=>{try{bn.call("main","logs",Ae.getState().logs)}catch{}try{op()}catch(e){console.error(e)}}));bn.listen({getHit:e=>v_(e),getMainData:A_,hitPageData:e=>{tp.updateOriginal(e.id,e.data)},closePopup:__,closePanel:e=>st.ui.close(e)});op();st.rpc.listen({exportSettings:IP,importSettings:NP,reloadAddon:CP})});var Bt={};Z(Bt,{current:()=>VP,gotoOrOpenTab:()=>WP,setTransientTab:()=>w_,update:()=>mi});function VP(){return{url:ap,urls:$a}}function HP(){Xa=null,FP().then(e=>{e&&(ap=e.url,Pt.tabs.query({}).then(t=>{$a={};for(let r in t)$a[t[r].url]=1;kP.dispatch("hits.urlUpdated",{url:ap,urls:$a})}))})}function mi(){Xa&&clearTimeout(Xa),Xa=setTimeout(HP,50)}function w_(e,t){Jt=e,fi=t}function jP(e){Jt===e&&fi&&Pt.tabs.update(fi,{active:!0}),Jt=null,fi=null,mi()}function LP({tabId:e,_windowId:t}){e!==Jt&&(Jt=null,fi=null),mi()}function UP(e){Jt==="<next-tab>"&&(Jt=e.id)}function WP(e){return Jt=null,fi=null,BP.gotoOrOpenTab(e,w_)}var qP,Pt,kP,BP,Xa,FP,ap,$a,Jt,fi,Ft=I(()=>{"use strict";qP=J(),Pt=qP.browser,kP=(Ce(),P(Ne)),BP=(fe(),P(de)),Xa=null,FP=async()=>{try{let e=await Pt.windows.getLastFocused({populate:!0});if(e.focused){let t=e.tabs.filter(r=>r.active);return t.length?t[0]:null}else return null}catch{return null}},ap="about:blank",$a={};Jt=null,fi=null;Pt.windows.onFocusChanged.addListener(mi);Pt.windows.onRemoved.addListener(mi);Pt.tabs.onActivated.addListener(LP);Pt.tabs.onRemoved.addListener(jP);Pt.tabs.onUpdated.addListener(mi);Pt.tabs.onCreated.addListener(UP)});var Vt={};Z(Vt,{call:()=>T_,check:()=>lp,downloads:()=>rM,gotoInstall:()=>up,isAtLeastVersion:()=>tM,isDegradedVersion:()=>eM,isProbablyAvailable:()=>ZP,listen:()=>JP,request:()=>iM,requestBinary:()=>nM});function up(){QP(async()=>{let e=await Qa.prefs,t=`https://www.downloadhelper.net/install-coapp-v2?channel=${zP}`;return e.forcedCoappVersion&&(t+="&version="+e.forcedCoappVersion),$P.gotoOrOpenTab(t)})}function T_(...e){return Qe.call(...e)}function JP(...e){return Qe.listen(...e)}function YP(){return new Promise((e,t)=>{let r=!1;Qe.callCatchAppNotFound(i=>{gi=!1,r=!0,e({status:!1,error:i.message})},"info").then(i=>{gi=!0,sp=i.version,E_=i.target?.node==10,e({status:!0,info:i})}).catch(i=>{gi=!1,r||e({status:!1,error:i.message})})})}function lp(){return KP(()=>YP())}function ZP(){return gi}function eM(){return!!E_}function tM(e){if(sp)return XP(sp,e)>=0;throw new Error("Coapp no available")}function iM(e,t){return new Promise((r,i)=>{let n=[];function o(a){if(n.push(a.data),!a.more)return r(n.join(""));Qe.call("requestExtra",a.id).then(s=>{o(s)}).catch(i)}Qe.call("request",e,t).then(a=>(gi=!0,a)).then(o).catch(i)})}function nM(e,t){return new Promise((r,i)=>{let n=0,o=[];function a(s){if(s.data&&s.data.data&&(n+=s.data.data.length,o.push(new Uint8Array(s.data.data))),!s.more){let u=new Uint8Array(n),l=0;return o.forEach(p=>{u.set(p,l),l+=p.length}),r(u)}Qe.call("requestExtra",s.id).then(u=>{setTimeout(()=>{a(u)})}).catch(i)}Qe.call("requestBinary",e,t).then(s=>(gi=!0,s)).then(a).catch(i)})}var Qa,x_,GP,XP,Qe,$P,QP,KP,zP,An,gi,sp,E_,rM,Ht=I(()=>{"use strict";Qa=J(),x_=(fe(),P(de)),GP=(jp(),P(Hp)),{compareSemVer:XP}=(Jp(),P(zp)),Qe=Zp()("net.downloadhelper.coapp"),$P=(Ft(),P(Bt)),QP=x_.Concurrent(),KP=x_.Concurrent(),{channel:zP}=er(),An=null;Qe.onAppNotFound.addListener(()=>{up()});Qe.onCallCount.addListener(async(e,t)=>{let r=await Qa.prefs;An&&(clearTimeout(An),An=null),e===0&&t===0&&r.coappIdleExit&&(An=setTimeout(()=>{An=null,Qe.close()},r.coappIdleExit))});rM=new GP.Downloads(Qe);Qa.prefs.then(e=>{e.checkCoappOnStartup&&lp()});Qa.rpc.listen({coappProxy:T_,checkCoApp:lp,installCoApp:up})});fp();var oM=(async()=>{let e=J(),t=e.browser,r=er();r.prod||console.info("=========== VDH started",new Date().toLocaleTimeString(),"=========="),Np(),Ht(),Yr(),Lc(),Xc(),Zc();let i=(Ft(),P(Bt));return e.rpc.listen({openSettings:()=>{e.ui.open("settings",{type:"tab",url:"content/settings.html"}),e.ui.close("main")},openTranslation:()=>{e.ui.open("translation",{type:"tab",url:"content/translation.html"}),e.ui.close("main")},openSites:()=>i.gotoOrOpenTab("https://www.downloadhelper.net/sites"),openForum:()=>i.gotoOrOpenTab("https://github.com/aclap-dev/video-downloadhelper/discussions"),openHomepage:()=>i.gotoOrOpenTab("https://www.downloadhelper.net/"),openTranslationForum:()=>i.gotoOrOpenTab("https://github.com/aclap-dev/video-downloadhelper/discussions/categories/language-translation"),openWeh:()=>i.gotoOrOpenTab("https://github.com/mi-g/weh"),openAbout:()=>{e.ui.open("about",{type:"panel",url:"content/about.html"}),e.ui.close("main")},openCoapp:()=>{e.ui.open("coappShell",{type:"tab",url:"content/coapp-shell.html"}),e.ui.close("main")},goto:n=>i.gotoOrOpenTab(n),getBuild:()=>r,updateLastFocusedWindowHeight:(n,o)=>{t.windows.getLastFocused().then(a=>{if(a){n=Math.floor(n),o=Math.floor(o);let s=Math.floor(a.height)-o;t.windows.update(a.id,{height:n+s})}})},editMediaUserPrefs:()=>{e.ui.open("media-user-prefs-edit",{type:"tab",url:"content/media-user-prefs-edit.html"})}}),n=>{let o=t.runtime.getManifest(),a=r.channel,s=r.buildOptions.target,u=o.version.split(".").slice(0,2).join(".");if(n.reason=="install")i.gotoOrOpenTab(`https://www.downloadhelper.net/welcome/${s}/${a}/`);else if(n.reason=="update"){let l=n.previousVersion.split(".").slice(0,2).join(".");u!=l&&i.gotoOrOpenTab(`https://www.downloadhelper.net/changelog/${s}/${a}/`)}}})();(chrome||browser).runtime.onInstalled.addListener(async t=>{(await oM)(t)});})();
/*! Bundled license information:

semver-parser/index.js:
  (*!
   * SemVer Parser
   *
   * @license MIT
   * @copyright asamuzaK (Kazz)
   * @see {@link https://github.com/asamuzaK/semverParser/blob/master/LICENSE}
   * @see {@link https://semver.org/ Semantic Versioning 2.0.0}
   *)

m3u8-parser/dist/m3u8-parser.es.js:
  (*! @name m3u8-parser @version 7.1.0 @license Apache-2.0 *)
*/
